const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/csvService-CLus14ZO.js","assets/index-DIhvrpWB.js","assets/index-CiE-T32a.css","assets/tdsCalculator-D11FdiJf.js","assets/pdfService-DI-Yvzc8.js","assets/jspdf.es.min-DhGiYnZI.js","assets/attributes-zDdy4c7G.js","assets/index-D5tRGIgp.js","assets/createLucideIcon-C3C3nVut.js","assets/colors-C8jCGJn0.js","assets/dateUtils-BSM0ms4X.js"])))=>i.map(i=>d[i]);
import{u as Q,b as H,r as N,j as e,_,C as M,d as U}from"./index-DIhvrpWB.js";import{dbService as z}from"./dbService-8xAAiJd6.js";import{b as F}from"./dateUtils-BSM0ms4X.js";import{H as B,F as W}from"./Footer-6AYHX0dO.js";import{S as G,a as Z,b as J}from"./SampleLibraryCard-B16qDI6j.js";import{U as K,P as X}from"./papaparse.min--Tlr-pwQ.js";import{c as I}from"./createLucideIcon-C3C3nVut.js";import{P as Y}from"./plus--YqhkHux.js";import"./index-D5tRGIgp.js";import"./colors-C8jCGJn0.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]],te=I("Download",ee);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]],re=I("Search",ae),se=r=>r.split(/\s+OR\s+/i).map(v=>{const u=[],x=/([a-zA-Z_]+)\s*(>=|<=|>|<|=|:)\s*([0-9.]+|"[^"]+"|\S+)/g;let c;for(;(c=x.exec(v))!==null;){const[m,l,a,h]=c;let w=h.replace(/^"(.*)"$/,"$1");const E=parseFloat(w);isNaN(E)||(w=E),u.push({key:l.toLowerCase(),operator:a,value:w})}const y=v.replace(x,"").trim();return y&&y.split(/\s+/).forEach(l=>u.push({text:l.toLowerCase()})),u}),oe=(r,g)=>se(g).some(u=>u.every(x=>{if("text"in x){const c=x.text;return!!(r.sampleCode.toLowerCase().includes(c)||r.evaluator.toLowerCase().includes(c)||r.evaluationType.toLowerCase().includes(c)||c==="tds"&&r.tdsProfile&&r.tdsProfile.events.length>0)}else{const{key:c,operator:y,value:m}=x;let l;if(c==="score")l=r.globalQuality;else if(c==="year")l=parseInt(r.date.substring(0,4));else if(c==="date")l=r.date;else{const a=r.attributes.find(h=>h.nameEn.toLowerCase().startsWith(c)||h.nameEs.toLowerCase().startsWith(c));a&&(l=a.score)}if(l===void 0)return!1;if(typeof m=="number"&&typeof l=="number")switch(y){case">":return l>m;case">=":return l>=m;case"<":return l<m;case"<=":return l<=m;case"=":return l===m;case":":return l===m;default:return!1}else{const a=String(l).toLowerCase(),h=String(m).toLowerCase();return y==="="||y===":"?a.includes(h):!1}}})),ge=()=>{const{language:r,t:g}=Q(),v=H(),[u,x]=N.useState([]),[c,y]=N.useState(!0),[m,l]=N.useState(""),[a,h]=N.useState(new Set);N.useEffect(()=>{w()},[]);const w=async()=>{try{y(!0);const t=await z.getAllSamples();x(t)}catch(t){console.error("Failed to load samples:",t)}finally{y(!1)}},E=async(t,n)=>{if(window.confirm(r==="es"?`¿Eliminar muestra ${n}?`:`Delete sample ${n}?`))try{await z.deleteSample(t),x(s=>s.filter(f=>f.id!==t)),h(s=>{const f=new Set(s);return f.delete(t),f})}catch(s){console.error("Failed to delete sample:",s)}},L=t=>{h(n=>{const s=new Set(n);return s.has(t)?s.delete(t):s.add(t),s})},A=u.filter(t=>oe(t,m)),P=a.size>0&&Array.from(a).every(t=>{const n=u.find(s=>s.id===t);return(n==null?void 0:n.tdsProfile)&&Object.keys(n.tdsProfile).length>0}),$=()=>{if(a.size===0||!P)return;const t=Array.from(a).join(",");v(`/tds-deep?ids=${t}`)},V=()=>{if(a.size<2){alert(r==="es"?"Seleccione al menos 2 muestras para comparar":"Select at least 2 samples to compare");return}const t=Array.from(a).join(",");v(`/compare?ids=${t}`)},T=async()=>{const t=a.size>0?u.filter(d=>a.has(d.id)):u;if(t.length===0)return;const n=`cacao_eval_${F()}`,s=window.prompt(r==="es"?"Nombre del archivo CSV:":"Enter filename for CSV:",n);if(s===null)return;const f=(s||n).endsWith(".csv")?s||n:`${s||n}.csv`,{generateCSVRow:p}=await _(async()=>{const{generateCSVRow:d}=await import("./csvService-CLus14ZO.js");return{generateCSVRow:d}},__vite__mapDeps([0,1,2,3])),S=r==="es"?M:U,o=t.map(d=>p(d,r)),C="data:text/csv;charset=utf-8,"+[S.join(","),...o.map(d=>d.join(","))].join(`
`),i=encodeURI(C),b=document.createElement("a");b.setAttribute("href",i),b.setAttribute("download",f),document.body.appendChild(b),b.click(),document.body.removeChild(b)},R=async()=>{if(a.size===0)return;const t=u.filter(p=>a.has(p.id)),n=`cacao_eval_${F()}`,s=window.prompt(r==="es"?"Nombre del archivo PDF:":"Enter filename for PDF:",n);if(s===null)return;const f=s||n;try{const{generatePdf:p}=await _(async()=>{const{generatePdf:o}=await import("./pdfService-DI-Yvzc8.js");return{generatePdf:o}},__vite__mapDeps([4,5,1,2,6,7,8,9,3,10])),S=t.map(o=>({metadata:{sampleCode:o.sampleCode,date:o.date,time:o.time,evaluator:o.evaluator,evaluationType:o.evaluationType,sampleInfo:o.sampleInfo,notes:o.notes,producerRecommendations:o.producerRecommendations},attributes:o.attributes,globalQuality:o.globalQuality,selectedQualityId:o.selectedQualityId,language:r,tdsProfile:o.tdsProfile}));await p(S,void 0,f)}catch(p){console.error("PDF Export failed",p),alert(r==="es"?"Error al generar PDF":"Failed to generate PDF")}},O=()=>{var t;(t=document.getElementById("csv-import-input"))==null||t.click()},q=t=>{var s;const n=(s=t.target.files)==null?void 0:s[0];n&&(X.parse(n,{header:!0,skipEmptyLines:!0,complete:async f=>{try{const{parseSamplesFromCSV:p}=await _(async()=>{const{parseSamplesFromCSV:i}=await import("./csvService-CLus14ZO.js");return{parseSamplesFromCSV:i}},__vite__mapDeps([0,1,2,3])),S=p(f.data,r),o=S.filter(i=>i.sampleCode&&i.date&&i.evaluator),C=S.length-o.length;if(C>0&&alert(r==="es"?`Se omitieron ${C} entradas por faltar datos de identificación (Código, Fecha o Evaluador).`:`Skipped ${C} entries due to missing identification data (Code, Date, or Evaluator).`),o.length>0){const i=[];o.forEach((d,j)=>{const D=u.find(k=>k.sampleCode.toLowerCase()===d.sampleCode.toLowerCase()&&k.evaluator.toLowerCase()===d.evaluator.toLowerCase()&&k.date===d.date);D&&i.push({importIdx:j,existingId:D.id,code:d.sampleCode,createdAt:D.createdAt})});const b=[...o];if(i.length>0){const d=r==="es"?`Se encontraron ${i.length} muestras duplicadas (mismo Código, Evaluador y Fecha). 

Si continúa, estas muestras serán REEMPLAZADAS con los datos del CSV.

¿Desea continuar?`:`Found ${i.length} duplicate samples (same Code, Evaluator, and Date). 

Proceeding will REPLACE these samples with the data from the CSV.

Do you want to proceed?`;if(!window.confirm(d))return;i.forEach(j=>{b[j.importIdx]={...b[j.importIdx],id:j.existingId,createdAt:j.createdAt}})}await z.importSamples(b),await w(),alert(r==="es"?`Proceso finalizado: ${i.length} reemplazadas, ${o.length-i.length} nuevas.`:`Process complete: ${i.length} replaced, ${o.length-i.length} new samples imported.`)}else alert(r==="es"?"No se encontraron muestras válidas en el archivo CSV.":"No valid samples found in CSV.")}catch(p){console.error("Import failed",p),alert(r==="es"?"Error al importar muestras.":"Failed to import samples.")}}}),t.target.value="")};return e.jsxs("div",{className:"flex flex-col min-h-screen bg-cacao-50 text-gray-800 font-sans",children:[e.jsx(B,{}),e.jsx("input",{type:"file",id:"csv-import-input",accept:".csv, text/csv, application/vnd.ms-excel",className:"hidden",onChange:q}),e.jsxs("main",{className:"w-full px-4 md:px-8 space-y-6 mb-8 flex-grow",children:[e.jsx("div",{className:"bg-white p-4 rounded-xl shadow-sm border border-cacao-100 flex flex-col gap-4",children:e.jsxs("div",{className:"flex flex-col lg:flex-row justify-between gap-4",children:[e.jsxs("div",{className:"relative w-full lg:w-96 flex-shrink-0 z-20",children:[e.jsx(re,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:20}),e.jsx("input",{type:"text",placeholder:g.searchSamples||"Search samples...",value:m,onChange:t=>l(t.target.value),className:"w-full pl-10 pr-10 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-cacao-500 focus:bg-white transition-all"}),e.jsxs("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2 group",children:[e.jsx("span",{className:"text-gray-400 cursor-help text-xs font-bold border border-gray-300 rounded-full w-5 h-5 flex items-center justify-center",children:"?"}),e.jsxs("div",{className:"absolute right-0 top-8 w-64 p-3 bg-gray-800 text-white text-xs rounded-lg shadow-xl opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-50",children:[e.jsx("p",{className:"font-bold mb-1",children:"Advanced Filters:"}),e.jsxs("ul",{className:"space-y-1 text-gray-300",children:[e.jsx("li",{children:e.jsxs("code",{children:["score ",">"," 8"]})}),e.jsx("li",{children:e.jsxs("code",{children:["acidity ",">="," 5"]})}),e.jsx("li",{children:e.jsx("code",{children:"date : 2024"})}),e.jsx("li",{children:e.jsxs("code",{children:["cocoa OR score ",">"," 9"]})})]})]})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 lg:justify-end",children:[e.jsxs("div",{className:"flex items-center gap-1 bg-gray-50 p-1 rounded-lg border border-gray-100",children:[e.jsx("button",{onClick:O,className:"p-2 text-cacao-700 hover:bg-white hover:text-cacao-900 hover:shadow-sm rounded-md transition-all",title:g.importSamples,children:e.jsx(K,{size:20})}),e.jsx("div",{className:"w-px h-6 bg-gray-200"}),e.jsx("button",{onClick:T,className:"p-2 text-cacao-700 hover:bg-white hover:text-cacao-900 hover:shadow-sm rounded-md transition-all",title:g.exportAllCSV,children:e.jsx(te,{size:20})})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("button",{onClick:()=>h(new Set),disabled:a.size===0,className:`px-3 py-2.5 rounded-xl border text-sm font-bold flex items-center gap-2 transition-all duration-200 ${a.size>0?"bg-cacao-100 text-cacao-900 border-cacao-200 hover:bg-cacao-200 hover:border-cacao-300 cursor-pointer shadow-sm":"bg-gray-50 text-gray-400 border-gray-100 cursor-default opacity-60"}`,title:"Clear Selection",children:[a.size>0?e.jsx(G,{size:16}):e.jsx(Z,{size:16}),e.jsxs("span",{className:"hidden sm:inline",children:[a.size," ",r==="es"?"Seleccionadas":"Selected"]}),e.jsx("span",{className:"sm:hidden",children:a.size})]}),e.jsx("button",{onClick:$,disabled:a.size===0||!P,className:`font-bold py-2.5 px-4 rounded-xl shadow-sm transition-colors ${a.size>0&&P?"bg-orange-500 hover:bg-orange-600 text-white border-transparent":"bg-gray-100 text-gray-400 border border-gray-200 cursor-not-allowed"}`,title:P?"TDS Analysis":"No TDS Data",children:"TDS"}),e.jsx("button",{onClick:R,disabled:a.size===0,className:`font-bold py-2.5 px-4 rounded-xl shadow-sm transition-colors ${a.size===0?"bg-gray-100 text-gray-400 border border-gray-200 cursor-not-allowed":"bg-amber-600 hover:bg-amber-700 text-white border border-transparent"}`,title:r==="es"?"Descargar PDF":"Download PDF",children:"PDF"})]}),e.jsxs("div",{className:"flex items-center gap-2 ml-auto lg:ml-0",children:[e.jsx("button",{onClick:V,disabled:a.size<2,className:`font-bold py-2.5 px-5 rounded-xl shadow-md transition-colors ${a.size<2?"bg-gray-200 text-gray-400 cursor-not-allowed":"bg-white text-cacao-800 border-2 border-cacao-800 hover:bg-cacao-50"}`,children:g.compare||"Compare"}),e.jsx("button",{onClick:()=>v("/evaluate"),className:"bg-cacao-600 hover:bg-cacao-700 text-white font-bold p-2.5 rounded-xl shadow-md transition-colors flex items-center justify-center aspect-square",title:g.newEvaluation,children:e.jsx(Y,{size:24})})]})]})]})}),c?e.jsx("div",{className:"text-center py-20 text-gray-500",children:"Loading samples..."}):A.length===0?e.jsxs("div",{className:"text-center py-20 bg-white rounded-xl border border-dashed border-gray-300",children:[e.jsx("p",{className:"text-gray-500 mb-4",children:g.noSamples||"No samples found"}),e.jsx("button",{onClick:()=>v("/evaluate"),className:"text-cacao-600 font-bold hover:underline",children:"Start your first evaluation"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4 gap-6",children:A.map(t=>e.jsx(J,{sample:t,isSelected:a.has(t.id),onToggleSelect:L,onDelete:E},t.id))})]}),e.jsx(W,{})]})};export{ge as default};
