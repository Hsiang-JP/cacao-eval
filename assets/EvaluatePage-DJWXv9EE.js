import{c as q,R as Z,r as x,u as H,j as e,X as le,a as oe,b as V,d as ee,I as Y,e as ie,f as de,g as ce}from"./index-CJWcQEdu.js";import{F as me}from"./FlavorRadar-CdG2TiV2.js";import{g as B,d as J,A as ue}from"./dbService-gir1Ecq8.js";import{u as te}from"./useDataTranslation-C0Dmi7XE.js";import{C as U,A as xe,a as se,D as X,b as be}from"./tdsCalculator-BKwsfyiu.js";import{T as he,R as ge,C as pe}from"./triangle-alert-CxHCbKtk.js";import{P as fe,V as ye,C as ve}from"./ConfirmationModal-DSryCgJ3.js";import{g as je,a as we}from"./dateUtils-BSM0ms4X.js";import{F as K}from"./file-text-B_4pTOLP.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ne=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],ae=q("ChevronDown",Ne);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Se=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],ne=q("ChevronUp",Se);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ke=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m16 12-4-4-4 4",key:"177agl"}],["path",{d:"M12 16V8",key:"1sbj14"}]],Ce=q("CircleArrowUp",ke);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Te=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],De=q("Lock",Te);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $e=[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]],Ee=q("Menu",$e);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ae=[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]],Me=q("Play",Ae);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pe=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],ze=q("Save",Pe);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fe=[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]],W=q("Sparkles",Fe);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Re=[["path",{d:"M12.8 19.6A2 2 0 1 0 14 16H2",key:"148xed"}],["path",{d:"M17.5 8a2.5 2.5 0 1 1 2 4H2",key:"1u4tom"}],["path",{d:"M9.8 4.4A2 2 0 1 1 11 8H2",key:"75valh"}]],Ie=q("Wind",Re),Qe=Z.memo(({id:t,label:w,value:c,subAttributes:b,onChange:s,onSubAttributeChange:p,onSubAttributeDescriptionChange:y,colorClass:i="accent-brand-600",customColor:f,language:v="en",isCalculated:n=!1,disabled:N=!1,defaultExpanded:o=!1})=>{const[j,I]=x.useState(o),{t:S}=H(),E=b&&b.length>0,C=a=>a===0?"text-gray-400":a<3?"text-gray-500":a<7?"text-brand-600":"text-brand-800 font-bold",A=((b==null?void 0:b.filter(a=>a.score>0))||[]).length,P=`slider-${t}`,Q=f?{accentColor:f}:void 0;return e.jsxs("div",{id:t,className:`bg-white rounded-xl shadow-sm border border-brand-100 transition-all overflow-hidden scroll-mt-48 ${N?"opacity-80 pointer-events-none":""}`,children:[e.jsxs("button",{onClick:()=>I(!j),disabled:N,"aria-expanded":j,"aria-controls":`${P}-content`,className:"w-full p-4 flex justify-between items-center hover:bg-brand-50 transition-colors active:bg-brand-100 touch-manipulation min-h-[44px]",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[e.jsx("span",{className:"text-sm font-bold text-gray-800 uppercase tracking-wide",children:w}),n&&e.jsx("span",{title:S("calculated"),className:"flex items-center",children:e.jsx(De,{size:12,className:"text-gray-400"})}),E&&A>0&&e.jsx("span",{className:"text-[10px] font-bold bg-brand-100 text-brand-800 px-1.5 py-0.5 rounded",children:A})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:`text-2xl font-mono ${C(c)} min-w-[3rem] text-right`,children:n?c.toFixed(1):c}),j?e.jsx(ne,{size:20,className:"text-gray-600 flex-shrink-0"}):e.jsx(ae,{size:20,className:"text-gray-600 flex-shrink-0"})]})]}),e.jsx("div",{id:`${P}-content`,className:"transition-all duration-300 ease-in-out",style:{maxHeight:j?"2000px":"0",opacity:j?1:0},children:e.jsxs("div",{className:"px-6 md:px-4 pb-6 md:pb-4 space-y-6 md:space-y-3",children:[e.jsx("div",{className:"flex items-center gap-3 touch-pan-y",children:e.jsx("input",{id:P,type:"range",min:"0",max:"10",step:n?"0.1":"1",value:c,onChange:a=>!n&&s(parseFloat(a.target.value)),disabled:n||N,style:Q,className:`w-full h-8 md:h-4 bg-gray-200 rounded-lg appearance-none touch-pan-y ${!n&&!N?"cursor-pointer":"cursor-not-allowed opacity-60"} ${f?"":i}`})}),n&&e.jsx("div",{className:"text-[10px] text-gray-400 italic text-right",children:S("calculated")}),E&&e.jsx("div",{className:"mt-2 grid grid-cols-1 md:grid-cols-2 gap-3 p-3 bg-brand-50 rounded-lg border border-brand-100 touch-pan-y",children:b.map(a=>e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("label",{className:"text-xs font-medium text-gray-600 truncate pr-2",children:a.name}),e.jsx("span",{className:`text-xs font-mono w-6 text-right ${a.score>0?"text-brand-800 font-bold":"text-gray-400"}`,children:a.score})]}),e.jsx("input",{type:"range",min:"0",max:"10",step:"1",value:a.score,style:Q,onChange:r=>p(a.id,parseFloat(r.target.value)),disabled:N,className:`w-full h-1.5 bg-gray-200 rounded-lg appearance-none touch-pan-y ${N?"cursor-not-allowed":"cursor-pointer"} ${f?"":"accent-brand-500"}`}),a.id==="def_other"&&e.jsx("input",{type:"text",value:a.description||"",onChange:r=>y&&y(a.id,r.target.value),placeholder:S("description")||"Description...",disabled:N,className:"w-full mt-1 p-1.5 text-xs border border-brand-200 rounded focus:border-brand-500 outline-none disabled:bg-gray-100"})]},a.id))})]})})]})}),Le=({attributes:t,language:w,isEvaluationStarted:c})=>{const[b,s]=x.useState(!1);if(!c)return null;const p=y=>{const i=document.getElementById(y),f=document.getElementById("main-content");if(i){s(!1);const v=document.querySelector("header"),N=(v?v.offsetHeight:80)+90,j=i.getBoundingClientRect().top+window.pageYOffset-N;f?(f.style.transition="opacity 0.3s ease-out",f.style.opacity="0",setTimeout(()=>{window.scrollTo({top:j,behavior:"auto"}),requestAnimationFrame(()=>{f.style.opacity="1",setTimeout(()=>{f.style.transition=""},200)})},300)):window.scrollTo({top:j,behavior:"auto"})}};return e.jsxs("div",{className:"md:hidden fixed bottom-6 right-6 z-40 print:hidden",children:[e.jsx("button",{onClick:()=>s(!0),className:"bg-brand-600 hover:bg-brand-700 text-white p-4 rounded-full shadow-lg transition-transform hover:scale-105 active:scale-95 flex items-center justify-center","aria-label":"Navigation Menu",children:e.jsx(Ee,{size:24})}),b&&e.jsxs("div",{className:"fixed inset-0 z-50 flex flex-col justify-end",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm transition-opacity",onClick:()=>s(!1)}),e.jsxs("div",{className:"relative bg-white rounded-t-2xl shadow-2xl max-h-[80vh] overflow-hidden flex flex-col animate-in slide-in-from-bottom duration-300",children:[e.jsxs("div",{className:"p-4 border-b border-gray-100 flex justify-between items-center bg-brand-50",children:[e.jsx("h3",{className:"font-bold text-brand-800",children:w==="es"?"Navegación Rápida":"Quick Navigation"}),e.jsx("button",{onClick:()=>s(!1),className:"p-1 hover:bg-gray-200 rounded-full text-gray-500",children:e.jsx(le,{size:20})})]}),e.jsx("div",{className:"overflow-y-auto p-2",children:e.jsxs("div",{className:"grid grid-cols-2 gap-2 pb-safe",children:[e.jsxs("button",{onClick:()=>p("root"),className:"col-span-2 p-3 rounded-lg bg-gray-100 text-gray-700 font-medium text-sm flex items-center justify-center gap-2 hover:bg-gray-200",children:[e.jsx(Ce,{size:16}),w==="es"?"Ir al inicio":"Back to Top"]}),t.map(y=>e.jsx("button",{onClick:()=>p(y.id),className:"p-3 text-left rounded-lg hover:bg-brand-50 border border-transparent hover:border-brand-100 transition-colors text-sm text-gray-700 font-medium truncate",children:w==="es"?y.nameEs:y.nameEn},y.id))]})})]})]})]})},_e=({startTime:t,isRunning:w,className:c})=>{const b=x.useRef(null),s=x.useRef(0),p=y=>{const i=Math.floor(y/60),f=Math.floor(y%60),v=Math.floor(y%1*10);return`${i}:${f.toString().padStart(2,"0")}.${v}`};return x.useEffect(()=>{if(!w){if(cancelAnimationFrame(s.current),b.current&&t>0){const i=(performance.now()-t)/1e3;b.current.innerText=p(i)}return}const y=()=>{if(b.current){const i=(performance.now()-t)/1e3;b.current.innerText=p(i)}s.current=requestAnimationFrame(y)};return s.current=requestAnimationFrame(y),()=>cancelAnimationFrame(s.current)},[t,w]),e.jsx("div",{ref:b,className:c||"text-6xl font-mono font-bold text-white tracking-wider","aria-label":"Elapsed time",children:"0:00.0"})},qe=Z.memo(_e),Oe=({attrId:t,label:w,color:c,inputMethod:b,isActive:s,onStart:p,onStop:y,disabled:i=!1})=>{const f=x.useRef(!1),v=x.useCallback(S=>{i||(S.preventDefault(),f.current=!0,s||p(t))},[t,i,s,p]),n=x.useCallback(S=>{i||(S.preventDefault(),f.current=!1,s&&y(t))},[t,i,s,y]),N=x.useCallback(S=>{i||b==="mouse"&&(s?y(t):p(t))},[t,i,b,s,p,y]);x.useEffect(()=>()=>{f.current&&s&&y(t)},[t,s,y]);const o=`
    relative flex items-center justify-center
    w-full h-full
    px-2 py-1 rounded-xl font-bold text-xs uppercase tracking-wide leading-tight
    transition-all duration-100 ease-out select-none
    touch-manipulation
    whitespace-normal text-center break-words
    border border-white/10
  `,j=s?"ring-2 ring-offset-1 ring-white/80 scale-95 shadow-inner":"hover:scale-105 hover:shadow-lg hover:brightness-110 active:scale-90",I=i?"opacity-50 cursor-not-allowed":"cursor-pointer";return e.jsxs("button",{type:"button",className:`${o} ${j} ${I}`,style:{backgroundColor:s?c:`${c}80`,color:"#fff",textShadow:"0 1px 2px rgba(0,0,0,0.3)"},onClick:N,onTouchStart:b==="touch"?v:void 0,onTouchEnd:b==="touch"?n:void 0,onTouchCancel:b==="touch"?n:void 0,disabled:i,"aria-pressed":s,children:[s&&e.jsx("span",{className:"absolute inset-0 rounded-xl animate-pulse",style:{backgroundColor:c,opacity:.3}}),e.jsx("span",{className:"relative z-10",children:w})]})},Be=({mode:t,onComplete:w,onCancel:c})=>{const{t:b}=H(),{translateData:s}=te(),[p,y]=x.useState("idle"),[i,f]=x.useState(null),[v,n]=x.useState(null),[N,o]=x.useState([]),j="mouse",I=t==="normal"?U:xe,S=l=>{const g=V.attributes.find(T=>T.id===l);return(g?s({en:g.nameEn,es:g.nameEs}):l).replace(/\s*\(.*?\)\s*/g,"").trim()},E=x.useRef(0);x.useRef(0);const C=x.useRef(null),$=x.useRef(null);x.useEffect(()=>((async()=>{if(p==="tasting"&&"wakeLock"in navigator)try{$.current=await navigator.wakeLock.request("screen")}catch(g){console.warn("Wake lock not available:",g)}})(),()=>{$.current&&($.current.release(),$.current=null)}),[p]),x.useEffect(()=>(document.body.style.overflow="hidden",()=>{document.body.style.overflow=""}),[]);const A=x.useCallback(()=>{if(v&&C.current!==null){const l=(performance.now()-E.current)/1e3,g=i!==null&&C.current>=i?"residual":"melting",h={attrId:v,start:C.current,end:l,phase:g};o(T=>[...T,h])}C.current=null,n(null)},[v,i]),P=x.useCallback(l=>{if(p!=="tasting"&&p!=="swallowed")return;const g=(performance.now()-E.current)/1e3;if(v===l){A();return}if(v&&C.current!==null){const h=i!==null&&C.current>=i?"residual":"melting",T={attrId:v,start:C.current,end:g,phase:h};o(z=>[...z,T])}C.current=g,n(l)},[p,v,i,A]),Q=x.useCallback(l=>{P(l)},[P]),a=x.useCallback(l=>{v===l&&A()},[v,A]),r=()=>{E.current=performance.now(),y("tasting"),o([]),n(null),C.current=null},d=()=>{const l=(performance.now()-E.current)/1e3;f(l),y("swallowed")},m=()=>{let l=[...N];if(v&&C.current!==null){const T=(performance.now()-E.current)/1e3,z=i!==null&&C.current>=i?"residual":"melting",L={attrId:v,start:C.current,end:T,phase:z};l.push(L)}y("finished"),C.current=null,n(null);const g=(performance.now()-E.current)/1e3,h={mode:t,id:crypto.randomUUID?crypto.randomUUID():Array.from({length:32},()=>Math.floor(Math.random()*16).toString(16)).join(""),events:l,swallowTime:i||g,totalDuration:g,lastModified:Date.now()};w(h)},k=l=>{const g=Math.floor(l/60),h=Math.floor(l%60),T=Math.floor(l%1*10);return`${g}:${h.toString().padStart(2,"0")}.${T}`};return oe.createPortal(e.jsxs("div",{className:"fixed inset-0 z-[9999] bg-gray-900 flex flex-col w-full h-[100dvh] overflow-hidden overscroll-none touch-none",style:{height:"100dvh",maxHeight:"-webkit-fill-available"},children:[e.jsxs("div",{className:"flex-none flex items-center justify-between p-4 bg-gray-800 shadow-md z-10",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("h2",{className:"text-white font-bold text-lg",children:[b("tds.profile"),e.jsxs("span",{className:"text-gray-400 text-sm ml-2",children:["(",b(t==="normal"?"tds.modeNormal":"tds.modeExpert"),")"]})]})}),e.jsx("button",{onClick:c,className:"text-gray-400 hover:text-white p-2 font-bold bg-transparent border-0 cursor-pointer","aria-label":"Close",children:b("tds.close")})]}),e.jsxs("div",{className:"flex-none py-2 text-center bg-gray-900 z-10",children:[e.jsx("div",{className:"h-6 flex items-center justify-center mb-1",children:i!==null?e.jsxs("div",{className:"text-amber-400 text-sm font-medium animate-fade-in",children:[b("tds.swallowedAt")," ",k(i)]}):e.jsx("div",{className:"text-transparent text-sm select-none",children:"Placeholder"})}),e.jsx(qe,{startTime:E.current,isRunning:p==="tasting"||p==="swallowed"}),e.jsx("div",{className:"mt-3 h-10 flex items-center justify-center",children:v?e.jsx("span",{className:"inline-block px-4 py-2 rounded-full text-white font-bold text-lg animate-pulse shadow-lg",style:{backgroundColor:B(v)},children:S(v)}):e.jsx("span",{className:"inline-block px-4 py-2 rounded-full bg-gray-800 text-gray-600 font-bold text-lg border border-gray-700",children:b("tds.select")})})]}),(p==="tasting"||p==="swallowed")&&e.jsx("div",{className:"flex-none text-center text-gray-400 text-sm mb-2 px-4",children:b("tds.dominanceInstruction")}),e.jsx("div",{className:"flex-1 w-full px-2 pb-2 min-h-0 overflow-hidden flex flex-col",style:{touchAction:"none"},children:p==="idle"?e.jsx("div",{className:"h-full flex items-center justify-center",children:e.jsx("button",{onClick:r,className:"bg-green-600 hover:bg-green-700 text-white font-bold py-6 px-12 rounded-2xl text-2xl flex items-center gap-3 shadow-lg transition-all transform active:scale-95",children:b("tds.startTasting")})}):e.jsx("div",{className:"h-full w-full max-w-[700px] mx-auto",children:e.jsx("div",{className:"grid gap-1 w-full h-full grid-cols-3",style:{gridTemplateRows:t==="normal"?"repeat(2, minmax(0, 1fr))":"repeat(5, minmax(0, 1fr))"},children:I.map(l=>{const g=v===l,h=B(l);return e.jsx("div",{className:"w-full h-full min-h-0",children:e.jsx(Oe,{attrId:l,label:S(l),color:h,inputMethod:j,isActive:g,onStart:Q,onStop:a,disabled:p==="finished"})},l)})})})}),(p==="tasting"||p==="swallowed")&&e.jsxs("div",{className:"flex-none p-2 bg-gray-800 flex gap-2 pb-safe w-full border-t border-gray-700 shadow-md z-20",children:[e.jsx("button",{onClick:d,disabled:p!=="tasting",className:`flex-1 font-bold py-3 rounded-xl flex items-center justify-center gap-2 transition-colors active:scale-95 ${p==="tasting"?"bg-amber-600 hover:bg-amber-700 text-white shadow-lg":"bg-gray-700 text-gray-500 cursor-not-allowed opacity-50"}`,children:b("tds.swallow")}),e.jsx("button",{onClick:m,className:"flex-1 bg-red-600 hover:bg-red-700 text-white font-bold py-3 rounded-xl flex items-center justify-center gap-2 transition-colors active:scale-95 shadow-lg",children:b("tds.finish")})]}),e.jsx("style",{children:`
                .pb-safe { padding-bottom: env(safe-area-inset-bottom, 1rem); }
            `})]}),document.body)},Ue=({profile:t,onApply:w,onDiscard:c,onSave:b})=>{var $,A,P,Q;const{t:s,i18n:p}=H(),{translateData:y,language:i}=te(),[f,v]=x.useState(null),n=x.useMemo(()=>se(t),[t]),N=a=>{const r=V.attributes.find(d=>d.id===a);return r?y({en:r.nameEn,es:r.nameEs}):a},o=x.useMemo(()=>t.mode!=="expert"?[]:Array.from(n.scores.entries()).filter(([a,r])=>!U.includes(a)&&(r.isPresent||(r.totalDuration||0)>0||r.durationPercent>0)).sort(([,a],[,r])=>r.durationPercent-a.durationPercent).sort(([a],[r])=>{const d=X.includes(a),m=X.includes(r);return d&&!m?1:!d&&m?-1:0}),[n.scores,t.mode]),j=x.useMemo(()=>{const a=Array.from(n.coreScores.values()).some(d=>d.isFlagged),r=o.some(([,d])=>d.isFlagged);return a||r},[n.coreScores,o]),I=x.useMemo(()=>Array.from(n.scores.entries()).some(([a,r])=>X.includes(a)&&r.durationPercent>0),[n.scores]),S=x.useMemo(()=>{const a=Array.from(n.coreScores.values()).some(d=>d.boostDetails!==void 0),r=o.some(([,d])=>d.boostDetails!==void 0);return a||r},[n.coreScores,o]),E=()=>{const a=new Map(n.scores);if(t.mode==="expert")for(const[r,d]of n.coreScores)a.set(r,d);w(a,n)},C=x.useMemo(()=>{const a=t.mode==="expert"?n.coreScores:n.scores;return Array.from(a.entries()).sort(([r,d],[m,k])=>{const l=U.includes(r),g=U.includes(m);return l&&!g?-1:!l&&g?1:k.durationPercent-d.durationPercent})},[n,t.mode]);return e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl border border-gray-200 overflow-hidden max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"bg-gradient-to-r from-brand-600 to-brand-700 px-6 py-4",children:e.jsxs("h3",{className:"text-white font-bold text-lg",children:[s("tds.analysis"),e.jsxs("span",{className:"text-brand-200 text-sm ml-2",children:["(",t.mode==="normal"?s("tds.modeNormal"):s("tds.modeExpert"),")"]})]})}),e.jsxs("div",{className:"px-4 py-2 bg-blue-50 border-b border-blue-100",children:[e.jsx("p",{className:"text-xs text-blue-700",children:s("tds.zoneScoreNotice")}),S&&e.jsxs("p",{className:"text-xs text-indigo-700 mt-1 font-medium flex items-center gap-1",children:[e.jsx(W,{size:12}),s("tds.boostNotice")]})]}),t.events.length>0&&e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-1 mb-2",children:[e.jsx("h4",{className:"text-sm font-bold text-gray-600 uppercase",children:s("tds.timeline")}),e.jsxs("span",{className:"text-xs text-gray-500",children:[s("tds.duration"),": ",t.totalDuration.toFixed(1),"s | ",s("tds.swallowVerb"),": ",t.swallowTime.toFixed(1),"s"]})]}),e.jsx("div",{className:"relative w-full mt-8 mb-8",children:(()=>{const a=n.firstOnset||0,r=a+(n.attackPhaseDuration||0),d=t.swallowTime,m=t.totalDuration,k=a/m*100,l=r/m*100,g=d/m*100;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"absolute -top-4 left-2 right-0 text-xs text-gray-500 font-medium z-20 pointer-events-none",children:[e.jsx("span",{className:"absolute text-gray-600",style:{left:`${k}%`,transform:"translateX(-50%)"},children:"0%"}),e.jsx("span",{className:"absolute text-gray-600",style:{left:`${l}%`,transform:"translateX(-50%)"},children:"20%"}),e.jsx("span",{className:"absolute text-gray-800 font-bold",style:{left:`${g}%`,transform:"translateX(-50%)"},children:"100%"})]}),e.jsxs("div",{className:"relative w-full h-14 sm:h-16 bg-gray-100 rounded-lg overflow-hidden",onClick:()=>v(null),children:[e.jsx("div",{className:"absolute inset-0 flex",children:t.events.map((h,T)=>{const z=h.start/m*100,L=(h.end-h.start)/m*100,F=f===T;return e.jsx("div",{className:`absolute h-full cursor-pointer ${F?"opacity-100 z-20":"hover:opacity-80"}`,style:{left:`${z}%`,width:`${L}%`,backgroundColor:B(h.attrId)},onClick:M=>{M.stopPropagation(),v(F?null:T)},"aria-label":`${N(h.attrId)}: ${h.start.toFixed(1)}s - ${h.end.toFixed(1)}s`},T)})}),e.jsx("div",{className:"absolute top-0 bottom-0 w-0.5 sm:w-1 z-10",style:{left:`${l}%`,background:"repeating-linear-gradient(to bottom, black 0, black 4px, transparent 4px, transparent 8px)"}}),e.jsx("div",{className:"absolute top-0 bottom-0 w-1 sm:w-1.5 z-10 bg-black",style:{left:`${g}%`}})]}),e.jsxs("div",{className:"absolute -bottom-0 left-2 right-0 text-xs text-gray-500 font-medium z-20 pointer-events-none",children:[e.jsxs("span",{className:"absolute text-gray-600",style:{left:`${k}%`,transform:"translateX(-50%)"},children:[a.toFixed(1),"s"]}),e.jsxs("span",{className:"absolute text-gray-600",style:{left:`${l}%`,transform:"translateX(-50%)"},children:[r.toFixed(1),"s"]}),e.jsxs("span",{className:"absolute text-gray-800 font-bold",style:{left:`${g}%`,transform:"translateX(-50%)"},children:[d.toFixed(1),"s"]})]})]})})()}),e.jsxs("div",{className:"flex flex-wrap items-center justify-center gap-x-4 gap-y-1 text-xs text-gray-600",children:[e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"w-4 border-t-2 border-dashed border-gray-400"}),s("tds.attackEnd")]}),e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"w-4 h-1 bg-black"}),s("tds.swallowVerb")]}),e.jsxs("span",{className:"font-medium text-amber-700",children:[s("tds.aftertaste"),": ",(t.totalDuration-t.swallowTime).toFixed(1),"s"]})]}),e.jsx("div",{className:"h-10 flex items-center justify-center",children:f!==null&&t.events[f]?e.jsxs("div",{className:"px-3 py-1.5 bg-gray-100 rounded-lg flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded",style:{backgroundColor:B(t.events[f].attrId)}}),e.jsx("span",{className:"font-medium text-gray-800 text-sm",children:N(t.events[f].attrId)})]}),e.jsxs("span",{className:"text-xs text-gray-600",children:[t.events[f].start.toFixed(1),"s – ",t.events[f].end.toFixed(1),"s",e.jsxs("span",{className:"ml-1 text-gray-400",children:["(",(t.events[f].end-t.events[f].start).toFixed(1),"s)"]})]})]}):e.jsx("span",{className:"text-xs text-gray-400",children:s("tds.tapSegment")})})]}),e.jsxs("div",{className:"px-4 pb-2",children:[e.jsx("h4",{className:"text-sm font-bold text-gray-600 uppercase mb-2",children:s("tds.coreAttributes")}),e.jsx("div",{className:"grid grid-cols-1 gap-1.5",children:C.filter(([a])=>U.includes(a)).map(([a,r])=>e.jsxs("div",{className:`flex flex-col rounded-lg px-3 py-2 ${r.isFlagged?"bg-amber-50 border border-amber-200":"bg-gray-50"}`,children:[e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:B(a)}}),e.jsx("span",{className:"text-sm text-gray-700 font-medium",children:N(a)}),r.isFlagged&&e.jsx("span",{className:"text-xs text-amber-600 bg-amber-100 px-1 rounded",children:"!"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs text-gray-400",children:[r.durationPercent,"%"]}),e.jsx("span",{className:`font-bold w-6 text-right ${r.boostDetails?"text-indigo-700":"text-brand-800"}`,children:r.score})]})]}),r.boostDetails&&e.jsxs("div",{className:"mt-1 ml-5 text-xs text-indigo-600 flex items-start gap-1",children:[e.jsx("div",{className:"flex h-3 w-3 items-center justify-center rounded-full bg-indigo-100 text-[9px] font-bold mt-0.5 flex-shrink-0",children:"↑"}),e.jsx("span",{children:` ${s("tds.recommendation")}: +${r.boostDetails.amount} (${r.boostDetails.reason==="aftertaste"?`${s("tds.lingeringPresence")}: ${r.boostDetails.duration}s`:r.boostDetails.reason==="mixed"?`${s("tds.strongPresence")}: ${r.boostDetails.duration}s`:`${s("tds.componentPresence")}: ${r.boostDetails.duration}s`})`})]})]},a))})]}),t.mode==="expert"&&o.length>0&&e.jsxs("div",{className:"px-4 pb-4",children:[e.jsx("h4",{className:"text-sm font-bold text-gray-600 uppercase mb-2",children:s("tds.complementary")}),e.jsx("div",{className:"grid grid-cols-1 gap-1.5",children:o.map(([a,r])=>e.jsxs("div",{className:`flex flex-col rounded-lg px-3 py-2 ${r.isFlagged?"bg-amber-50 border border-amber-200":"bg-gray-50"}`,children:[e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:B(a)}}),e.jsx("span",{className:"text-sm text-gray-700 font-medium",children:N(a)}),r.isFlagged&&e.jsx("span",{className:"text-xs text-amber-600 bg-amber-100 px-1 rounded",children:"!"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs text-gray-400",children:[r.durationPercent,"%"]}),e.jsx("span",{className:`font-bold w-6 text-right ${r.boostDetails?"text-indigo-700":"text-brand-700"}`,children:r.score})]})]}),r.boostDetails&&e.jsxs("div",{className:"mt-1 ml-5 text-xs text-indigo-600 flex items-start gap-1",children:[e.jsx("div",{className:"flex h-3 w-3 items-center justify-center rounded-full bg-indigo-100 text-[9px] font-bold mt-0.5 flex-shrink-0",children:"↑"}),e.jsx("span",{children:` ${s("tds.recommendation")}: +${r.boostDetails.amount} (${r.boostDetails.reason==="aftertaste"?`${s("tds.lingeringPresence")}: ${r.boostDetails.duration}s`:r.boostDetails.reason==="mixed"?`${s("tds.strongPresence")}: ${r.boostDetails.duration}s`:`${s("tds.componentPresence")}: ${r.boostDetails.duration}s`})`})]})]},a))})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 p-4 bg-gradient-to-r from-amber-50 to-orange-50 border-y",children:[e.jsxs("div",{className:"bg-white/70 rounded-lg p-3 backdrop-blur",children:[e.jsxs("div",{className:"flex items-center gap-2 text-amber-700 mb-1",children:[e.jsx(Ie,{size:16}),e.jsx("span",{className:"text-xs font-bold uppercase",children:s("tds.aroma")})]}),e.jsxs("div",{className:"text-2xl font-bold text-amber-800",children:[n.aromaPercent,"%"]}),n.aromaNotes.length>0&&e.jsx("div",{className:"text-xs text-amber-600 mt-1",children:n.aromaNotes.map(a=>N(a)).join(", ")})]}),e.jsxs("div",{className:"bg-white/70 rounded-lg p-3 backdrop-blur",children:[e.jsxs("div",{className:"flex items-center gap-2 text-orange-700 mb-1",children:[e.jsx(W,{size:16}),e.jsx("span",{className:"text-xs font-bold uppercase",children:s("tds.aftertaste")})]}),e.jsxs("div",{className:"text-2xl font-bold text-orange-800",children:[n.aftertastePercent,"%"]}),e.jsx("div",{className:`text-xs mt-1 ${n.aftertasteQuality==="positive"?"text-green-600":n.aftertasteQuality==="negative"?"text-red-600":"text-gray-500"}`,children:n.aftertasteQuality==="positive"?s("tds.positive"):n.aftertasteQuality==="negative"?s("tds.negative"):s("tds.neutral")})]})]}),((($=n.kickSuggestions)==null?void 0:$.length)>0||((A=n.qualitySuggestions)==null?void 0:A.length)>0)&&e.jsxs("div",{className:"px-4 py-3 bg-indigo-50 border-b border-indigo-100",children:[e.jsxs("h4",{className:"text-sm font-bold text-indigo-800 flex items-center gap-2 mb-2",children:[e.jsx(W,{size:16}),s("tds.insights")]}),e.jsxs("div",{className:"space-y-3",children:[(P=n.kickSuggestions)==null?void 0:P.map((a,r)=>e.jsx("div",{className:"text-xs text-indigo-700 bg-white p-2 rounded border border-indigo-100 flex gap-2",children:i==="es"?a.es:a.en},`kick-${r}`)),(Q=n.qualitySuggestions)==null?void 0:Q.map((a,r)=>e.jsx("div",{className:"text-xs text-indigo-700 bg-white p-2 rounded border border-indigo-100 flex gap-2",children:i==="es"?a.es:a.en},`qual-${r}`))]})]}),n.qualityModifier!==0&&e.jsx("div",{className:"px-4 pb-3 pt-2",children:e.jsxs("div",{className:`text-sm px-3 py-2 rounded-lg ${n.qualityModifier>0?"bg-green-50 text-green-700":"bg-red-50 text-red-700"}`,children:[s("tds.qualityAdjustment")," ",e.jsxs("strong",{children:[n.qualityModifier>0?"+":"",n.qualityModifier]})]})}),(j||I)&&e.jsx("div",{className:"px-4 py-2 bg-amber-50 border-b border-amber-100",children:j&&e.jsxs("div",{className:"flex items-center gap-2 text-amber-700 text-sm",children:[e.jsx(he,{size:16}),e.jsx("span",{children:s("tds.coreNotSelected")})]})}),e.jsxs("div",{className:"flex gap-3 p-4 bg-gray-50 border-t sticky bottom-0",children:[e.jsx("button",{onClick:c,className:"flex-1 bg-white border border-gray-300 text-gray-700 font-bold py-3 rounded-xl hover:bg-gray-100 flex items-center justify-center gap-2",children:s("tds.discard")}),e.jsx("button",{onClick:b,className:"flex-1 bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-xl flex items-center justify-center gap-2",children:s("tds.save")}),e.jsx("button",{onClick:E,className:"flex-1 bg-green-600 hover:bg-green-700 text-white font-bold py-3 rounded-xl flex items-center justify-center gap-2",children:s("tds.apply")})]})]})},Ve=({onSelect:t,onCancel:w})=>{const{t:c}=H();return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl p-6 max-w-md w-full mx-4",children:[e.jsx("h3",{className:"text-xl font-bold text-brand-800 mb-4",children:c("tds.selectMode")}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:()=>t("normal"),className:"w-full bg-brand-50 hover:bg-brand-100 border-2 border-brand-200 rounded-xl p-4 text-left transition-colors",children:[e.jsx("div",{className:"font-bold text-brand-800",children:c("tds.normalMode")}),e.jsx("div",{className:"text-sm text-gray-600",children:c("tds.normalDesc")})]}),e.jsxs("button",{onClick:()=>t("expert"),className:"w-full bg-amber-50 hover:bg-amber-100 border-2 border-amber-200 rounded-xl p-4 text-left transition-colors",children:[e.jsx("div",{className:"font-bold text-amber-800",children:c("tds.expertMode")}),e.jsx("div",{className:"text-sm text-gray-600",children:c("tds.expertDesc")})]})]}),e.jsx("button",{onClick:w,className:"mt-4 w-full text-gray-500 hover:text-gray-700 py-2",children:c("tds.cancel")})]})})},He=t=>{const{language:w,t:c}=ee(),[b,s]=x.useState(!1),[p,y]=x.useState(!0),[i,f]=x.useState(!1),[v,n]=x.useState(null),N=()=>({sampleCode:"",date:"",time:"",evaluator:"",evaluationType:"cacao_mass",sampleInfo:"",notes:"",producerRecommendations:""}),[o,j]=x.useState({metadata:N(),attributes:JSON.parse(JSON.stringify(Y)),globalQuality:0,language:"en"}),[I]=x.useState(JSON.parse(JSON.stringify(ie)));return x.useEffect(()=>{j(d=>({...d,language:w}))},[w]),x.useEffect(()=>{t&&(async()=>{const m=await J.getSample(t);m&&(j({metadata:{sampleCode:m.sampleCode,date:m.date,time:m.time,evaluator:m.evaluator,evaluationType:m.evaluationType,sampleInfo:m.sampleInfo,notes:m.notes,producerRecommendations:m.producerRecommendations},attributes:m.attributes,globalQuality:m.globalQuality,selectedQualityId:m.selectedQualityId,language:w,tdsProfile:m.tdsProfile}),s(!0))})()},[t,w]),{session:o,setSession:j,qualityAttributes:I,isEvaluationStarted:b,setIsEvaluationStarted:s,isGlobalQualityExpanded:p,setIsGlobalQualityExpanded:y,showPostSaveModal:i,setShowPostSaveModal:f,validationError:v,setValidationError:n,getInitialMetadata:N,handlers:{handleMetadataChange:(d,m)=>{j(k=>({...k,metadata:{...k.metadata,[d]:m}}))},handleAttributeChange:(d,m)=>{j(k=>{const l=k.attributes.map(g=>g.id===d?{...g,score:m}:g);return{...k,attributes:l}})},handleSubAttributeChange:(d,m,k)=>{j(l=>{const g=l.attributes.map(h=>{if(h.id===d&&h.subAttributes){const T=h.subAttributes.map(L=>L.id===m?{...L,score:k}:L);let z=h.score;return h.isCalculated&&(z=V.scoring.calculateAttributeScore(h.id,T)),{...h,score:z,subAttributes:T}}return h});return{...l,attributes:g}})},handleSubAttributeDescription:(d,m,k)=>{j(l=>{const g=l.attributes.map(h=>h.id===d&&h.subAttributes?{...h,subAttributes:h.subAttributes.map(T=>T.id===m?{...T,description:k}:T)}:h);return{...l,attributes:g}})},handleQualitySelect:d=>{j(m=>({...m,selectedQualityId:d}))},handleStartEvaluation:()=>{const d=je(),m=we();j(k=>({...k,metadata:{...k.metadata,date:d,time:m}})),s(!0)},handleReset:async d=>{const m=d||window.confirm;await Promise.resolve(m(c("confirmReset")))&&(j({metadata:N(),attributes:JSON.parse(JSON.stringify(Y)),globalQuality:0,language:w}),s(!1),window.scrollTo(0,0))},handleSaveToLibrary:async(d,m)=>{const k=m||(async l=>window.confirm(l));try{const l=o.metadata.sampleCode.trim(),g=o.metadata.evaluator.trim(),h=o.metadata.date;if(!l||!g||!h){const D=[];l||D.push(w==="es"?"Código de Muestra":"Sample Code"),g||D.push(w==="es"?"Evaluador":"Evaluator"),h||D.push(w==="es"?"Fecha":"Date"),n(c("validation.missingFields",{fields:D.join(`
- `)}));return}const z=V.meta.primaryAttributeIds.filter(D=>{const O=o.attributes.find(R=>R.id===D);return!O||O.score<=0});if(z.length>0){const D=z.map(R=>{const _=o.attributes.find(re=>re.id===R);return w==="es"?_==null?void 0:_.nameEs:_==null?void 0:_.nameEn}).join(", ");if(!await k(c("validation.zeroAttributes",{attributes:D})))return}if(o.globalQuality<=0&&!await k(c("validation.zeroGlobalQuality")))return;const F=(await J.searchBySampleCode(l)).find(D=>D.sampleCode.toLowerCase()===l.toLowerCase()&&D.evaluator.toLowerCase()===g.toLowerCase()&&D.date===h);let M=t;if(F)if(t&&F.id===t)M=t;else{if(!await k(c("validation.overwriteSample",{code:l,evaluator:g,date:h})))return;M=F.id}const G={sampleCode:o.metadata.sampleCode,date:o.metadata.date,time:o.metadata.time,evaluator:o.metadata.evaluator,evaluationType:o.metadata.evaluationType,sampleInfo:o.metadata.sampleInfo,notes:o.metadata.notes,producerRecommendations:o.metadata.producerRecommendations,attributes:o.attributes,globalQuality:o.globalQuality,selectedQualityId:o.selectedQualityId,language:w,tdsProfile:o.tdsProfile},u=await J.saveSample(G,M||void 0);n(null),u!==t&&d(`/evaluate?id=${u}`,{replace:!0}),f(!0)}catch(l){console.error("Failed to save sample:",l),n(c("validation.saveFailed",{error:l}))}},applyTDSData:(d,m,k=!0)=>{let l=o.attributes;k&&(l=be(o.attributes,m.scores));const g={...d,analysis:m};j(h=>({...h,attributes:l,tdsProfile:g})),s(!0)}}}},Ge=({onApply:t,onStartEvaluation:w})=>{const[c,b]=x.useState(!1),[s,p]=x.useState(!1),[y,i]=x.useState(!1),[f,v]=x.useState("normal"),[n,N]=x.useState(null);return{state:{showTDSModeSelect:c,showTDSProfiler:s,showTDSSummary:y,tdsMode:f,tdsProfile:n},actions:{setShowTDSModeSelect:b,setShowTDSProfiler:p,setShowTDSSummary:i,setTdsProfile:N,handleStartTDS:()=>{w(),b(!0)},handleTDSModeSelect:$=>{v($),b(!1),p(!0)},handleTDSComplete:$=>{N($),p(!1),i(!0)},handleTDSApply:($,A)=>{n&&t(n,A,!0),i(!1)},handleTDSDiscard:()=>{N(null),i(!1)},handleTDSSave:()=>{if(n){const $=se(n);t(n,$,!1)}i(!1)}}}},at=()=>{const{language:t,setLanguage:w,t:c}=ee(),b=de(),[s]=ce(),p=s.get("id"),y=x.useRef(null),[i,f]=x.useState(null),v=u=>new Promise(D=>{f({message:u,resolve:D})}),n=()=>{i&&(i.resolve(!0),f(null))},N=()=>{i&&(i.resolve(!1),f(null))},{session:o,setSession:j,qualityAttributes:I,isEvaluationStarted:S,setIsEvaluationStarted:E,isGlobalQualityExpanded:C,setIsGlobalQualityExpanded:$,showPostSaveModal:A,setShowPostSaveModal:P,validationError:Q,setValidationError:a,getInitialMetadata:r,handlers:{handleMetadataChange:d,handleAttributeChange:m,handleSubAttributeChange:k,handleSubAttributeDescription:l,handleQualitySelect:g,handleStartEvaluation:h,handleReset:T,handleSaveToLibrary:z,applyTDSData:L}}=He(p),{state:F,actions:M}=Ge({onApply:L,onStartEvaluation:h}),G=u=>V.meta.primaryAttributeIds.includes(u);return e.jsxs("div",{id:"evaluate-content",className:"w-full px-4 md:px-8 space-y-8 mb-8 flex-grow",children:[e.jsxs("section",{className:"bg-white p-6 rounded-xl shadow-sm border border-brand-100 transition-opacity",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-6 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-1",children:c("evaluator")}),e.jsx("input",{type:"text",value:o.metadata.evaluator,onChange:u=>d("evaluator",u.target.value),className:"w-full p-2 bg-gray-50 border rounded-md disabled:bg-gray-100"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-1",children:[c("date")," / ",c("time")]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative w-full",children:[e.jsx("input",{type:"date",required:!0,value:o.metadata.date,onChange:u=>d("date",u.target.value),className:`w-full p-2 bg-gray-50 border rounded-md disabled:bg-gray-100 ${t==="es"&&o.metadata.date?"text-transparent":""}`}),t==="es"&&o.metadata.date&&e.jsx("div",{className:"absolute inset-0 flex items-center pl-2 pointer-events-none text-gray-800 p-2 bg-gray-50 border border-transparent rounded-md",children:(()=>{const[u,D,O]=o.metadata.date.split("-");return`${O}/${D}/${u}`})()})]}),e.jsx("input",{type:"time",value:o.metadata.time,onChange:u=>d("time",u.target.value),className:"w-32 p-2 bg-gray-50 border rounded-md disabled:bg-gray-100"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-1",children:c("code")}),e.jsx("input",{type:"text",value:o.metadata.sampleCode,onChange:u=>d("sampleCode",u.target.value),className:"w-full p-2 bg-gray-50 border rounded-md font-mono disabled:bg-gray-100"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-1",children:c("evaluationType")}),e.jsxs("select",{value:o.metadata.evaluationType,onChange:u=>d("evaluationType",u.target.value),className:"w-full p-2 bg-gray-50 border rounded-md disabled:bg-gray-100",children:[e.jsx("option",{value:"cacao_mass",children:c("cacaoMass")}),e.jsx("option",{value:"chocolate",children:c("chocolate")})]})]})]}),e.jsx("div",{className:"grid grid-cols-1",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-1",children:c("sampleInfoLabel")}),e.jsx("input",{type:"text",value:o.metadata.sampleInfo,onChange:u=>d("sampleInfo",u.target.value),className:"w-full p-2 bg-gray-50 border rounded-md disabled:bg-gray-100"})]})})]}),!S&&e.jsxs("div",{className:"flex flex-col sm:flex-row justify-center gap-4",children:[e.jsxs("button",{type:"button",onClick:h,className:"bg-brand-600 hover:bg-brand-700 text-white font-bold py-3 px-8 rounded-full shadow-lg transition-transform transform hover:scale-105 flex items-center gap-2",children:[e.jsx(Me,{size:20,fill:"currentColor"}),c("startEvaluation")]}),e.jsxs("button",{type:"button",onClick:M.handleStartTDS,className:"bg-amber-600 hover:bg-amber-700 text-white font-bold py-3 px-8 rounded-full shadow-lg transition-transform transform hover:scale-105 flex items-center gap-2",children:[e.jsx(ue,{size:20}),t==="es"?"Perfil TDS":"TDS Profile"]})]}),e.jsxs("div",{className:`grid grid-cols-1 lg:grid-cols-3 gap-8 transition-opacity ${S?"opacity-100":"opacity-50"}`,children:[e.jsx("div",{className:"lg:col-span-2 space-y-8",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-bold text-brand-700 sticky top-20 bg-brand-50 py-2 z-10",children:c("basicAttributes")}),o.attributes.map(u=>{var O;const D=G(u.id);return e.jsx(Qe,{id:u.id,label:t==="es"?u.nameEs:u.nameEn,value:u.score,subAttributes:(O=u.subAttributes)==null?void 0:O.map(R=>({...R,name:t==="es"?R.nameEs:R.nameEn})),onChange:R=>m(u.id,R),onSubAttributeChange:(R,_)=>k(u.id,R,_),onSubAttributeDescriptionChange:u.id==="defects"?(R,_)=>l(u.id,R,_):void 0,language:t,customColor:B(u.id),isCalculated:u.isCalculated,disabled:!S,defaultExpanded:D},u.id)})]})}),e.jsx("div",{className:"lg:col-span-1 space-y-6",children:e.jsxs("div",{className:"lg:sticky lg:top-24 space-y-6",children:[e.jsxs("div",{className:`bg-white rounded-xl shadow-sm border border-brand-100 transition-all overflow-hidden ${S?"":"opacity-80 pointer-events-none"}`,children:[e.jsxs("button",{onClick:()=>$(!C),disabled:!S,"aria-expanded":C,"aria-controls":"global-quality-content",className:"w-full p-4 flex justify-between items-center hover:bg-brand-50 transition-colors active:bg-brand-100 touch-manipulation min-h-[44px]",children:[e.jsx("span",{className:"text-sm font-bold text-brand-800 uppercase tracking-wide",children:c("globalScore")}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-2xl font-mono font-bold text-brand-800 min-w-[3rem] text-right",children:o.globalQuality}),C?e.jsx(ne,{size:20,className:"text-gray-600 flex-shrink-0"}):e.jsx(ae,{size:20,className:"text-gray-600 flex-shrink-0"})]})]}),e.jsx("div",{id:"global-quality-content",className:"transition-all duration-300 ease-in-out",style:{maxHeight:C?"500px":"0",opacity:C?1:0},children:e.jsxs("div",{className:"px-4 pb-4 space-y-6",children:[e.jsx("div",{children:e.jsx("div",{className:"flex items-center gap-4 touch-pan-y",children:e.jsx("input",{type:"range",min:"0",max:"10",step:"0.5",value:o.globalQuality,onChange:u=>j(D=>({...D,globalQuality:parseFloat(u.target.value)})),disabled:!S,className:`w-full h-8 md:h-4 bg-gray-200 rounded-lg appearance-none accent-brand-800 touch-pan-y ${S?"cursor-pointer":"cursor-not-allowed"}`})})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-bold text-gray-700 uppercase mb-2",children:c("qualityCharacteristic")}),e.jsxs("select",{value:o.selectedQualityId||"",onChange:u=>g(u.target.value),disabled:!S,className:"w-full p-2 bg-gray-50 border border-gray-200 rounded-lg text-sm focus:border-brand-500 focus:ring-1 focus:ring-brand-500 disabled:bg-gray-100 outline-none transition-all",children:[e.jsx("option",{value:"",children:t==="es"?"Seleccionar...":"Select..."}),I.map(u=>e.jsx("option",{value:u.id,children:t==="es"?u.nameEs:u.nameEn},u.id))]})]})]})})]}),e.jsxs("div",{className:`bg-white p-6 rounded-xl shadow-sm border border-brand-100 space-y-4 transition-opacity ${S?"":"opacity-80 pointer-events-none"}`,children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-1",children:c("flavorNotes")}),e.jsx("textarea",{className:"w-full p-3 bg-gray-50 border rounded-lg h-24 text-sm disabled:bg-gray-100",value:o.metadata.notes,onChange:u=>d("notes",u.target.value),disabled:!S})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-1",children:c("producerFeedback")}),e.jsx("textarea",{className:"w-full p-3 bg-gray-50 border rounded-lg h-24 text-sm disabled:bg-gray-100",value:o.metadata.producerRecommendations,onChange:u=>d("producerRecommendations",u.target.value),disabled:!S})]})]}),e.jsx(me,{ref:y,attributes:o.attributes}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-3 pt-2",children:[e.jsxs("button",{type:"button",onClick:()=>z(b,v),disabled:!S,className:"w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 rounded-xl shadow-md transition-colors flex justify-center items-center gap-2 border border-green-600 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(ze,{size:20}),t==="es"?"Guardar en Biblioteca":"Save to Library"]}),e.jsxs("button",{type:"button",onClick:()=>b("/samples"),className:"w-full bg-white border border-brand-200 text-brand-700 font-bold py-3 rounded-xl shadow-sm hover:bg-brand-50 transition-colors flex justify-center items-center gap-2",children:[e.jsx(K,{size:20}),t==="es"?"Ver Biblioteca":"View Library"]})]}),e.jsxs("button",{type:"button",onClick:()=>T(v),className:"w-full bg-white border border-gray-300 text-gray-600 font-medium py-3 rounded-xl hover:bg-gray-50 transition-colors flex justify-center items-center gap-2 shadow-sm",children:[e.jsx(ge,{size:18})," ",c("reset")]})]})]})})]}),A&&e.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm animate-in fade-in duration-200",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl p-6 w-full max-w-md space-y-6 transform scale-100 animate-in zoom-in-95 duration-200",children:[e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 text-green-600 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(pe,{size:32})}),e.jsx("h3",{className:"text-2xl font-bold text-gray-800",children:t==="es"?"¡Muestra Guardada!":"Sample Saved!"}),e.jsx("p",{className:"text-gray-500",children:t==="es"?"¿Qué operación desea realizar?":"What would you like to do next?"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:()=>b("/samples"),className:"w-full bg-white border border-gray-200 hover:bg-gray-50 text-gray-800 font-bold py-3 rounded-xl transition-colors flex items-center justify-center gap-3 shadow-sm",children:[e.jsx(K,{size:20,className:"text-brand-600"}),c("sampleLibrary")]}),e.jsxs("button",{onClick:()=>{j({metadata:r(),attributes:JSON.parse(JSON.stringify(Y)),globalQuality:0,language:t}),E(!1),P(!1),window.scrollTo(0,0),b("/evaluate")},className:"w-full bg-brand-600 hover:bg-brand-700 text-white font-bold py-3 rounded-xl transition-colors flex items-center justify-center gap-3 shadow-md",children:[e.jsx(fe,{size:20}),c("newEvaluation")]}),e.jsx("button",{onClick:()=>P(!1),className:"w-full bg-gray-100 hover:bg-gray-200 text-gray-700 font-bold py-3 rounded-xl transition-colors flex items-center justify-center gap-2",children:t==="es"?"Seguir editando":"Keep editing"})]})]})}),F.showTDSModeSelect&&e.jsx(Ve,{onSelect:M.handleTDSModeSelect,onCancel:()=>M.setShowTDSModeSelect(!1)}),F.showTDSProfiler&&e.jsx(Be,{mode:F.tdsMode,onComplete:M.handleTDSComplete,onCancel:()=>M.setShowTDSProfiler(!1)}),F.showTDSSummary&&F.tdsProfile&&e.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-2 sm:p-6 bg-black/60 backdrop-blur-sm animate-in fade-in duration-200",children:e.jsx("div",{className:"w-full max-w-4xl",children:e.jsx(Ue,{profile:F.tdsProfile,onApply:M.handleTDSApply,onDiscard:M.handleTDSDiscard,onSave:M.handleTDSSave})})}),e.jsx(ye,{isOpen:!!Q,onClose:()=>a(null),message:Q||""}),e.jsx(ve,{isOpen:!!i,onClose:N,onConfirm:n,message:(i==null?void 0:i.message)||""}),e.jsx(Le,{attributes:o.attributes,language:t,isEvaluationStarted:S})]})};export{at as default};
