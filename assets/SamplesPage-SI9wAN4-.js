const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/csvService-Tbi3N3dr.js","assets/index-Dw65S7rK.js","assets/index-Dpm_cgo4.css","assets/tdsCalculator-D11FdiJf.js","assets/pdfService-DmDZiJ0F.js","assets/jspdf.es.min-DntnpIfp.js","assets/attributes-zDdy4c7G.js","assets/index-rBm6tBrN.js","assets/createLucideIcon-D7ZCby8C.js","assets/colors-C8jCGJn0.js","assets/dateUtils-BSM0ms4X.js"])))=>i.map(i=>d[i]);
import{u as O,r as C,j as e,b as K,_ as L,C as X,d as J}from"./index-Dw65S7rK.js";import{dbService as V}from"./dbService-8xAAiJd6.js";import{b as R}from"./dateUtils-BSM0ms4X.js";import{X as Y,H as ee,F as te}from"./Footer-DleAzZSZ.js";import{S as ae,a as se,b as re}from"./SampleLibraryCard-CM6UQB5o.js";import{U as oe,P as ne}from"./papaparse.min-D0CWfYx1.js";import{V as le}from"./ValidationModal-BpyN9KUF.js";import{P as ie,C as ce}from"./ConfirmationModal-DPVuQRMM.js";import{c as A}from"./createLucideIcon-D7ZCby8C.js";import"./index-rBm6tBrN.js";import"./colors-C8jCGJn0.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]],me=A("Download",de);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=[["path",{d:"M15.707 21.293a1 1 0 0 1-1.414 0l-1.586-1.586a1 1 0 0 1 0-1.414l5.586-5.586a1 1 0 0 1 1.414 0l1.586 1.586a1 1 0 0 1 0 1.414z",key:"nt11vn"}],["path",{d:"m18 13-1.375-6.874a1 1 0 0 0-.746-.776L3.235 2.028a1 1 0 0 0-1.207 1.207L5.35 15.879a1 1 0 0 0 .776.746L13 18",key:"15qc1e"}],["path",{d:"m2.3 2.3 7.286 7.286",key:"1wuzzi"}],["circle",{cx:"11",cy:"11",r:"2",key:"xmgehs"}]],pe=A("PenTool",ue);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]],xe=A("Search",he),ge=t=>t.split(/\s+OR\s+/i).map(v=>{const p=[],f=/([a-zA-Z_]+)\s*(>=|<=|>|<|=|:)\s*([0-9.]+|"[^"]+"|\S+)/g;let l;for(;(l=f.exec(v))!==null;){const[u,o,s,x]=l;let i=x.replace(/^"(.*)"$/,"$1");const d=parseFloat(i);isNaN(d)||(i=d),p.push({key:o.toLowerCase(),operator:s,value:i})}const y=v.replace(f,"").trim();return y&&y.split(/\s+/).forEach(o=>p.push({text:o.toLowerCase()})),p}),fe=(t,h)=>ge(h).some(p=>p.every(f=>{if("text"in f){const l=f.text;return!!(t.sampleCode.toLowerCase().includes(l)||t.evaluator.toLowerCase().includes(l)||t.evaluationType.toLowerCase().includes(l)||l==="tds"&&t.tdsProfile&&t.tdsProfile.events.length>0)}else{const{key:l,operator:y,value:u}=f;let o;if(l==="score")o=t.globalQuality;else if(l==="year")o=parseInt(t.date.substring(0,4));else if(l==="date")o=t.date;else{const s=t.attributes.find(x=>x.nameEn.toLowerCase().startsWith(l)||x.nameEs.toLowerCase().startsWith(l));s&&(o=s.score)}if(o===void 0)return!1;if(typeof u=="number"&&typeof o=="number")switch(y){case">":return o>u;case">=":return o>=u;case"<":return o<u;case"<=":return o<=u;case"=":return o===u;case":":return o===u;default:return!1}else{const s=String(o).toLowerCase(),x=String(u).toLowerCase();return y==="="||y===":"?s.includes(x):!1}}})),ye=({isOpen:t,onClose:h,onConfirm:v,title:p,message:f,defaultValue:l="",placeholder:y="",confirmLabel:u})=>{const{language:o}=O(),[s,x]=C.useState(l);if(C.useEffect(()=>{t&&x(l)},[t,l]),!t)return null;const i=d=>{d==null||d.preventDefault(),v(s),h()};return e.jsx("div",{className:"fixed inset-0 z-[70] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in duration-200",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl w-full max-w-md overflow-hidden transform scale-100 animate-in zoom-in-95 duration-200",children:[e.jsxs("div",{className:"p-4 flex items-center justify-between bg-cacao-50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-full bg-cacao-100 text-cacao-600",children:e.jsx(pe,{size:20})}),e.jsx("h3",{className:"font-bold text-lg text-cacao-900",children:p||(o==="es"?"Ingresar Dato":"Enter Data")})]}),e.jsx("button",{onClick:h,className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(Y,{size:24})})]}),e.jsxs("div",{className:"p-6",children:[f&&e.jsx("p",{className:"font-medium text-gray-800 mb-4",children:f}),e.jsx("form",{onSubmit:i,children:e.jsx("input",{type:"text",value:s,onChange:d=>x(d.target.value),placeholder:y,className:"w-full p-3 bg-gray-50 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-cacao-500 focus:bg-white transition-all font-medium",autoFocus:!0})})]}),e.jsxs("div",{className:"p-4 bg-gray-50 flex justify-end gap-3",children:[e.jsx("button",{onClick:h,className:"px-5 py-2.5 bg-white border border-gray-300 text-gray-700 font-bold rounded-xl hover:bg-gray-50 transition-colors shadow-sm",children:o==="es"?"Cancelar":"Cancel"}),e.jsx("button",{onClick:()=>i(),disabled:!s.trim(),className:"px-6 py-2.5 bg-cacao-600 hover:bg-cacao-700 disabled:opacity-50 disabled:cursor-not-allowed text-white font-bold rounded-xl transition-colors shadow-sm",children:u||(o==="es"?"Aceptar":"OK")})]})]})})},ze=()=>{const{language:t,t:h}=O(),v=K(),[p,f]=C.useState([]),[l,y]=C.useState(!0),[u,o]=C.useState(""),[s,x]=C.useState(new Set),[i,d]=C.useState(null),[w,z]=C.useState(null),[g,_]=C.useState(null);C.useEffect(()=>{$()},[]);const $=async()=>{try{y(!0);const a=await V.getAllSamples();f(a)}catch(a){console.error("Failed to load samples:",a)}finally{y(!1)}},q=(a,m)=>{z({message:t==="es"?`¿Eliminar muestra ${m}?`:`Delete sample ${m}?`,isDangerous:!0,onConfirm:async()=>{try{await V.deleteSample(a),f(r=>r.filter(j=>j.id!==a)),x(r=>{const j=new Set(r);return j.delete(a),j})}catch(r){console.error("Failed to delete sample:",r)}}})},Q=a=>{x(m=>{const r=new Set(m);return r.has(a)?r.delete(a):r.add(a),r})},T=p.filter(a=>fe(a,u)),P=s.size>0&&Array.from(s).every(a=>{const m=p.find(r=>r.id===a);return(m==null?void 0:m.tdsProfile)&&Object.keys(m.tdsProfile).length>0}),H=()=>{if(s.size===0||!P)return;const a=Array.from(s).join(",");v(`/tds-deep?ids=${a}`)},M=()=>{if(s.size<2){d({msg:t==="es"?"Seleccione al menos 2 muestras para comparar":"Select at least 2 samples to compare"});return}const a=Array.from(s).join(",");v(`/compare?ids=${a}`)},U=async()=>{const a=s.size>0?p.filter(r=>s.has(r.id)):p;if(a.length===0)return;const m=`cacao_eval_${R()}`;_({title:t==="es"?"Exportar CSV":"Export CSV",message:t==="es"?"Nombre del archivo CSV:":"Enter filename for CSV:",defaultValue:m,onConfirm:async r=>{const j=r.endsWith(".csv")?r:`${r}.csv`,{generateCSVRow:S}=await L(async()=>{const{generateCSVRow:E}=await import("./csvService-Tbi3N3dr.js");return{generateCSVRow:E}},__vite__mapDeps([0,1,2,3])),k=t==="es"?X:J,n=a.map(E=>S(E,t)),D="data:text/csv;charset=utf-8,"+[k.join(","),...n.map(E=>E.join(","))].join(`
`),c=encodeURI(D),N=document.createElement("a");N.setAttribute("href",c),N.setAttribute("download",j),document.body.appendChild(N),N.click(),document.body.removeChild(N)}})},B=async()=>{if(s.size===0)return;const a=p.filter(r=>s.has(r.id)),m=`cacao_eval_${R()}`;_({title:t==="es"?"Exportar PDF":"Export PDF",message:t==="es"?"Nombre del archivo PDF:":"Enter filename for PDF:",defaultValue:m,onConfirm:async r=>{const j=r;try{const{generatePdf:S}=await L(async()=>{const{generatePdf:n}=await import("./pdfService-DmDZiJ0F.js");return{generatePdf:n}},__vite__mapDeps([4,5,1,2,6,7,8,9,3,10])),k=a.map(n=>({metadata:{sampleCode:n.sampleCode,date:n.date,time:n.time,evaluator:n.evaluator,evaluationType:n.evaluationType,sampleInfo:n.sampleInfo,notes:n.notes,producerRecommendations:n.producerRecommendations},attributes:n.attributes,globalQuality:n.globalQuality,selectedQualityId:n.selectedQualityId,language:t,tdsProfile:n.tdsProfile}));await S(k,void 0,j)}catch(S){console.error("PDF Export failed",S),d({msg:t==="es"?"Error al generar PDF":"Failed to generate PDF"})}}})},W=()=>{var a;(a=document.getElementById("csv-import-input"))==null||a.click()},G=a=>{var r;const m=(r=a.target.files)==null?void 0:r[0];m&&(ne.parse(m,{header:!0,skipEmptyLines:!0,complete:async j=>{try{const{parseSamplesFromCSV:S}=await L(async()=>{const{parseSamplesFromCSV:c}=await import("./csvService-Tbi3N3dr.js");return{parseSamplesFromCSV:c}},__vite__mapDeps([0,1,2,3])),k=S(j.data,t),n=k.filter(c=>c.sampleCode&&c.date&&c.evaluator),D=k.length-n.length;if(D>0&&d({type:"warning",title:t==="es"?"Importación Incompleta":"Incomplete Import",msg:t==="es"?`Se omitieron ${D} entradas por faltar datos de identificación (Código, Fecha o Evaluador).`:`Skipped ${D} entries due to missing identification data (Code, Date, or Evaluator).`}),n.length>0){const c=[];n.forEach((b,Z)=>{const I=p.find(F=>F.sampleCode.toLowerCase()===b.sampleCode.toLowerCase()&&F.evaluator.toLowerCase()===b.evaluator.toLowerCase()&&F.date===b.date);I&&c.push({importIdx:Z,existingId:I.id,code:b.sampleCode,createdAt:I.createdAt})});const N=[...n],E=async()=>{c.forEach(b=>{N[b.importIdx]={...N[b.importIdx],id:b.existingId,createdAt:b.createdAt}}),await V.importSamples(N),await $(),d({title:t==="es"?"Importación Exitosa":"Import Successful",type:"info",msg:t==="es"?`Proceso finalizado: ${c.length} reemplazadas, ${n.length-c.length} nuevas.`:`Process complete: ${c.length} replaced, ${n.length-c.length} new samples imported.`})};if(c.length>0){const b=t==="es"?`Se encontraron ${c.length} muestras duplicadas (mismo Código, Evaluador y Fecha). 

Si continúa, estas muestras serán REEMPLAZADAS con los datos del CSV.

¿Desea continuar?`:`Found ${c.length} duplicate samples (same Code, Evaluator, and Date). 

Proceeding will REPLACE these samples with the data from the CSV.

Do you want to proceed?`;z({message:b,onConfirm:E})}else await E()}else d({msg:t==="es"?"No se encontraron muestras válidas en el archivo CSV.":"No valid samples found in CSV."})}catch(S){console.error("Import failed",S),d({msg:t==="es"?"Error al importar muestras.":"Failed to import samples."})}}}),a.target.value="")};return e.jsxs("div",{className:"flex flex-col min-h-screen bg-cacao-50 text-gray-800 font-sans",children:[e.jsx(ee,{}),e.jsx("input",{type:"file",id:"csv-import-input",accept:".csv, text/csv, application/vnd.ms-excel",className:"hidden",onChange:G}),e.jsxs("main",{className:"w-full px-4 md:px-8 space-y-6 mb-8 flex-grow",children:[e.jsx("div",{className:"bg-white p-4 rounded-xl shadow-sm border border-cacao-100 flex flex-col gap-4",children:e.jsxs("div",{className:"flex flex-col lg:flex-row justify-between gap-4",children:[e.jsxs("div",{className:"relative w-full lg:w-96 flex-shrink-0 z-20",children:[e.jsx(xe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:20}),e.jsx("input",{type:"text",placeholder:h.searchSamples||"Search samples...",value:u,onChange:a=>o(a.target.value),className:"w-full pl-10 pr-10 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-cacao-500 focus:bg-white transition-all"}),e.jsxs("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2 group",children:[e.jsx("span",{className:"text-gray-400 cursor-help text-xs font-bold border border-gray-300 rounded-full w-5 h-5 flex items-center justify-center",children:"?"}),e.jsxs("div",{className:"absolute right-0 top-8 w-64 p-3 bg-gray-800 text-white text-xs rounded-lg shadow-xl opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-50",children:[e.jsx("p",{className:"font-bold mb-1",children:"Advanced Filters:"}),e.jsxs("ul",{className:"space-y-1 text-gray-300",children:[e.jsx("li",{children:e.jsxs("code",{children:["score ",">"," 8"]})}),e.jsx("li",{children:e.jsxs("code",{children:["acidity ",">="," 5"]})}),e.jsx("li",{children:e.jsx("code",{children:"date : 2024"})}),e.jsx("li",{children:e.jsxs("code",{children:["cocoa OR score ",">"," 9"]})})]})]})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 lg:justify-end",children:[e.jsxs("div",{className:"flex items-center gap-1 bg-gray-50 p-1 rounded-lg border border-gray-100",children:[e.jsx("button",{onClick:W,className:"p-2 text-cacao-700 hover:bg-white hover:text-cacao-900 hover:shadow-sm rounded-md transition-all",title:h.importSamples,children:e.jsx(oe,{size:20})}),e.jsx("div",{className:"w-px h-6 bg-gray-200"}),e.jsx("button",{onClick:U,className:"p-2 text-cacao-700 hover:bg-white hover:text-cacao-900 hover:shadow-sm rounded-md transition-all",title:h.exportAllCSV,children:e.jsx(me,{size:20})})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("button",{onClick:()=>x(new Set),disabled:s.size===0,className:`px-3 py-2.5 rounded-xl border text-sm font-bold flex items-center gap-2 transition-all duration-200 ${s.size>0?"bg-cacao-100 text-cacao-900 border-cacao-200 hover:bg-cacao-200 hover:border-cacao-300 cursor-pointer shadow-sm":"bg-gray-50 text-gray-400 border-gray-100 cursor-default opacity-60"}`,title:"Clear Selection",children:[s.size>0?e.jsx(ae,{size:16}):e.jsx(se,{size:16}),e.jsxs("span",{className:"hidden sm:inline",children:[s.size," ",t==="es"?"Seleccionadas":"Selected"]}),e.jsx("span",{className:"sm:hidden",children:s.size})]}),e.jsx("button",{onClick:H,disabled:s.size===0||!P,className:`font-bold py-2.5 px-4 rounded-xl shadow-sm transition-colors ${s.size>0&&P?"bg-orange-500 hover:bg-orange-600 text-white border-transparent":"bg-gray-100 text-gray-400 border border-gray-200 cursor-not-allowed"}`,title:P?"TDS Analysis":"No TDS Data",children:"TDS"}),e.jsx("button",{onClick:B,disabled:s.size===0,className:`font-bold py-2.5 px-4 rounded-xl shadow-sm transition-colors ${s.size===0?"bg-gray-100 text-gray-400 border border-gray-200 cursor-not-allowed":"bg-amber-600 hover:bg-amber-700 text-white border border-transparent"}`,title:t==="es"?"Descargar PDF":"Download PDF",children:"PDF"})]}),e.jsxs("div",{className:"flex items-center gap-2 ml-auto lg:ml-0",children:[e.jsx("button",{onClick:M,disabled:s.size<2,className:`font-bold py-2.5 px-5 rounded-xl shadow-md transition-colors ${s.size<2?"bg-gray-200 text-gray-400 cursor-not-allowed":"bg-white text-cacao-800 border-2 border-cacao-800 hover:bg-cacao-50"}`,children:h.compare||"Compare"}),e.jsx("button",{onClick:()=>v("/evaluate"),className:"bg-cacao-600 hover:bg-cacao-700 text-white font-bold p-2.5 rounded-xl shadow-md transition-colors flex items-center justify-center aspect-square",title:h.newEvaluation,children:e.jsx(ie,{size:24})})]})]})]})}),l?e.jsx("div",{className:"text-center py-20 text-gray-500",children:"Loading samples..."}):T.length===0?e.jsxs("div",{className:"text-center py-20 bg-white rounded-xl border border-dashed border-gray-300",children:[e.jsx("p",{className:"text-gray-500 mb-4",children:h.noSamples||"No samples found"}),e.jsx("button",{onClick:()=>v("/evaluate"),className:"text-cacao-600 font-bold hover:underline",children:"Start your first evaluation"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4 gap-6",children:T.map(a=>e.jsx(re,{sample:a,isSelected:s.has(a.id),onToggleSelect:Q,onDelete:q},a.id))})]}),e.jsx(te,{}),e.jsx(le,{isOpen:!!i,onClose:()=>d(null),title:i==null?void 0:i.title,message:(i==null?void 0:i.msg)||"",type:(i==null?void 0:i.type)||"error"}),e.jsx(ce,{isOpen:!!w,onClose:()=>z(null),onConfirm:(w==null?void 0:w.onConfirm)||(()=>{}),message:(w==null?void 0:w.message)||"",isDangerous:w==null?void 0:w.isDangerous}),e.jsx(ye,{isOpen:!!g,onClose:()=>_(null),onConfirm:(g==null?void 0:g.onConfirm)||(()=>{}),title:g==null?void 0:g.title,message:g==null?void 0:g.message,defaultValue:g==null?void 0:g.defaultValue})]})};export{ze as default};
