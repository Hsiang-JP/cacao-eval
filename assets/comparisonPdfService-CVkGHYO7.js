import{E as B}from"./jspdf.es.min-CuvU_NwC.js";import{C as R,r as _}from"./index-3Ey7Uc7E.js";import{f as O,b as P}from"./dateUtils-BSM0ms4X.js";import{A as L}from"./attributes-zDdy4c7G.js";import"./index-Cc-s5RXY.js";const k=(i,m)=>{if(i.includes("|"))return i.split("|").map(t=>k(t.trim(),m)).join(" | ");const n=L[i];return n?m==="es"?n.es:n.en:i};R.register(..._);const f=[{border:"#E74A89",background:"rgba(231, 74, 137, 0.2)"},{border:"#3B82F6",background:"rgba(59, 130, 246, 0.2)"},{border:"#F5A524",background:"rgba(245, 165, 36, 0.2)"},{border:"#10B981",background:"rgba(16, 185, 129, 0.2)"},{border:"#8B5CF6",background:"rgba(139, 92, 246, 0.2)"},{border:"#EF4444",background:"rgba(239, 68, 68, 0.2)"},{border:"#06B6D4",background:"rgba(6, 182, 212, 0.2)"},{border:"#F97316",background:"rgba(249, 115, 22, 0.2)"},{border:"#84CC16",background:"rgba(132, 204, 22, 0.2)"},{border:"#EC4899",background:"rgba(236, 72, 153, 0.2)"}],M=(i,m)=>new Promise(n=>{const t=document.createElement("canvas");t.width=1e3,t.height=1e3;const c=t.getContext("2d");if(!c){n("");return}c.fillStyle="#FFFFFF",c.fillRect(0,0,t.width,t.height);const e=["cacao","acidity","bitterness","astringency","fresh_fruit","browned_fruit","vegetal","floral","woody","spice","nutty","caramel","sweetness","defects","roast"],p=a=>{const o=L[a];return o?(m==="es"?o.es:o.en).toUpperCase():a.toUpperCase()},s=e.map(p),F=i.map((a,o)=>{const l=f[o%f.length],C=e.map(z=>{const x=a.attributes.find(r=>r.id===z);return x?x.score:0});return{label:a.sampleCode,data:C,backgroundColor:l.background,borderColor:l.border,borderWidth:2,pointBackgroundColor:l.border,pointRadius:3,fill:!0}}),u={id:"custom_white_bg",beforeDraw:a=>{const{ctx:o,width:l,height:C}=a;o.save(),o.fillStyle="#FFFFFF",o.fillRect(0,0,l,C),o.restore()}},S=new R(c,{type:"radar",data:{labels:s,datasets:F},options:{responsive:!1,animation:!1,layout:{padding:20},scales:{r:{min:0,max:10,ticks:{stepSize:2,backdropColor:"white",color:"#8c5e4a",font:{size:16}},grid:{color:"#eaddd7"},angleLines:{color:"#eaddd7"},pointLabels:{font:{size:14,weight:"bold"},color:"#4a2e24"}}},plugins:{legend:{display:!1}}},plugins:[u]});setTimeout(()=>{const a=document.createElement("canvas");a.width=t.width,a.height=t.height;const o=a.getContext("2d");if(o){o.fillStyle="#FFFFFF",o.fillRect(0,0,a.width,a.height),o.drawImage(t,0,0);const l=a.toDataURL("image/jpeg",.9);S.destroy(),n(l)}else{const l=t.toDataURL("image/jpeg",.9);S.destroy(),n(l)}},100)}),X=async(i,m,n)=>{const t=new B({orientation:"portrait",unit:"mm",format:"a4"}),c=(r,d)=>n==="es"?d:r;let e=15;const p=t.internal.pageSize.getWidth(),s=14,F=14,u=p-s-F;t.setFontSize(18),t.setFont("helvetica","bold"),t.setTextColor(74,46,36),t.text(c("Comparison Report","Informe de Comparación"),s,e),e+=8,t.setFontSize(10),t.setFont("helvetica","normal"),t.setTextColor(100,100,100);const S=new Date().toISOString().split("T")[0];t.text(`${O(S,n)} | ${i.length} ${c("samples","muestras")}`,s,e),e+=10;const a=await M(i,n);if(a){const d=(p-170)/2;t.addImage(a,"JPEG",d,e,170,170),e+=175}t.setFontSize(10),t.setFont("helvetica","bold"),t.text(c("Samples Legend","Leyenda de Muestras"),s,e),e+=5;const o=5,l=u/o;i.forEach((r,d)=>{const h=f[d%f.length],v=d%o,y=Math.floor(d/o),b=s+v*l,g=e+y*8;t.setFillColor(parseInt(h.border.slice(1,3),16),parseInt(h.border.slice(3,5),16),parseInt(h.border.slice(5,7),16)),t.circle(b+2,g+2,2,"F"),t.setFontSize(8),t.setFont("helvetica","normal"),t.setTextColor(50,50,50);const w=r.evaluator.length>8?r.evaluator.slice(0,8)+"...":r.evaluator;t.text(`${r.sampleCode} (Q:${r.globalQuality})`,b+6,g+2),t.setFontSize(6),t.setTextColor(120,120,120),t.text(w,b+6,g+5.5)});const C=Math.ceil(i.length/o);e+=C*10+5,t.setDrawColor(200,200,200),t.line(s,e,p-F,e),e+=8,m.length>0&&(t.setFontSize(14),t.setFont("helvetica","bold"),t.setTextColor(74,46,36),t.text(c("Identified Groups","Grupos Identificados"),s,e),e+=8,m.forEach(r=>{e>260&&(t.addPage(),e=15),t.setFontSize(11),t.setFont("helvetica","bold"),t.setTextColor(74,46,36);const d=k(r.name,n);if(t.text(`#${r.id} ${d}`,s,e),t.setFontSize(9),t.setFont("helvetica","normal"),t.text(`Q: ${r.avgQuality}`,p-F-15,e),e+=5,r.dominantTraits.length>0){t.setFontSize(9),t.setTextColor(100,100,100);const b=r.dominantTraits.map(g=>k(g,n)).join(", ");t.text(`${c("Characterized by","Caracterizado por")}: ${b}`,s,e),e+=6}const h=6,v=u/h;r.sampleCodes.forEach((b,g)=>{const w=i.findIndex(A=>A.sampleCode===b),T=f[(w>=0?w:g)%f.length],$=g%h,D=Math.floor(g/h),E=s+$*v,I=e+D*6;t.setFillColor(parseInt(T.border.slice(1,3),16),parseInt(T.border.slice(3,5),16),parseInt(T.border.slice(5,7),16)),t.circle(E+1.5,I+1,1.5,"F"),t.setFontSize(8),t.setFont("helvetica","normal"),t.setTextColor(60,60,60),t.text(b,E+5,I+2)});const y=Math.ceil(r.sampleCodes.length/h);e+=y*6+6}));const z=t.internal.pageSize.getHeight()-10;t.setFontSize(8),t.setFont("helvetica","italic"),t.setTextColor(150,150,150),t.text(c("Generated by COEX Cacao Evaluation App","Generado por COEX Evaluación de Cacao"),s,z);const x=`Comparison_Report_${P()}.pdf`;t.save(x)};export{X as generateComparisonPdf};
