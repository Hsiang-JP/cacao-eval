const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/csvService-LcnnbJbY.js","assets/index-DN9yehpJ.js","assets/index-QcYqy_te.css","assets/tdsCalculator-D11FdiJf.js","assets/pdfService-Cinduz7s.js","assets/jspdf.es.min-D6bkY_eD.js","assets/attributes-zDdy4c7G.js","assets/index-DyJvz_uy.js","assets/createLucideIcon-DVGlXgso.js","assets/colors-C8jCGJn0.js","assets/dateUtils-BSM0ms4X.js"])))=>i.map(i=>d[i]);
import{u as O,b as Q,r as x,j as t,_ as C,C as U,d as B}from"./index-DN9yehpJ.js";import{dbService as j}from"./dbService-8xAAiJd6.js";import{b as k}from"./dateUtils-BSM0ms4X.js";import{H as M,F as W}from"./Footer-DE-EixjU.js";import{S as Z,a as G,b as J}from"./SampleLibraryCard-Dby7Sc2L.js";import{U as K,P as X}from"./papaparse.min-DpvlTnJ4.js";import{c as z}from"./createLucideIcon-DVGlXgso.js";import{P as Y}from"./plus-2Xe-YfLN.js";import"./index-DyJvz_uy.js";import"./colors-C8jCGJn0.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]],te=z("Download",ee);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]],oe=z("Search",ae),he=()=>{const{language:n,t:p}=O(),b=Q(),[u,N]=x.useState([]),[I,E]=x.useState(!0),[D,F]=x.useState(""),[s,v]=x.useState(new Set);x.useEffect(()=>{P()},[]);const P=async()=>{try{E(!0);const e=await j.getAllSamples();N(e)}catch(e){console.error("Failed to load samples:",e)}finally{E(!1)}},A=async(e,a)=>{if(window.confirm(n==="es"?`¿Eliminar muestra ${a}?`:`Delete sample ${a}?`))try{await j.deleteSample(e),N(o=>o.filter(d=>d.id!==e)),v(o=>{const d=new Set(o);return d.delete(e),d})}catch(o){console.error("Failed to delete sample:",o)}},$=e=>{v(a=>{const o=new Set(a);return o.has(e)?o.delete(e):o.add(e),o})},_=u.filter(e=>{const a=D.toLowerCase().trim();return a==="tds"?e.tdsProfile&&e.tdsProfile.events&&e.tdsProfile.events.length>0:e.sampleCode.toLowerCase().includes(a)||e.evaluator.toLowerCase().includes(a)}),y=s.size>0&&Array.from(s).every(e=>{const a=u.find(o=>o.id===e);return(a==null?void 0:a.tdsProfile)&&Object.keys(a.tdsProfile).length>0}),L=()=>{if(s.size===0||!y)return;const e=Array.from(s).join(",");b(`/tds-deep?ids=${e}`)},T=()=>{if(s.size<2){alert(n==="es"?"Seleccione al menos 2 muestras para comparar":"Select at least 2 samples to compare");return}const e=Array.from(s).join(",");b(`/compare?ids=${e}`)},V=async()=>{const e=s.size>0?u.filter(i=>s.has(i.id)):u;if(e.length===0)return;const a=`cacao_eval_${k()}`,o=window.prompt(n==="es"?"Nombre del archivo CSV:":"Enter filename for CSV:",a);if(o===null)return;const d=(o||a).endsWith(".csv")?o||a:`${o||a}.csv`,{generateCSVRow:c}=await C(async()=>{const{generateCSVRow:i}=await import("./csvService-LcnnbJbY.js");return{generateCSVRow:i}},__vite__mapDeps([0,1,2,3])),h=n==="es"?U:B,r=e.map(i=>c(i,n)),f="data:text/csv;charset=utf-8,"+[h.join(","),...r.map(i=>i.join(","))].join(`
`),l=encodeURI(f),m=document.createElement("a");m.setAttribute("href",l),m.setAttribute("download",d),document.body.appendChild(m),m.click(),document.body.removeChild(m)},R=async()=>{if(s.size===0)return;const e=u.filter(c=>s.has(c.id)),a=`cacao_eval_${k()}`,o=window.prompt(n==="es"?"Nombre del archivo PDF:":"Enter filename for PDF:",a);if(o===null)return;const d=o||a;try{const{generatePdf:c}=await C(async()=>{const{generatePdf:r}=await import("./pdfService-Cinduz7s.js");return{generatePdf:r}},__vite__mapDeps([4,5,1,2,6,7,8,9,3,10])),h=e.map(r=>({metadata:{sampleCode:r.sampleCode,date:r.date,time:r.time,evaluator:r.evaluator,evaluationType:r.evaluationType,sampleInfo:r.sampleInfo,notes:r.notes,producerRecommendations:r.producerRecommendations},attributes:r.attributes,globalQuality:r.globalQuality,selectedQualityId:r.selectedQualityId,language:n,tdsProfile:r.tdsProfile}));await c(h,void 0,d)}catch(c){console.error("PDF Export failed",c),alert(n==="es"?"Error al generar PDF":"Failed to generate PDF")}},q=()=>{var e;(e=document.getElementById("csv-import-input"))==null||e.click()},H=e=>{var o;const a=(o=e.target.files)==null?void 0:o[0];a&&(X.parse(a,{header:!0,skipEmptyLines:!0,complete:async d=>{try{const{parseSamplesFromCSV:c}=await C(async()=>{const{parseSamplesFromCSV:l}=await import("./csvService-LcnnbJbY.js");return{parseSamplesFromCSV:l}},__vite__mapDeps([0,1,2,3])),h=c(d.data,n),r=h.filter(l=>l.sampleCode&&l.date&&l.evaluator),f=h.length-r.length;if(f>0&&alert(n==="es"?`Se omitieron ${f} entradas por faltar datos de identificación (Código, Fecha o Evaluador).`:`Skipped ${f} entries due to missing identification data (Code, Date, or Evaluator).`),r.length>0){const l=[];r.forEach((i,g)=>{const w=u.find(S=>S.sampleCode.toLowerCase()===i.sampleCode.toLowerCase()&&S.evaluator.toLowerCase()===i.evaluator.toLowerCase()&&S.date===i.date);w&&l.push({importIdx:g,existingId:w.id,code:i.sampleCode,createdAt:w.createdAt})});const m=[...r];if(l.length>0){const i=n==="es"?`Se encontraron ${l.length} muestras duplicadas (mismo Código, Evaluador y Fecha). 

Si continúa, estas muestras serán REEMPLAZADAS con los datos del CSV.

¿Desea continuar?`:`Found ${l.length} duplicate samples (same Code, Evaluator, and Date). 

Proceeding will REPLACE these samples with the data from the CSV.

Do you want to proceed?`;if(!window.confirm(i))return;l.forEach(g=>{m[g.importIdx]={...m[g.importIdx],id:g.existingId,createdAt:g.createdAt}})}await j.importSamples(m),await P(),alert(n==="es"?`Proceso finalizado: ${l.length} reemplazadas, ${r.length-l.length} nuevas.`:`Process complete: ${l.length} replaced, ${r.length-l.length} new samples imported.`)}else alert(n==="es"?"No se encontraron muestras válidas en el archivo CSV.":"No valid samples found in CSV.")}catch(c){console.error("Import failed",c),alert(n==="es"?"Error al importar muestras.":"Failed to import samples.")}}}),e.target.value="")};return t.jsxs("div",{className:"flex flex-col min-h-screen bg-cacao-50 text-gray-800 font-sans",children:[t.jsx(M,{}),t.jsx("input",{type:"file",id:"csv-import-input",accept:".csv",className:"hidden",onChange:H}),t.jsxs("main",{className:"w-full px-4 md:px-8 space-y-6 mb-8 flex-grow",children:[t.jsx("div",{className:"bg-white p-4 rounded-xl shadow-sm border border-cacao-100 flex flex-col gap-4",children:t.jsxs("div",{className:"flex flex-col lg:flex-row justify-between gap-4",children:[t.jsxs("div",{className:"relative w-full lg:w-96 flex-shrink-0",children:[t.jsx(oe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:20}),t.jsx("input",{type:"text",placeholder:p.searchSamples||"Search samples...",value:D,onChange:e=>F(e.target.value),className:"w-full pl-10 pr-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-cacao-500 focus:bg-white transition-all"})]}),t.jsxs("div",{className:"flex flex-wrap items-center gap-2 lg:justify-end",children:[t.jsxs("div",{className:"flex items-center gap-1 bg-gray-50 p-1 rounded-lg border border-gray-100",children:[t.jsx("button",{onClick:q,className:"p-2 text-cacao-700 hover:bg-white hover:text-cacao-900 hover:shadow-sm rounded-md transition-all",title:p.importSamples,children:t.jsx(K,{size:20})}),t.jsx("div",{className:"w-px h-6 bg-gray-200"}),t.jsx("button",{onClick:V,className:"p-2 text-cacao-700 hover:bg-white hover:text-cacao-900 hover:shadow-sm rounded-md transition-all",title:p.exportAllCSV,children:t.jsx(te,{size:20})})]}),t.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[t.jsxs("button",{onClick:()=>v(new Set),disabled:s.size===0,className:`px-3 py-2.5 rounded-xl border text-sm font-bold flex items-center gap-2 transition-all duration-200 ${s.size>0?"bg-cacao-100 text-cacao-900 border-cacao-200 hover:bg-cacao-200 hover:border-cacao-300 cursor-pointer shadow-sm":"bg-gray-50 text-gray-400 border-gray-100 cursor-default opacity-60"}`,title:"Clear Selection",children:[s.size>0?t.jsx(Z,{size:16}):t.jsx(G,{size:16}),t.jsxs("span",{className:"hidden sm:inline",children:[s.size," ",n==="es"?"Seleccionadas":"Selected"]}),t.jsx("span",{className:"sm:hidden",children:s.size})]}),t.jsx("button",{onClick:L,disabled:s.size===0||!y,className:`font-bold py-2.5 px-4 rounded-xl shadow-sm transition-colors ${s.size>0&&y?"bg-orange-500 hover:bg-orange-600 text-white border-transparent":"bg-gray-100 text-gray-400 border border-gray-200 cursor-not-allowed"}`,title:y?"TDS Analysis":"No TDS Data",children:"TDS"}),t.jsx("button",{onClick:R,disabled:s.size===0,className:`font-bold py-2.5 px-4 rounded-xl shadow-sm transition-colors ${s.size===0?"bg-gray-100 text-gray-400 border border-gray-200 cursor-not-allowed":"bg-amber-600 hover:bg-amber-700 text-white border border-transparent"}`,title:n==="es"?"Descargar PDF":"Download PDF",children:"PDF"})]}),t.jsxs("div",{className:"flex items-center gap-2 ml-auto lg:ml-0",children:[t.jsx("button",{onClick:T,disabled:s.size<2,className:`font-bold py-2.5 px-5 rounded-xl shadow-md transition-colors ${s.size<2?"bg-gray-200 text-gray-400 cursor-not-allowed":"bg-white text-cacao-800 border-2 border-cacao-800 hover:bg-cacao-50"}`,children:p.compare||"Compare"}),t.jsx("button",{onClick:()=>b("/evaluate"),className:"bg-cacao-600 hover:bg-cacao-700 text-white font-bold p-2.5 rounded-xl shadow-md transition-colors flex items-center justify-center aspect-square",title:p.newEvaluation,children:t.jsx(Y,{size:24})})]})]})]})}),I?t.jsx("div",{className:"text-center py-20 text-gray-500",children:"Loading samples..."}):_.length===0?t.jsxs("div",{className:"text-center py-20 bg-white rounded-xl border border-dashed border-gray-300",children:[t.jsx("p",{className:"text-gray-500 mb-4",children:p.noSamples||"No samples found"}),t.jsx("button",{onClick:()=>b("/evaluate"),className:"text-cacao-600 font-bold hover:underline",children:"Start your first evaluation"})]}):t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4 gap-6",children:_.map(e=>t.jsx(J,{sample:e,isSelected:s.has(e.id),onToggleSelect:$,onDelete:A},e.id))})]}),t.jsx(W,{})]})};export{he as default};
