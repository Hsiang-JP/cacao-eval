import{I as h,a as D}from"./index-DIhvrpWB.js";import{a as m}from"./tdsCalculator-D11FdiJf.js";const p=t=>{try{return JSON.parse(t)}catch{return[]}},a=(t,g)=>{var e;if(!((e=t.tdsProfile)!=null&&e.events))return"";const n=t.tdsProfile.events.filter(r=>r.attrId===g);if(n.length===0)return"";const u=n.map(r=>({start:Math.round(r.start*100)/100,end:Math.round(r.end*100)/100}));return`"${JSON.stringify(u).replace(/"/g,'""')}"`},P=(t,g)=>{var c,o,d,S,I;const n=()=>{if(g==="es"&&t.date){const s=t.date.split("-");if(s.length===3)return`${s[2]}/${s[1]}/${s[0]}`}return t.date},u=new Map;t.attributes.forEach(s=>u.set(s.id,s));const e=(s,f)=>{var v;const _=u.get(s);return _?f&&_.subAttributes?((v=_.subAttributes.find(b=>b.id===f))==null?void 0:v.score)||0:_.score:0},r=(s,f)=>{var v,b;const _=u.get(s);return((b=(v=_==null?void 0:_.subAttributes)==null?void 0:v.find(T=>T.id===f))==null?void 0:b.description)||""};let i=null;if(t.tdsProfile)if(t.tdsProfile.analysis)i=t.tdsProfile.analysis;else try{i=m(t.tdsProfile)}catch{}const y=s=>{if(!i||!i.scores)return{duration:"",score:""};let f;return i.scores instanceof Map?f=i.scores.get(s):f=i.scores[s],f?{duration:f.durationPercent.toFixed(1)+"%",score:f.score.toString()}:{duration:"",score:""}},l=s=>i&&i[s]||"";return["",n(),t.time,t.evaluator,t.sampleCode,t.sampleInfo,e("cacao"),e("acidity"),e("acidity","acid_fruity"),e("acidity","acid_acetic"),e("acidity","acid_lactic"),e("acidity","acid_mineral"),e("bitterness"),e("astringency"),e("fresh_fruit"),e("fresh_fruit","ff_berry"),e("fresh_fruit","ff_citrus"),e("fresh_fruit","ff_dark"),e("fresh_fruit","ff_pulp"),e("fresh_fruit","ff_tropical"),e("browned_fruit"),e("browned_fruit","bf_dried"),e("browned_fruit","bf_brown"),e("browned_fruit","bf_overripe"),e("vegetal"),e("vegetal","veg_green"),e("vegetal","veg_earthy"),e("floral"),e("floral","flo_orange"),e("floral","flo_flowers"),e("woody"),e("woody","wood_light"),e("woody","wood_dark"),e("woody","wood_resin"),e("spice"),e("spice","sp_spices"),e("spice","sp_tobacco"),e("spice","sp_savory"),e("nutty"),e("nutty","nut_meat"),e("nutty","nut_skin"),e("caramel"),e("sweetness"),e("roast"),e("defects"),e("defects","def_dirty"),e("defects","def_mold"),e("defects","def_moldy"),e("defects","def_meaty"),e("defects","def_over"),e("defects","def_manure"),e("defects","def_smoke"),e("defects","def_other"),`"${r("defects","def_other").replace(/"/g,'""')}"`,`"${t.notes.replace(/"/g,'""')}"`,`"${t.producerRecommendations.replace(/"/g,'""')}"`,t.globalQuality,t.selectedQualityId==="uniqueness"?10:0,t.selectedQualityId==="complexity"?10:0,t.selectedQualityId==="balance"?10:0,t.selectedQualityId==="cleanliness"?10:0,t.selectedQualityId==="q_acidity"?10:0,t.selectedQualityId==="q_astringency"?10:0,t.selectedQualityId==="q_bitterness"?10:0,t.selectedQualityId==="q_aftertaste"?10:0,((c=t.tdsProfile)==null?void 0:c.mode)||"",((o=t.tdsProfile)==null?void 0:o.totalDuration)||"",((d=t.tdsProfile)==null?void 0:d.swallowTime)||"",(S=t.tdsProfile)!=null&&S.events?`"${JSON.stringify(t.tdsProfile.events).replace(/"/g,'""')}"`:"",a(t,"cacao"),a(t,"acidity"),a(t,"bitterness"),a(t,"astringency"),a(t,"roast"),a(t,"fresh_fruit"),a(t,"browned_fruit"),a(t,"vegetal"),a(t,"floral"),a(t,"woody"),a(t,"spice"),a(t,"nutty"),a(t,"caramel"),a(t,"sweetness"),a(t,"defects"),l("aromaIntensity"),l("aftertasteIntensity"),l("aftertasteQuality"),(i==null?void 0:i.dominantAftertaste)||"",(I=i==null?void 0:i.aftertasteBoosts)!=null&&I.length?i.aftertasteBoosts.map(s=>`${s.attrId} +${s.amount}`).join(", "):"",l("attackPhaseDuration"),...["cacao","acidity","bitterness","astringency","roast","fresh_fruit","browned_fruit","vegetal","floral","woody","spice","nutty","caramel","sweetness","defects"].flatMap(s=>{const f=y(s);return[f.duration,f.score]})]},C=(t,g)=>{const n=(r,i,y)=>{if(r[i]!==void 0)return r[i];if(r[y]!==void 0)return r[y];const l=Object.keys(r).find(c=>c.trim()===i||c.trim()===y);return l?r[l]:""},u=(r,i,y)=>{const l=n(r,i,y),c=parseFloat(l);return isNaN(c)?0:c},e=JSON.stringify(h);return t.map(r=>{const i={sampleCode:n(r,"CoEx Sample Code","ID de muestra")||"Unknown",date:n(r,"Date Eval (press Ctrl and ;)","Fecha de evaluación"),time:n(r,"Time Eval (press Ctrl and :)","Hora de evaluación"),evaluator:n(r,"Panelist Initials","Evaluador"),evaluationType:"cacao_mass",sampleInfo:n(r,"Sample Information","Información de muestra"),notes:n(r,"Overall Flavour comment","Comentario de sabor general"),producerRecommendations:n(r,"Feedback comment","Comentarios de comentarios"),globalQuality:u(r,"Global Quality (0 - 10)","Calidad global (0 - 10)"),language:g,selectedQualityId:void 0,attributes:JSON.parse(e)};if(i.date&&i.date.includes("/")){const o=i.date.split("/");o.length===3&&(i.date=`${o[2]}-${o[1]}-${o[0]}`)}i.attributes.forEach(o=>{o.score=u(r,o.csvHeaderEn,o.csvHeaderEs),o.subAttributes&&o.subAttributes.forEach(d=>{d.score=u(r,d.csvHeaderEn,d.csvHeaderEs),d.id==="def_other"&&(d.description=n(r,"Other Off-Flavour Description","Descripción"))})});let y=0,l;D.forEach(o=>{const d=u(r,o.csvHeaderEn,o.csvHeaderEs);d>y&&(y=d,l=o.id)}),y>0&&(i.selectedQualityId=l);const c=n(r,"TDS Mode","Modo TDS");if(c&&(c==="normal"||c==="expert")){const o=n(r,"TDS Events JSON","Eventos TDS JSON"),d=p(o);d.length>0&&(i.tdsProfile={mode:c,totalDuration:u(r,"TDS Total Duration (s)","Duración Total TDS (s)"),swallowTime:u(r,"TDS Swallow Time (s)","Tiempo de Tragado TDS (s)"),events:d})}return i}).filter(r=>r.sampleCode&&r.sampleCode!=="Unknown")};export{P as generateCSVRow,C as parseSamplesFromCSV};
