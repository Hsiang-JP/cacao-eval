import{R as W,r as b,j as e,T as te,u as q,I as V,a as ae,b as se,c as ne}from"./index-Bqsr8on1.js";import{X as oe,H as re,F as le}from"./Footer-BJY722jj.js";import{c as F}from"./createLucideIcon-DyrHEQNY.js";import{F as ie}from"./FlavorRadar-BY6mERSF.js";import{g as L}from"./colors-C8jCGJn0.js";import{A as I}from"./attributes-zDdy4c7G.js";import{a as Y,C as B,D as G,b as ce}from"./tdsCalculator-D11FdiJf.js";import{T as de,R as me,C as ue}from"./triangle-alert-CPmsm9UV.js";import{dbService as U}from"./dbService-8xAAiJd6.js";import{g as xe,a as ge}from"./dateUtils-BSM0ms4X.js";import{A as be}from"./index-B9lu-BW7.js";import{F as X}from"./file-text-CkSDCxCa.js";import{P as pe}from"./plus-DYMzIcjF.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],K=F("ChevronDown",he);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fe=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],Z=F("ChevronUp",fe);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ye=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m16 12-4-4-4 4",key:"177agl"}],["path",{d:"M12 16V8",key:"1sbj14"}]],ve=F("CircleArrowUp",ye);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],we=F("Lock",je);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ne=[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]],Se=F("Menu",Ne);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ke=[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]],Ce=F("Play",ke);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Te=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],De=F("Save",Te);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $e=[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]],J=F("Sparkles",$e);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ae=[["path",{d:"M12.8 19.6A2 2 0 1 0 14 16H2",key:"148xed"}],["path",{d:"M17.5 8a2.5 2.5 0 1 1 2 4H2",key:"1u4tom"}],["path",{d:"M9.8 4.4A2 2 0 1 1 11 8H2",key:"75valh"}]],Ee=F("Wind",Ae),Pe=W.memo(({id:a,label:h,value:u,subAttributes:x,onChange:t,onSubAttributeChange:f,onSubAttributeDescriptionChange:g,colorClass:s="accent-cacao-600",customColor:d,language:C="en",isCalculated:l=!1,disabled:y=!1,defaultExpanded:E=!1})=>{const[$,A]=b.useState(E),S=x&&x.length>0,R=te[C],D=j=>j===0?"text-gray-400":j<3?"text-gray-500":j<7?"text-cacao-600":"text-cacao-800 font-bold",c=((x==null?void 0:x.filter(j=>j.score>0))||[]).length,n=`slider-${a}`,N=d?{accentColor:d}:void 0;return e.jsxs("div",{id:a,className:`bg-white rounded-xl shadow-sm border border-cacao-100 transition-all overflow-hidden scroll-mt-48 ${y?"opacity-80 pointer-events-none":""}`,children:[e.jsxs("button",{onClick:()=>A(!$),disabled:y,"aria-expanded":$,"aria-controls":`${n}-content`,className:"w-full p-4 flex justify-between items-center hover:bg-cacao-50 transition-colors active:bg-cacao-100 touch-manipulation min-h-[44px]",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[e.jsx("span",{className:"text-sm font-bold text-gray-800 uppercase tracking-wide",children:h}),l&&e.jsx("span",{title:R.calculated,className:"flex items-center",children:e.jsx(we,{size:12,className:"text-gray-400"})}),S&&c>0&&e.jsx("span",{className:"text-[10px] font-bold bg-cacao-100 text-cacao-800 px-1.5 py-0.5 rounded",children:c})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:`text-2xl font-mono ${D(u)} min-w-[3rem] text-right`,children:l?u.toFixed(1):u}),$?e.jsx(Z,{size:20,className:"text-gray-600 flex-shrink-0"}):e.jsx(K,{size:20,className:"text-gray-600 flex-shrink-0"})]})]}),e.jsx("div",{id:`${n}-content`,className:"transition-all duration-300 ease-in-out",style:{maxHeight:$?"2000px":"0",opacity:$?1:0},children:e.jsxs("div",{className:"px-6 md:px-4 pb-6 md:pb-4 space-y-6 md:space-y-3",children:[e.jsx("div",{className:"flex items-center gap-3 touch-pan-y",children:e.jsx("input",{id:n,type:"range",min:"0",max:"10",step:l?"0.1":"1",value:u,onChange:j=>!l&&t(parseFloat(j.target.value)),disabled:l||y,style:N,className:`w-full h-8 md:h-4 bg-gray-200 rounded-lg appearance-none touch-pan-y ${!l&&!y?"cursor-pointer":"cursor-not-allowed opacity-60"} ${d?"":s}`})}),l&&e.jsx("div",{className:"text-[10px] text-gray-400 italic text-right",children:R.calculated}),S&&e.jsx("div",{className:"mt-2 grid grid-cols-1 md:grid-cols-2 gap-3 p-3 bg-cacao-50 rounded-lg border border-cacao-100 touch-pan-y",children:x.map(j=>e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("label",{className:"text-xs font-medium text-gray-600 truncate pr-2",children:j.name}),e.jsx("span",{className:`text-xs font-mono w-6 text-right ${j.score>0?"text-cacao-800 font-bold":"text-gray-400"}`,children:j.score})]}),e.jsx("input",{type:"range",min:"0",max:"10",step:"1",value:j.score,style:N,onChange:w=>f(j.id,parseFloat(w.target.value)),disabled:y,className:`w-full h-1.5 bg-gray-200 rounded-lg appearance-none touch-pan-y ${y?"cursor-not-allowed":"cursor-pointer"} ${d?"":"accent-cacao-500"}`}),j.id==="def_other"&&e.jsx("input",{type:"text",value:j.description||"",onChange:w=>g&&g(j.id,w.target.value),placeholder:C==="es"?"Descripción...":"Description...",disabled:y,className:"w-full mt-1 p-1.5 text-xs border border-cacao-200 rounded focus:border-cacao-500 outline-none disabled:bg-gray-100"})]},j.id))})]})})]})}),Me=({attributes:a,language:h,isEvaluationStarted:u})=>{const[x,t]=b.useState(!1);if(!u)return null;const f=g=>{const s=document.getElementById(g),d=document.getElementById("main-content");if(s){t(!1);const C=document.querySelector("header"),y=(C?C.offsetHeight:80)+90,$=s.getBoundingClientRect().top+window.pageYOffset-y;d?(d.style.transition="opacity 0.3s ease-out",d.style.opacity="0",setTimeout(()=>{window.scrollTo({top:$,behavior:"auto"}),requestAnimationFrame(()=>{d.style.opacity="1",setTimeout(()=>{d.style.transition=""},200)})},300)):window.scrollTo({top:$,behavior:"auto"})}};return e.jsxs("div",{className:"md:hidden fixed bottom-6 right-6 z-40 print:hidden",children:[e.jsx("button",{onClick:()=>t(!0),className:"bg-cacao-600 hover:bg-cacao-700 text-white p-4 rounded-full shadow-lg transition-transform hover:scale-105 active:scale-95 flex items-center justify-center","aria-label":"Navigation Menu",children:e.jsx(Se,{size:24})}),x&&e.jsxs("div",{className:"fixed inset-0 z-50 flex flex-col justify-end",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm transition-opacity",onClick:()=>t(!1)}),e.jsxs("div",{className:"relative bg-white rounded-t-2xl shadow-2xl max-h-[80vh] overflow-hidden flex flex-col animate-in slide-in-from-bottom duration-300",children:[e.jsxs("div",{className:"p-4 border-b border-gray-100 flex justify-between items-center bg-cacao-50",children:[e.jsx("h3",{className:"font-bold text-cacao-800",children:h==="es"?"Navegación Rápida":"Quick Navigation"}),e.jsx("button",{onClick:()=>t(!1),className:"p-1 hover:bg-gray-200 rounded-full text-gray-500",children:e.jsx(oe,{size:20})})]}),e.jsx("div",{className:"overflow-y-auto p-2",children:e.jsxs("div",{className:"grid grid-cols-2 gap-2 pb-safe",children:[e.jsxs("button",{onClick:()=>f("root"),className:"col-span-2 p-3 rounded-lg bg-gray-100 text-gray-700 font-medium text-sm flex items-center justify-center gap-2 hover:bg-gray-200",children:[e.jsx(ve,{size:16}),h==="es"?"Ir al inicio":"Back to Top"]}),a.map(g=>e.jsx("button",{onClick:()=>f(g.id),className:"p-3 text-left rounded-lg hover:bg-cacao-50 border border-transparent hover:border-cacao-100 transition-colors text-sm text-gray-700 font-medium truncate",children:h==="es"?g.nameEs:g.nameEn},g.id))]})})]})]})]})},Re=({startTime:a,isRunning:h,className:u})=>{const x=b.useRef(null),t=b.useRef(0),f=g=>{const s=Math.floor(g/60),d=Math.floor(g%60),C=Math.floor(g%1*10);return`${s}:${d.toString().padStart(2,"0")}.${C}`};return b.useEffect(()=>{if(!h){if(cancelAnimationFrame(t.current),x.current&&a>0){const s=(performance.now()-a)/1e3;x.current.innerText=f(s)}return}const g=()=>{if(x.current){const s=(performance.now()-a)/1e3;x.current.innerText=f(s)}t.current=requestAnimationFrame(g)};return t.current=requestAnimationFrame(g),()=>cancelAnimationFrame(t.current)},[a,h]),e.jsx("div",{ref:x,className:u||"text-6xl font-mono font-bold text-white tracking-wider","aria-label":"Elapsed time",children:"0:00.0"})},ze=W.memo(Re),Fe=({attrId:a,label:h,color:u,inputMethod:x,isActive:t,onStart:f,onStop:g,disabled:s=!1})=>{const d=b.useRef(!1),C=b.useCallback(S=>{s||(S.preventDefault(),d.current=!0,t||f(a))},[a,s,t,f]),l=b.useCallback(S=>{s||(S.preventDefault(),d.current=!1,t&&g(a))},[a,s,t,g]),y=b.useCallback(S=>{s||x==="mouse"&&(t?g(a):f(a))},[a,s,x,t,f,g]);b.useEffect(()=>()=>{d.current&&t&&g(a)},[a,t,g]);const E=`
    relative flex items-center justify-center
    w-full h-full
    px-4 py-3 rounded-xl font-bold text-sm uppercase tracking-wide
    transition-all duration-150 select-none
    touch-manipulation
  `,$=t?"ring-4 ring-offset-2 ring-white/50 scale-95 shadow-lg":"hover:scale-105 shadow-md",A=s?"opacity-50 cursor-not-allowed":"cursor-pointer";return e.jsxs("button",{type:"button",className:`${E} ${$} ${A}`,style:{backgroundColor:t?u:`${u}80`,color:"#fff",textShadow:"0 1px 2px rgba(0,0,0,0.3)"},onClick:y,onTouchStart:x==="touch"?C:void 0,onTouchEnd:x==="touch"?l:void 0,onTouchCancel:x==="touch"?l:void 0,disabled:s,"aria-pressed":t,children:[t&&e.jsx("span",{className:"absolute inset-0 rounded-xl animate-pulse",style:{backgroundColor:u,opacity:.3}}),e.jsx("span",{className:"relative z-10",children:h})]})},Ie=["cacao","acidity","bitterness","astringency","roast"],Le=["cacao","acidity","bitterness","astringency","roast","fresh_fruit","browned_fruit","vegetal","floral","woody","spice","nutty","caramel","sweetness","defects"],Qe=({mode:a,onComplete:h,onCancel:u})=>{var v;const{language:x}=q(),[t,f]=b.useState("idle"),[g,s]=b.useState(null),[d,C]=b.useState(null),[l,y]=b.useState([]),E="mouse",$=a==="normal"?Ie:Le,A=b.useRef(0);b.useRef(0);const S=b.useRef(null),R=b.useRef(null);b.useEffect(()=>((async()=>{if(t==="tasting"&&"wakeLock"in navigator)try{R.current=await navigator.wakeLock.request("screen")}catch(m){console.warn("Wake lock not available:",m)}})(),()=>{R.current&&(R.current.release(),R.current=null)}),[t]),b.useEffect(()=>(document.body.style.overflow="hidden",()=>{document.body.style.overflow=""}),[]);const D=b.useCallback(()=>{if(d&&S.current!==null){const r=(performance.now()-A.current)/1e3,m=g!==null&&S.current>=g?"residual":"melting",p={attrId:d,start:S.current,end:r,phase:m};y(o=>[...o,p])}S.current=null,C(null)},[d,g]),P=b.useCallback(r=>{if(t!=="tasting"&&t!=="swallowed")return;const m=(performance.now()-A.current)/1e3;if(d===r){D();return}if(d&&S.current!==null){const p=g!==null&&S.current>=g?"residual":"melting",o={attrId:d,start:S.current,end:m,phase:p};y(k=>[...k,o])}S.current=m,C(r)},[t,d,g,D]),c=b.useCallback(r=>{P(r)},[P]),n=b.useCallback(r=>{d===r&&D()},[d,D]),N=()=>{A.current=performance.now(),f("tasting"),y([]),C(null),S.current=null},j=()=>{const r=(performance.now()-A.current)/1e3;s(r),f("swallowed")},w=()=>{let r=[...l];if(d&&S.current!==null){const o=(performance.now()-A.current)/1e3,k=g!==null&&S.current>=g?"residual":"melting",T={attrId:d,start:S.current,end:o,phase:k};r.push(T)}f("finished"),S.current=null,C(null);const m=(performance.now()-A.current)/1e3;h({mode:a,events:r,swallowTime:g||m,totalDuration:m})},i=r=>{const m=Math.floor(r/60),p=Math.floor(r%60),o=Math.floor(r%1*10);return`${m}:${p.toString().padStart(2,"0")}.${o}`};return e.jsxs("div",{className:"fixed inset-0 z-[100] bg-gray-900 flex flex-col h-dvh",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-800",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("h2",{className:"text-white font-bold text-lg",children:[x==="es"?"Perfil TDS":"TDS Profile",e.jsxs("span",{className:"text-gray-400 text-sm ml-2",children:["(",a==="normal"?x==="es"?"Normal":"Core":"Expert",")"]})]})}),e.jsx("button",{onClick:u,className:"text-gray-400 hover:text-white p-2 font-bold","aria-label":"Close",children:x==="es"?"Cerrar":"Close"})]}),e.jsxs("div",{className:"flex-none py-2 text-center",children:[e.jsx("div",{className:"h-6 flex items-center justify-center mb-1",children:g!==null?e.jsxs("div",{className:"text-amber-400 text-sm font-medium animate-fade-in",children:[x==="es"?"Tragado a":"Swallowed at"," ",i(g)]}):e.jsx("div",{className:"text-transparent text-sm select-none",children:"Placeholder"})}),e.jsx(ze,{startTime:A.current,isRunning:t==="tasting"||t==="swallowed"}),e.jsx("div",{className:"mt-3 h-10 flex items-center justify-center",children:d?e.jsx("span",{className:"inline-block px-4 py-2 rounded-full text-white font-bold text-lg animate-pulse shadow-lg",style:{backgroundColor:L(d)},children:((v=I[d])==null?void 0:v[x])||d}):e.jsx("span",{className:"inline-block px-4 py-2 rounded-full bg-gray-800 text-gray-600 font-bold text-lg border border-gray-700",children:x==="es"?"Seleccione...":"Select..."})})]}),(t==="tasting"||t==="swallowed")&&e.jsx("div",{className:"text-center text-gray-400 text-sm mb-2 px-4",children:x==="es"?"Toque el sabor dominante. Solo uno a la vez.":"Tap the dominant flavor. Only one at a time."}),e.jsx("div",{className:`flex-1 px-2 pb-2 ${t==="idle"?"overflow-auto":"overflow-hidden"}`,style:{touchAction:t!=="idle"?"none":"auto",overscrollBehavior:"none"},onTouchMove:r=>{(t==="tasting"||t==="swallowed")&&r.preventDefault()},children:t==="idle"?e.jsx("div",{className:"h-full flex items-center justify-center",children:e.jsx("button",{onClick:N,className:"bg-green-600 hover:bg-green-700 text-white font-bold py-6 px-12 rounded-2xl text-2xl flex items-center gap-3 shadow-lg transition-all",children:x==="es"?"Comenzar":"Start Tasting"})}):e.jsx("div",{className:`grid gap-2 h-full ${a==="normal"?"grid-cols-3":"grid-cols-3 sm:grid-cols-5"}`,style:{touchAction:"none",gridTemplateRows:a==="normal"?"repeat(2, 1fr)":"repeat(5, 1fr)"},children:$.map(r=>{var o;const m=d===r,p=L(r);return e.jsx(Fe,{attrId:r,label:((o=I[r])==null?void 0:o[x])||r,color:p,inputMethod:E,isActive:m,onStart:c,onStop:n,disabled:t==="finished"},r)})})}),(t==="tasting"||t==="swallowed")&&e.jsxs("div",{className:"flex-none p-2 bg-gray-800 flex gap-2 pb-safe",children:[e.jsx("button",{onClick:j,disabled:t!=="tasting",className:`flex-1 font-bold py-3 rounded-xl flex items-center justify-center gap-2 transition-colors ${t==="tasting"?"bg-amber-600 hover:bg-amber-700 text-white":"bg-gray-700 text-gray-500 cursor-not-allowed opacity-50"}`,children:x==="es"?"Tragar":"Swallow"}),e.jsx("button",{onClick:w,className:"flex-1 bg-red-600 hover:bg-red-700 text-white font-bold py-3 rounded-xl flex items-center justify-center gap-2 transition-colors",children:x==="es"?"Terminar":"Finish"})]}),e.jsx("style",{children:`
                .h-dvh { height: 100vh; height: 100dvh; }
                .pb-safe { padding-bottom: env(safe-area-inset-bottom, 1rem); }
            `})]})},_e=({profile:a,onApply:h,onDiscard:u,onSave:x})=>{var A,S,R,D,P;const{language:t}=q(),[f,g]=b.useState(null),s=b.useMemo(()=>Y(a),[a]),d=b.useMemo(()=>a.mode!=="expert"?[]:Array.from(s.scores.entries()).filter(([c,n])=>!B.includes(c)&&(n.isPresent||(n.totalDuration||0)>0||n.durationPercent>0)).sort(([,c],[,n])=>n.durationPercent-c.durationPercent).sort(([c],[n])=>{const N=G.includes(c),j=G.includes(n);return N&&!j?1:!N&&j?-1:0}),[s.scores,a.mode]),C=b.useMemo(()=>{const c=Array.from(s.coreScores.values()).some(N=>N.isFlagged),n=d.some(([,N])=>N.isFlagged);return c||n},[s.coreScores,d]),l=b.useMemo(()=>Array.from(s.scores.entries()).some(([c,n])=>G.includes(c)&&n.durationPercent>0),[s.scores]),y=b.useMemo(()=>{const c=Array.from(s.coreScores.values()).some(N=>N.boostDetails!==void 0),n=d.some(([,N])=>N.boostDetails!==void 0);return c||n},[s.coreScores,d]),E=()=>{const c=new Map(s.scores);if(a.mode==="expert")for(const[n,N]of s.coreScores)c.set(n,N);h(c,s)},$=b.useMemo(()=>{const c=a.mode==="expert"?s.coreScores:s.scores;return Array.from(c.entries()).sort(([n,N],[j,w])=>{const i=B.includes(n),v=B.includes(j);return i&&!v?-1:!i&&v?1:w.durationPercent-N.durationPercent})},[s,a.mode]);return e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl border border-gray-200 overflow-hidden max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"bg-gradient-to-r from-cacao-600 to-cacao-700 px-6 py-4",children:e.jsxs("h3",{className:"text-white font-bold text-lg",children:[t==="es"?"Análisis TDS":"TDS Analysis",e.jsxs("span",{className:"text-cacao-200 text-sm ml-2",children:["(",a.mode==="normal"?"Normal":"Expert",")"]})]})}),e.jsxs("div",{className:"px-4 py-2 bg-blue-50 border-b border-blue-100",children:[e.jsx("p",{className:"text-xs text-blue-700",children:t==="es"?"Puntuaciones basadas en zonas: Inicio (0-20%), Media (20-100%), Final (post-gusto)":"Scores based on zones: Attack (0-20%), Evolution (20-100%), Finish (aftertaste)"}),y&&e.jsxs("p",{className:"text-xs text-indigo-700 mt-1 font-medium flex items-center gap-1",children:[e.jsx(J,{size:12}),t==="es"?"Algunos puntajes tienen aumentos recomendados debido a una fuerte presencia en el post-gusto.":"Some scores have recommended boosts due to strong aftertaste presence."]})]}),a.events.length>0&&e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-1 mb-2",children:[e.jsx("h4",{className:"text-sm font-bold text-gray-600 uppercase",children:t==="es"?"Línea de Tiempo":"Timeline"}),e.jsxs("span",{className:"text-xs text-gray-500",children:[t==="es"?"Duración":"Duration",": ",a.totalDuration.toFixed(1),"s | ",t==="es"?"Tragado":"Swallow",": ",a.swallowTime.toFixed(1),"s"]})]}),e.jsx("div",{className:"relative w-full mt-8 mb-8",children:(()=>{const c=s.firstOnset||0,n=c+(s.attackPhaseDuration||0),N=a.swallowTime,j=a.totalDuration,w=c/j*100,i=n/j*100,v=N/j*100;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"absolute -top-4 left-2 right-0 text-xs text-gray-500 font-medium z-20 pointer-events-none",children:[e.jsx("span",{className:"absolute text-gray-600",style:{left:`${w}%`,transform:"translateX(-50%)"},children:"0%"}),e.jsx("span",{className:"absolute text-gray-600",style:{left:`${i}%`,transform:"translateX(-50%)"},children:"20%"}),e.jsx("span",{className:"absolute text-gray-800 font-bold",style:{left:`${v}%`,transform:"translateX(-50%)"},children:"100%"})]}),e.jsxs("div",{className:"relative w-full h-14 sm:h-16 bg-gray-100 rounded-lg overflow-hidden",onClick:()=>g(null),children:[e.jsx("div",{className:"absolute inset-0 flex",children:a.events.map((r,m)=>{var T;const p=r.start/j*100,o=(r.end-r.start)/j*100,k=f===m;return e.jsx("div",{className:`absolute h-full cursor-pointer ${k?"opacity-100 z-20":"hover:opacity-80"}`,style:{left:`${p}%`,width:`${o}%`,backgroundColor:L(r.attrId)},onClick:z=>{z.stopPropagation(),g(k?null:m)},"aria-label":`${((T=I[r.attrId])==null?void 0:T[t])||r.attrId}: ${r.start.toFixed(1)}s - ${r.end.toFixed(1)}s`},m)})}),e.jsx("div",{className:"absolute top-0 bottom-0 w-0.5 sm:w-1 z-10",style:{left:`${i}%`,background:"repeating-linear-gradient(to bottom, black 0, black 4px, transparent 4px, transparent 8px)"}}),e.jsx("div",{className:"absolute top-0 bottom-0 w-1 sm:w-1.5 z-10 bg-black",style:{left:`${v}%`}})]}),e.jsxs("div",{className:"absolute -bottom-0 left-2 right-0 text-xs text-gray-500 font-medium z-20 pointer-events-none",children:[e.jsxs("span",{className:"absolute text-gray-600",style:{left:`${w}%`,transform:"translateX(-50%)"},children:[c.toFixed(1),"s"]}),e.jsxs("span",{className:"absolute text-gray-600",style:{left:`${i}%`,transform:"translateX(-50%)"},children:[n.toFixed(1),"s"]}),e.jsxs("span",{className:"absolute text-gray-800 font-bold",style:{left:`${v}%`,transform:"translateX(-50%)"},children:[N.toFixed(1),"s"]})]})]})})()}),e.jsxs("div",{className:"flex flex-wrap items-center justify-center gap-x-4 gap-y-1 text-xs text-gray-600",children:[e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"w-4 border-t-2 border-dashed border-gray-400"}),t==="es"?"Fin del ataque":"Attack End"]}),e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"w-4 h-1 bg-black"}),t==="es"?"Tragar":"Swallow"]}),e.jsxs("span",{className:"font-medium text-amber-700",children:[t==="es"?"Post-gusto":"Aftertaste",": ",(a.totalDuration-a.swallowTime).toFixed(1),"s"]})]}),e.jsx("div",{className:"h-10 flex items-center justify-center",children:f!==null&&a.events[f]?e.jsxs("div",{className:"px-3 py-1.5 bg-gray-100 rounded-lg flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded",style:{backgroundColor:L(a.events[f].attrId)}}),e.jsx("span",{className:"font-medium text-gray-800 text-sm",children:((A=I[a.events[f].attrId])==null?void 0:A[t])||a.events[f].attrId})]}),e.jsxs("span",{className:"text-xs text-gray-600",children:[a.events[f].start.toFixed(1),"s – ",a.events[f].end.toFixed(1),"s",e.jsxs("span",{className:"ml-1 text-gray-400",children:["(",(a.events[f].end-a.events[f].start).toFixed(1),"s)"]})]})]}):e.jsx("span",{className:"text-xs text-gray-400",children:t==="es"?"Toca un segmento para ver detalles":"Tap a segment to see details"})})]}),e.jsxs("div",{className:"px-4 pb-2",children:[e.jsx("h4",{className:"text-sm font-bold text-gray-600 uppercase mb-2",children:t==="es"?"Atributos Principales":"Core Attributes"}),e.jsx("div",{className:"grid grid-cols-1 gap-1.5",children:$.filter(([c])=>B.includes(c)).map(([c,n])=>{var N;return e.jsxs("div",{className:`flex flex-col rounded-lg px-3 py-2 ${n.isFlagged?"bg-amber-50 border border-amber-200":"bg-gray-50"}`,children:[e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:L(c)}}),e.jsx("span",{className:"text-sm text-gray-700 font-medium",children:((N=I[c])==null?void 0:N[t])||c}),n.isFlagged&&e.jsx("span",{className:"text-xs text-amber-600 bg-amber-100 px-1 rounded",children:"!"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs text-gray-400",children:[n.durationPercent,"%"]}),e.jsx("span",{className:`font-bold w-6 text-right ${n.boostDetails?"text-indigo-700":"text-cacao-800"}`,children:n.score})]})]}),n.boostDetails&&e.jsxs("div",{className:"mt-1 ml-5 text-xs text-indigo-600 flex items-start gap-1",children:[e.jsx("div",{className:"flex h-3 w-3 items-center justify-center rounded-full bg-indigo-100 text-[9px] font-bold mt-0.5 flex-shrink-0",children:"↑"}),e.jsx("span",{children:t==="es"?`Recomendación: +${n.boostDetails.amount} (${n.boostDetails.reason==="aftertaste"?`Presencia tras tragar: ${n.boostDetails.duration}s`:n.boostDetails.reason==="mixed"?`Presencia fuerte: ${n.boostDetails.duration}s`:`Contribución componentes: ${n.boostDetails.duration}s`})`:`Recommendation: +${n.boostDetails.amount} (${n.boostDetails.reason==="aftertaste"?`Lingering presence: ${n.boostDetails.duration}s`:n.boostDetails.reason==="mixed"?`Strong presence: ${n.boostDetails.duration}s`:`Component presence: ${n.boostDetails.duration}s`})`})]})]},c)})})]}),a.mode==="expert"&&d.length>0&&e.jsxs("div",{className:"px-4 pb-4",children:[e.jsx("h4",{className:"text-sm font-bold text-gray-600 uppercase mb-2",children:t==="es"?"Complementarios":"Complementary"}),e.jsx("div",{className:"grid grid-cols-1 gap-1.5",children:d.map(([c,n])=>{var N;return e.jsxs("div",{className:`flex flex-col rounded-lg px-3 py-2 ${n.isFlagged?"bg-amber-50 border border-amber-200":"bg-gray-50"}`,children:[e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:L(c)}}),e.jsx("span",{className:"text-sm text-gray-700 font-medium",children:((N=I[c])==null?void 0:N[t])||c}),n.isFlagged&&e.jsx("span",{className:"text-xs text-amber-600 bg-amber-100 px-1 rounded",children:"!"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs text-gray-400",children:[n.durationPercent,"%"]}),e.jsx("span",{className:`font-bold w-6 text-right ${n.boostDetails?"text-indigo-700":"text-cacao-700"}`,children:n.score})]})]}),n.boostDetails&&e.jsxs("div",{className:"mt-1 ml-5 text-xs text-indigo-600 flex items-start gap-1",children:[e.jsx("div",{className:"flex h-3 w-3 items-center justify-center rounded-full bg-indigo-100 text-[9px] font-bold mt-0.5 flex-shrink-0",children:"↑"}),e.jsx("span",{children:t==="es"?`Recomendación: +${n.boostDetails.amount} (${n.boostDetails.reason==="aftertaste"?`Presencia tras tragar: ${n.boostDetails.duration}s`:n.boostDetails.reason==="mixed"?`Presencia fuerte: ${n.boostDetails.duration}s`:`Contribución componentes: ${n.boostDetails.duration}s`})`:`Recommendation: +${n.boostDetails.amount} (${n.boostDetails.reason==="aftertaste"?`Lingering presence: ${n.boostDetails.duration}s`:n.boostDetails.reason==="mixed"?`Strong presence: ${n.boostDetails.duration}s`:`Component presence: ${n.boostDetails.duration}s`})`})]})]},c)})})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 p-4 bg-gradient-to-r from-amber-50 to-orange-50 border-y",children:[e.jsxs("div",{className:"bg-white/70 rounded-lg p-3 backdrop-blur",children:[e.jsxs("div",{className:"flex items-center gap-2 text-amber-700 mb-1",children:[e.jsx(Ee,{size:16}),e.jsx("span",{className:"text-xs font-bold uppercase",children:"Aroma"})]}),e.jsxs("div",{className:"text-2xl font-bold text-amber-800",children:[s.aromaPercent,"%"]}),s.aromaNotes.length>0&&e.jsx("div",{className:"text-xs text-amber-600 mt-1",children:s.aromaNotes.map(c=>{var n;return((n=I[c])==null?void 0:n[t])||c}).join(", ")})]}),e.jsxs("div",{className:"bg-white/70 rounded-lg p-3 backdrop-blur",children:[e.jsxs("div",{className:"flex items-center gap-2 text-orange-700 mb-1",children:[e.jsx(J,{size:16}),e.jsx("span",{className:"text-xs font-bold uppercase",children:t==="es"?"Post-gusto":"Aftertaste"})]}),e.jsxs("div",{className:"text-2xl font-bold text-orange-800",children:[s.aftertastePercent,"%"]}),e.jsx("div",{className:`text-xs mt-1 ${s.aftertasteQuality==="positive"?"text-green-600":s.aftertasteQuality==="negative"?"text-red-600":"text-gray-500"}`,children:t==="es"?s.aftertasteQuality==="positive"?"Positivo":s.aftertasteQuality==="negative"?"Negativo":"Neutral":s.aftertasteQuality==="positive"?"Positive":s.aftertasteQuality==="negative"?"Negative":"Neutral"})]})]}),(((S=s.kickSuggestions)==null?void 0:S.length)>0||((R=s.qualitySuggestions)==null?void 0:R.length)>0)&&e.jsxs("div",{className:"px-4 py-3 bg-indigo-50 border-b border-indigo-100",children:[e.jsxs("h4",{className:"text-sm font-bold text-indigo-800 flex items-center gap-2 mb-2",children:[e.jsx(J,{size:16}),t==="es"?"Observaciones":"Insights"]}),e.jsxs("div",{className:"space-y-3",children:[(D=s.kickSuggestions)==null?void 0:D.map((c,n)=>e.jsx("div",{className:"text-xs text-indigo-700 bg-white p-2 rounded border border-indigo-100 flex gap-2",children:t==="es"?c.es:c.en},`kick-${n}`)),(P=s.qualitySuggestions)==null?void 0:P.map((c,n)=>e.jsx("div",{className:"text-xs text-indigo-700 bg-white p-2 rounded border border-indigo-100 flex gap-2",children:t==="es"?c.es:c.en},`qual-${n}`))]})]}),s.qualityModifier!==0&&e.jsx("div",{className:"px-4 pb-3 pt-2",children:e.jsxs("div",{className:`text-sm px-3 py-2 rounded-lg ${s.qualityModifier>0?"bg-green-50 text-green-700":"bg-red-50 text-red-700"}`,children:[t==="es"?"Ajuste de calidad sugerido:":"Suggested quality adjustment:"," ",e.jsxs("strong",{children:[s.qualityModifier>0?"+":"",s.qualityModifier]})]})}),(C||l)&&e.jsx("div",{className:"px-4 py-2 bg-amber-50 border-b border-amber-100",children:C&&e.jsxs("div",{className:"flex items-center gap-2 text-amber-700 text-sm",children:[e.jsx(de,{size:16}),e.jsx("span",{children:t==="es"?"Atributos principales sin selección":"Core attributes not selected"})]})}),e.jsxs("div",{className:"flex gap-3 p-4 bg-gray-50 border-t sticky bottom-0",children:[e.jsx("button",{onClick:u,className:"flex-1 bg-white border border-gray-300 text-gray-700 font-bold py-3 rounded-xl hover:bg-gray-100 flex items-center justify-center gap-2",children:t==="es"?"Descartar":"Discard"}),e.jsx("button",{onClick:x,className:"flex-1 bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-xl flex items-center justify-center gap-2",children:t==="es"?"Guardar":"Save"}),e.jsx("button",{onClick:E,className:"flex-1 bg-green-600 hover:bg-green-700 text-white font-bold py-3 rounded-xl flex items-center justify-center gap-2",children:t==="es"?"Aplicar":"Apply"})]})]})},qe=({onSelect:a,onCancel:h})=>{const{language:u}=q();return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl p-6 max-w-md w-full mx-4",children:[e.jsx("h3",{className:"text-xl font-bold text-cacao-800 mb-4",children:u==="es"?"Seleccionar Modo TDS":"Select TDS Mode"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:()=>a("normal"),className:"w-full bg-cacao-50 hover:bg-cacao-100 border-2 border-cacao-200 rounded-xl p-4 text-left transition-colors",children:[e.jsx("div",{className:"font-bold text-cacao-800",children:u==="es"?"Normal (5 atributos)":"Normal (5 attributes)"}),e.jsx("div",{className:"text-sm text-gray-600",children:u==="es"?"Cacao, Acidez, Amargo, Astringencia, Tostado":"Cacao, Acidity, Bitter, Astringency, Roast"})]}),e.jsxs("button",{onClick:()=>a("expert"),className:"w-full bg-amber-50 hover:bg-amber-100 border-2 border-amber-200 rounded-xl p-4 text-left transition-colors",children:[e.jsx("div",{className:"font-bold text-amber-800",children:u==="es"?"Experto (15 atributos)":"Expert (15 attributes)"}),e.jsx("div",{className:"text-sm text-gray-600",children:u==="es"?"Todos los atributos de sabor":"All flavor attributes"})]})]}),e.jsx("button",{onClick:h,className:"mt-4 w-full text-gray-500 hover:text-gray-700 py-2",children:u==="es"?"Cancelar":"Cancel"})]})})},Be=a=>{const{language:h,t:u}=q(),[x,t]=b.useState(!1),[f,g]=b.useState(!0),[s,d]=b.useState(!1),C=()=>({sampleCode:"",date:"",time:"",evaluator:"",evaluationType:"cacao_mass",sampleInfo:"",notes:"",producerRecommendations:""}),[l,y]=b.useState({metadata:C(),attributes:JSON.parse(JSON.stringify(V)),globalQuality:0,language:"en"}),[E]=b.useState(JSON.parse(JSON.stringify(ae)));b.useEffect(()=>{y(w=>({...w,language:h}))},[h]),b.useEffect(()=>{a&&(async()=>{const i=await U.getSample(a);i&&(y({metadata:{sampleCode:i.sampleCode,date:i.date,time:i.time,evaluator:i.evaluator,evaluationType:i.evaluationType,sampleInfo:i.sampleInfo,notes:i.notes,producerRecommendations:i.producerRecommendations},attributes:i.attributes,globalQuality:i.globalQuality,selectedQualityId:i.selectedQualityId,language:h,tdsProfile:i.tdsProfile}),t(!0))})()},[a,h]);const $=(w,i)=>{const v=i.map(k=>k.score),r=[...v].sort((k,T)=>T-k),m=k=>r[k-1]||0;let p=0;switch(w){case"acidity":case"defects":p=v.reduce((k,T)=>k+T,0);break;case"fresh_fruit":p=m(1)+m(2)*.75+(m(3)+m(4)+m(5))/3;break;case"browned_fruit":case"woody":case"spice":p=m(1)+m(2)*.75+m(3)/3;break;case"vegetal":case"floral":case"nutty":p=m(1)+m(2)*.75;break;default:p=0}const o=Math.min(p,10);return Math.round((o+Number.EPSILON)*10)/10};return{session:l,setSession:y,qualityAttributes:E,isEvaluationStarted:x,setIsEvaluationStarted:t,isGlobalQualityExpanded:f,setIsGlobalQualityExpanded:g,showPostSaveModal:s,setShowPostSaveModal:d,getInitialMetadata:C,handlers:{handleMetadataChange:(w,i)=>{y(v=>({...v,metadata:{...v.metadata,[w]:i}}))},handleAttributeChange:(w,i)=>{y(v=>{const r=v.attributes.map(m=>m.id===w?{...m,score:i}:m);return{...v,attributes:r}})},handleSubAttributeChange:(w,i,v)=>{y(r=>{const m=r.attributes.map(p=>{if(p.id===w&&p.subAttributes){const o=p.subAttributes.map(T=>T.id===i?{...T,score:v}:T);let k=p.score;return p.isCalculated&&(k=$(p.id,o)),{...p,score:k,subAttributes:o}}return p});return{...r,attributes:m}})},handleSubAttributeDescription:(w,i,v)=>{y(r=>{const m=r.attributes.map(p=>p.id===w&&p.subAttributes?{...p,subAttributes:p.subAttributes.map(o=>o.id===i?{...o,description:v}:o)}:p);return{...r,attributes:m}})},handleQualitySelect:w=>{y(i=>({...i,selectedQualityId:w}))},handleStartEvaluation:()=>{const w=xe(),i=ge();y(v=>({...v,metadata:{...v.metadata,date:w,time:i}})),t(!0)},handleReset:()=>{window.confirm(u.confirmReset)&&(y({metadata:C(),attributes:JSON.parse(JSON.stringify(V)),globalQuality:0,language:h}),t(!1),window.scrollTo(0,0))},handleSaveToLibrary:async w=>{try{const i=l.metadata.sampleCode.trim(),v=l.metadata.evaluator.trim(),r=l.metadata.date;if(!i||!v||!r){const M=[];i||M.push(h==="es"?"Código de Muestra":"Sample Code"),v||M.push(h==="es"?"Evaluador":"Evaluator"),r||M.push(h==="es"?"Fecha":"Date"),alert(h==="es"?`Por favor complete los siguientes campos obligatorios antes de guardar:
- ${M.join(`
- `)}`:`Please complete the following required fields before saving:
- ${M.join(`
- `)}`);return}const p=["cacao","bitterness","astringency","roast","acidity"].filter(M=>{const O=l.attributes.find(H=>H.id===M);return!O||O.score<=0});if(p.length>0){const M=p.map(H=>{const _=l.attributes.find(ee=>ee.id===H);return h==="es"?_==null?void 0:_.nameEs:_==null?void 0:_.nameEn}).join(", ");if(!window.confirm(h==="es"?`Los siguientes campos principales tienen valor 0 (Ausente): ${M}.

¿Desea guardar de todos modos?`:`The following core attributes are set to 0 (Absent): ${M}.

Do you want to save anyway?`))return}if(l.globalQuality<=0&&!window.confirm(h==="es"?"La Calidad Global es 0. ¿Desea guardar de todos modos?":"Global Quality score is 0. Do you want to save anyway?"))return;const k=(await U.searchBySampleCode(i)).find(M=>M.sampleCode.toLowerCase()===i.toLowerCase()&&M.evaluator.toLowerCase()===v.toLowerCase()&&M.date===r);let T=a;if(k)if(a&&k.id===a)T=a;else{if(!window.confirm(h==="es"?`Ya existe una muestra con código "${i}", evaluador "${v}" y fecha "${r}". ¿Desea sobrescribirla?`:`A sample with code "${i}", evaluator "${v}", and date "${r}" already exists. Do you want to overwrite it?`))return;T=k.id}const z={sampleCode:l.metadata.sampleCode,date:l.metadata.date,time:l.metadata.time,evaluator:l.metadata.evaluator,evaluationType:l.metadata.evaluationType,sampleInfo:l.metadata.sampleInfo,notes:l.metadata.notes,producerRecommendations:l.metadata.producerRecommendations,attributes:l.attributes,globalQuality:l.globalQuality,selectedQualityId:l.selectedQualityId,language:h,tdsProfile:l.tdsProfile},Q=await U.saveSample(z,T||void 0);alert(h==="es"?`✅ Muestra ${l.metadata.sampleCode} guardada exitosamente!`:`✅ Sample ${l.metadata.sampleCode} saved successfully!`),Q!==a&&w(`/evaluate?id=${Q}`,{replace:!0}),d(!0)}catch(i){console.error("Failed to save sample:",i),alert(h==="es"?`❌ Error al guardar la muestra: ${i}`:`❌ Failed to save sample: ${i}`)}},applyTDSData:(w,i,v=!0)=>{let r=l.attributes;v&&(r=ce(l.attributes,i.scores));const m={...w,analysis:i};y(p=>({...p,attributes:r,tdsProfile:m})),t(!0)}}}},Oe=({onApply:a,onStartEvaluation:h})=>{const[u,x]=b.useState(!1),[t,f]=b.useState(!1),[g,s]=b.useState(!1),[d,C]=b.useState("normal"),[l,y]=b.useState(null);return{state:{showTDSModeSelect:u,showTDSProfiler:t,showTDSSummary:g,tdsMode:d,tdsProfile:l},actions:{setShowTDSModeSelect:x,setShowTDSProfiler:f,setShowTDSSummary:s,setTdsProfile:y,handleStartTDS:()=>{h(),x(!0)},handleTDSModeSelect:P=>{C(P),x(!1),f(!0)},handleTDSComplete:P=>{y(P),f(!1),s(!0)},handleTDSApply:(P,c)=>{l&&a(l,c,!0),s(!1)},handleTDSDiscard:()=>{y(null),s(!1)},handleTDSSave:()=>{if(l){const P=Y(l);a(l,P,!1)}s(!1)}}}},st=()=>{const{language:a,setLanguage:h,t:u}=q(),x=se(),[t]=ne(),f=t.get("id"),g=b.useRef(null),{session:s,setSession:d,qualityAttributes:C,isEvaluationStarted:l,setIsEvaluationStarted:y,isGlobalQualityExpanded:E,setIsGlobalQualityExpanded:$,showPostSaveModal:A,setShowPostSaveModal:S,getInitialMetadata:R,handlers:{handleMetadataChange:D,handleAttributeChange:P,handleSubAttributeChange:c,handleSubAttributeDescription:n,handleQualitySelect:N,handleStartEvaluation:j,handleReset:w,handleSaveToLibrary:i,applyTDSData:v}}=Be(f),{state:r,actions:m}=Oe({onApply:v,onStartEvaluation:j}),p=o=>["cacao","bitterness","astringency","roast","acidity"].includes(o);return e.jsxs("div",{className:"flex flex-col min-h-screen bg-cacao-50 text-gray-800 font-sans",children:[e.jsx(re,{}),e.jsxs("main",{id:"main-content",className:"w-full px-4 md:px-8 space-y-8 mb-8 flex-grow",children:[e.jsxs("section",{className:"bg-white p-6 rounded-xl shadow-sm border border-cacao-100 transition-opacity",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-6 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-1",children:u.evaluator}),e.jsx("input",{type:"text",value:s.metadata.evaluator,onChange:o=>D("evaluator",o.target.value),className:"w-full p-2 bg-gray-50 border rounded-md disabled:bg-gray-100"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-1",children:[u.date," / ",u.time]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative w-full",children:[e.jsx("input",{type:"date",required:!0,value:s.metadata.date,onChange:o=>D("date",o.target.value),className:`w-full p-2 bg-gray-50 border rounded-md disabled:bg-gray-100 ${a==="es"&&s.metadata.date?"text-transparent":""}`}),a==="es"&&s.metadata.date&&e.jsx("div",{className:"absolute inset-0 flex items-center pl-2 pointer-events-none text-gray-800 p-2 bg-gray-50 border border-transparent rounded-md",children:(()=>{const[o,k,T]=s.metadata.date.split("-");return`${T}/${k}/${o}`})()})]}),e.jsx("input",{type:"time",value:s.metadata.time,onChange:o=>D("time",o.target.value),className:"w-32 p-2 bg-gray-50 border rounded-md disabled:bg-gray-100"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-1",children:u.code}),e.jsx("input",{type:"text",value:s.metadata.sampleCode,onChange:o=>D("sampleCode",o.target.value),className:"w-full p-2 bg-gray-50 border rounded-md font-mono disabled:bg-gray-100"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-1",children:u.evaluationType}),e.jsxs("select",{value:s.metadata.evaluationType,onChange:o=>D("evaluationType",o.target.value),className:"w-full p-2 bg-gray-50 border rounded-md disabled:bg-gray-100",children:[e.jsx("option",{value:"cacao_mass",children:u.cacaoMass}),e.jsx("option",{value:"chocolate",children:u.chocolate})]})]})]}),e.jsx("div",{className:"grid grid-cols-1",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-1",children:u.sampleInfoLabel}),e.jsx("input",{type:"text",value:s.metadata.sampleInfo,onChange:o=>D("sampleInfo",o.target.value),className:"w-full p-2 bg-gray-50 border rounded-md disabled:bg-gray-100"})]})})]}),!l&&e.jsxs("div",{className:"flex flex-col sm:flex-row justify-center gap-4",children:[e.jsxs("button",{type:"button",onClick:j,className:"bg-cacao-600 hover:bg-cacao-700 text-white font-bold py-3 px-8 rounded-full shadow-lg transition-transform transform hover:scale-105 flex items-center gap-2",children:[e.jsx(Ce,{size:20,fill:"currentColor"}),u.startEvaluation]}),e.jsxs("button",{type:"button",onClick:m.handleStartTDS,className:"bg-amber-600 hover:bg-amber-700 text-white font-bold py-3 px-8 rounded-full shadow-lg transition-transform transform hover:scale-105 flex items-center gap-2",children:[e.jsx(be,{size:20}),a==="es"?"Perfil TDS":"TDS Profile"]})]}),e.jsxs("div",{className:`grid grid-cols-1 lg:grid-cols-3 gap-8 transition-opacity ${l?"opacity-100":"opacity-50"}`,children:[e.jsx("div",{className:"lg:col-span-2 space-y-8",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-bold text-cacao-700 sticky top-20 bg-cacao-50 py-2 z-10",children:u.basicAttributes}),s.attributes.map(o=>{var T;const k=p(o.id);return e.jsx(Pe,{id:o.id,label:a==="es"?o.nameEs:o.nameEn,value:o.score,subAttributes:(T=o.subAttributes)==null?void 0:T.map(z=>({...z,name:a==="es"?z.nameEs:z.nameEn})),onChange:z=>P(o.id,z),onSubAttributeChange:(z,Q)=>c(o.id,z,Q),onSubAttributeDescriptionChange:o.id==="defects"?(z,Q)=>n(o.id,z,Q):void 0,language:a,customColor:L(o.id),isCalculated:o.isCalculated,disabled:!l,defaultExpanded:k},o.id)})]})}),e.jsx("div",{className:"lg:col-span-1 space-y-6",children:e.jsxs("div",{className:"lg:sticky lg:top-24 space-y-6",children:[e.jsxs("div",{className:`bg-white rounded-xl shadow-sm border border-cacao-100 transition-all overflow-hidden ${l?"":"opacity-80 pointer-events-none"}`,children:[e.jsxs("button",{onClick:()=>$(!E),disabled:!l,"aria-expanded":E,"aria-controls":"global-quality-content",className:"w-full p-4 flex justify-between items-center hover:bg-cacao-50 transition-colors active:bg-cacao-100 touch-manipulation min-h-[44px]",children:[e.jsx("span",{className:"text-sm font-bold text-cacao-800 uppercase tracking-wide",children:u.globalScore}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-2xl font-mono font-bold text-cacao-800 min-w-[3rem] text-right",children:s.globalQuality}),E?e.jsx(Z,{size:20,className:"text-gray-600 flex-shrink-0"}):e.jsx(K,{size:20,className:"text-gray-600 flex-shrink-0"})]})]}),e.jsx("div",{id:"global-quality-content",className:"transition-all duration-300 ease-in-out",style:{maxHeight:E?"500px":"0",opacity:E?1:0},children:e.jsxs("div",{className:"px-4 pb-4 space-y-6",children:[e.jsx("div",{children:e.jsx("div",{className:"flex items-center gap-4 touch-pan-y",children:e.jsx("input",{type:"range",min:"0",max:"10",step:"0.5",value:s.globalQuality,onChange:o=>d(k=>({...k,globalQuality:parseFloat(o.target.value)})),disabled:!l,className:`w-full h-8 md:h-4 bg-gray-200 rounded-lg appearance-none accent-cacao-800 touch-pan-y ${l?"cursor-pointer":"cursor-not-allowed"}`})})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-bold text-gray-700 uppercase mb-2",children:u.qualityCharacteristic}),e.jsxs("select",{value:s.selectedQualityId||"",onChange:o=>N(o.target.value),disabled:!l,className:"w-full p-2 bg-gray-50 border border-gray-200 rounded-lg text-sm focus:border-cacao-500 focus:ring-1 focus:ring-cacao-500 disabled:bg-gray-100 outline-none transition-all",children:[e.jsx("option",{value:"",children:a==="es"?"Seleccionar...":"Select..."}),C.map(o=>e.jsx("option",{value:o.id,children:a==="es"?o.nameEs:o.nameEn},o.id))]})]})]})})]}),e.jsxs("div",{className:`bg-white p-6 rounded-xl shadow-sm border border-cacao-100 space-y-4 transition-opacity ${l?"":"opacity-80 pointer-events-none"}`,children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-1",children:u.flavorNotes}),e.jsx("textarea",{className:"w-full p-3 bg-gray-50 border rounded-lg h-24 text-sm disabled:bg-gray-100",value:s.metadata.notes,onChange:o=>D("notes",o.target.value),disabled:!l})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-1",children:u.producerFeedback}),e.jsx("textarea",{className:"w-full p-3 bg-gray-50 border rounded-lg h-24 text-sm disabled:bg-gray-100",value:s.metadata.producerRecommendations,onChange:o=>D("producerRecommendations",o.target.value),disabled:!l})]})]}),e.jsx(ie,{ref:g,attributes:s.attributes}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-3 pt-2",children:[e.jsxs("button",{type:"button",onClick:()=>i(x),disabled:!l,className:"w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 rounded-xl shadow-md transition-colors flex justify-center items-center gap-2 border border-green-600 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(De,{size:20}),a==="es"?"Guardar en Biblioteca":"Save to Library"]}),e.jsxs("button",{type:"button",onClick:()=>x("/samples"),className:"w-full bg-white border border-cacao-200 text-cacao-700 font-bold py-3 rounded-xl shadow-sm hover:bg-cacao-50 transition-colors flex justify-center items-center gap-2",children:[e.jsx(X,{size:20}),a==="es"?"Ver Biblioteca":"View Library"]})]}),e.jsxs("button",{type:"button",onClick:w,className:"w-full bg-white border border-gray-300 text-gray-600 font-medium py-3 rounded-xl hover:bg-gray-50 transition-colors flex justify-center items-center gap-2 shadow-sm",children:[e.jsx(me,{size:18})," ",u.reset]})]})]})})]})]}),A&&e.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm animate-in fade-in duration-200",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl p-6 w-full max-w-md space-y-6 transform scale-100 animate-in zoom-in-95 duration-200",children:[e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 text-green-600 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(ue,{size:32})}),e.jsx("h3",{className:"text-2xl font-bold text-gray-800",children:a==="es"?"¡Muestra Guardada!":"Sample Saved!"}),e.jsx("p",{className:"text-gray-500",children:a==="es"?"¿Qué operación desea realizar?":"What would you like to do next?"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:()=>x("/samples"),className:"w-full bg-white border border-gray-200 hover:bg-gray-50 text-gray-800 font-bold py-3 rounded-xl transition-colors flex items-center justify-center gap-3 shadow-sm",children:[e.jsx(X,{size:20,className:"text-cacao-600"}),u.sampleLibrary]}),e.jsxs("button",{onClick:()=>{d({metadata:R(),attributes:JSON.parse(JSON.stringify(V)),globalQuality:0,language:a}),y(!1),S(!1),window.scrollTo(0,0),x("/evaluate")},className:"w-full bg-cacao-600 hover:bg-cacao-700 text-white font-bold py-3 rounded-xl transition-colors flex items-center justify-center gap-3 shadow-md",children:[e.jsx(pe,{size:20}),u.newEvaluation]}),e.jsx("button",{onClick:()=>S(!1),className:"w-full bg-gray-100 hover:bg-gray-200 text-gray-700 font-bold py-3 rounded-xl transition-colors flex items-center justify-center gap-2",children:a==="es"?"Seguir editando":"Keep editing"})]})]})}),r.showTDSModeSelect&&e.jsx(qe,{onSelect:m.handleTDSModeSelect,onCancel:()=>m.setShowTDSModeSelect(!1)}),r.showTDSProfiler&&e.jsx(Qe,{mode:r.tdsMode,onComplete:m.handleTDSComplete,onCancel:()=>m.setShowTDSProfiler(!1)}),r.showTDSSummary&&r.tdsProfile&&e.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-2 sm:p-6 bg-black/60 backdrop-blur-sm animate-in fade-in duration-200",children:e.jsx("div",{className:"w-full max-w-4xl",children:e.jsx(_e,{profile:r.tdsProfile,onApply:m.handleTDSApply,onDiscard:m.handleTDSDiscard,onSave:m.handleTDSSave})})}),e.jsx(le,{}),e.jsx(Me,{attributes:s.attributes,language:a,isEvaluationStarted:l})]})};export{st as default};
