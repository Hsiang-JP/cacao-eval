import{R as ee,r as d,j as e,T as oe,u as V,I as K,a as re,b as le,c as ie}from"./index-Dw65S7rK.js";import{X as ce,H as de,F as me}from"./Footer-DleAzZSZ.js";import{c as q}from"./createLucideIcon-D7ZCby8C.js";import{F as ue}from"./FlavorRadar-CJWBBa1q.js";import{g as H}from"./colors-C8jCGJn0.js";import{A as B}from"./attributes-zDdy4c7G.js";import{a as te,C as J,D as X,b as xe}from"./tdsCalculator-D11FdiJf.js";import{T as ge,R as pe,C as be}from"./triangle-alert-j6nW2Z6F.js";import{V as he}from"./ValidationModal-BpyN9KUF.js";import{P as fe,C as ye}from"./ConfirmationModal-DPVuQRMM.js";import{dbService as W}from"./dbService-8xAAiJd6.js";import{g as ve,a as je}from"./dateUtils-BSM0ms4X.js";import{A as we}from"./index-rBm6tBrN.js";import{F as Z}from"./file-text-CLF9idGI.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ne=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],ae=q("ChevronDown",Ne);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Se=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],se=q("ChevronUp",Se);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ce=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m16 12-4-4-4 4",key:"177agl"}],["path",{d:"M12 16V8",key:"1sbj14"}]],ke=q("CircleArrowUp",Ce);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Te=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],De=q("Lock",Te);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $e=[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]],Ae=q("Menu",$e);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ee=[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]],Pe=q("Play",Ee);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Me=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],Fe=q("Save",Me);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Re=[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]],Y=q("Sparkles",Re);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ze=[["path",{d:"M12.8 19.6A2 2 0 1 0 14 16H2",key:"148xed"}],["path",{d:"M17.5 8a2.5 2.5 0 1 1 2 4H2",key:"1u4tom"}],["path",{d:"M9.8 4.4A2 2 0 1 1 11 8H2",key:"75valh"}]],Ie=q("Wind",ze),Le=ee.memo(({id:a,label:y,value:m,subAttributes:u,onChange:t,onSubAttributeChange:v,onSubAttributeDescriptionChange:x,colorClass:n="accent-cacao-600",customColor:l,language:T="en",isCalculated:C=!1,disabled:k=!1,defaultExpanded:i=!1})=>{const[S,$]=d.useState(i),b=u&&u.length>0,z=oe[T],E=w=>w===0?"text-gray-400":w<3?"text-gray-500":w<7?"text-cacao-600":"text-cacao-800 font-bold",r=((u==null?void 0:u.filter(w=>w.score>0))||[]).length,s=`slider-${a}`,N=l?{accentColor:l}:void 0;return e.jsxs("div",{id:a,className:`bg-white rounded-xl shadow-sm border border-cacao-100 transition-all overflow-hidden scroll-mt-48 ${k?"opacity-80 pointer-events-none":""}`,children:[e.jsxs("button",{onClick:()=>$(!S),disabled:k,"aria-expanded":S,"aria-controls":`${s}-content`,className:"w-full p-4 flex justify-between items-center hover:bg-cacao-50 transition-colors active:bg-cacao-100 touch-manipulation min-h-[44px]",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[e.jsx("span",{className:"text-sm font-bold text-gray-800 uppercase tracking-wide",children:y}),C&&e.jsx("span",{title:z.calculated,className:"flex items-center",children:e.jsx(De,{size:12,className:"text-gray-400"})}),b&&r>0&&e.jsx("span",{className:"text-[10px] font-bold bg-cacao-100 text-cacao-800 px-1.5 py-0.5 rounded",children:r})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:`text-2xl font-mono ${E(m)} min-w-[3rem] text-right`,children:C?m.toFixed(1):m}),S?e.jsx(se,{size:20,className:"text-gray-600 flex-shrink-0"}):e.jsx(ae,{size:20,className:"text-gray-600 flex-shrink-0"})]})]}),e.jsx("div",{id:`${s}-content`,className:"transition-all duration-300 ease-in-out",style:{maxHeight:S?"2000px":"0",opacity:S?1:0},children:e.jsxs("div",{className:"px-6 md:px-4 pb-6 md:pb-4 space-y-6 md:space-y-3",children:[e.jsx("div",{className:"flex items-center gap-3 touch-pan-y",children:e.jsx("input",{id:s,type:"range",min:"0",max:"10",step:C?"0.1":"1",value:m,onChange:w=>!C&&t(parseFloat(w.target.value)),disabled:C||k,style:N,className:`w-full h-8 md:h-4 bg-gray-200 rounded-lg appearance-none touch-pan-y ${!C&&!k?"cursor-pointer":"cursor-not-allowed opacity-60"} ${l?"":n}`})}),C&&e.jsx("div",{className:"text-[10px] text-gray-400 italic text-right",children:z.calculated}),b&&e.jsx("div",{className:"mt-2 grid grid-cols-1 md:grid-cols-2 gap-3 p-3 bg-cacao-50 rounded-lg border border-cacao-100 touch-pan-y",children:u.map(w=>e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("label",{className:"text-xs font-medium text-gray-600 truncate pr-2",children:w.name}),e.jsx("span",{className:`text-xs font-mono w-6 text-right ${w.score>0?"text-cacao-800 font-bold":"text-gray-400"}`,children:w.score})]}),e.jsx("input",{type:"range",min:"0",max:"10",step:"1",value:w.score,style:N,onChange:I=>v(w.id,parseFloat(I.target.value)),disabled:k,className:`w-full h-1.5 bg-gray-200 rounded-lg appearance-none touch-pan-y ${k?"cursor-not-allowed":"cursor-pointer"} ${l?"":"accent-cacao-500"}`}),w.id==="def_other"&&e.jsx("input",{type:"text",value:w.description||"",onChange:I=>x&&x(w.id,I.target.value),placeholder:T==="es"?"Descripción...":"Description...",disabled:k,className:"w-full mt-1 p-1.5 text-xs border border-cacao-200 rounded focus:border-cacao-500 outline-none disabled:bg-gray-100"})]},w.id))})]})})]})}),Qe=({attributes:a,language:y,isEvaluationStarted:m})=>{const[u,t]=d.useState(!1);if(!m)return null;const v=x=>{const n=document.getElementById(x),l=document.getElementById("main-content");if(n){t(!1);const T=document.querySelector("header"),k=(T?T.offsetHeight:80)+90,S=n.getBoundingClientRect().top+window.pageYOffset-k;l?(l.style.transition="opacity 0.3s ease-out",l.style.opacity="0",setTimeout(()=>{window.scrollTo({top:S,behavior:"auto"}),requestAnimationFrame(()=>{l.style.opacity="1",setTimeout(()=>{l.style.transition=""},200)})},300)):window.scrollTo({top:S,behavior:"auto"})}};return e.jsxs("div",{className:"md:hidden fixed bottom-6 right-6 z-40 print:hidden",children:[e.jsx("button",{onClick:()=>t(!0),className:"bg-cacao-600 hover:bg-cacao-700 text-white p-4 rounded-full shadow-lg transition-transform hover:scale-105 active:scale-95 flex items-center justify-center","aria-label":"Navigation Menu",children:e.jsx(Ae,{size:24})}),u&&e.jsxs("div",{className:"fixed inset-0 z-50 flex flex-col justify-end",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm transition-opacity",onClick:()=>t(!1)}),e.jsxs("div",{className:"relative bg-white rounded-t-2xl shadow-2xl max-h-[80vh] overflow-hidden flex flex-col animate-in slide-in-from-bottom duration-300",children:[e.jsxs("div",{className:"p-4 border-b border-gray-100 flex justify-between items-center bg-cacao-50",children:[e.jsx("h3",{className:"font-bold text-cacao-800",children:y==="es"?"Navegación Rápida":"Quick Navigation"}),e.jsx("button",{onClick:()=>t(!1),className:"p-1 hover:bg-gray-200 rounded-full text-gray-500",children:e.jsx(ce,{size:20})})]}),e.jsx("div",{className:"overflow-y-auto p-2",children:e.jsxs("div",{className:"grid grid-cols-2 gap-2 pb-safe",children:[e.jsxs("button",{onClick:()=>v("root"),className:"col-span-2 p-3 rounded-lg bg-gray-100 text-gray-700 font-medium text-sm flex items-center justify-center gap-2 hover:bg-gray-200",children:[e.jsx(ke,{size:16}),y==="es"?"Ir al inicio":"Back to Top"]}),a.map(x=>e.jsx("button",{onClick:()=>v(x.id),className:"p-3 text-left rounded-lg hover:bg-cacao-50 border border-transparent hover:border-cacao-100 transition-colors text-sm text-gray-700 font-medium truncate",children:y==="es"?x.nameEs:x.nameEn},x.id))]})})]})]})]})},_e=({startTime:a,isRunning:y,className:m})=>{const u=d.useRef(null),t=d.useRef(0),v=x=>{const n=Math.floor(x/60),l=Math.floor(x%60),T=Math.floor(x%1*10);return`${n}:${l.toString().padStart(2,"0")}.${T}`};return d.useEffect(()=>{if(!y){if(cancelAnimationFrame(t.current),u.current&&a>0){const n=(performance.now()-a)/1e3;u.current.innerText=v(n)}return}const x=()=>{if(u.current){const n=(performance.now()-a)/1e3;u.current.innerText=v(n)}t.current=requestAnimationFrame(x)};return t.current=requestAnimationFrame(x),()=>cancelAnimationFrame(t.current)},[a,y]),e.jsx("div",{ref:u,className:m||"text-6xl font-mono font-bold text-white tracking-wider","aria-label":"Elapsed time",children:"0:00.0"})},qe=ee.memo(_e),Oe=({attrId:a,label:y,color:m,inputMethod:u,isActive:t,onStart:v,onStop:x,disabled:n=!1})=>{const l=d.useRef(!1),T=d.useCallback(b=>{n||(b.preventDefault(),l.current=!0,t||v(a))},[a,n,t,v]),C=d.useCallback(b=>{n||(b.preventDefault(),l.current=!1,t&&x(a))},[a,n,t,x]),k=d.useCallback(b=>{n||u==="mouse"&&(t?x(a):v(a))},[a,n,u,t,v,x]);d.useEffect(()=>()=>{l.current&&t&&x(a)},[a,t,x]);const i=`
    relative flex items-center justify-center
    w-full h-full
    px-4 py-3 rounded-xl font-bold text-sm uppercase tracking-wide
    transition-all duration-150 select-none
    touch-manipulation
  `,S=t?"ring-4 ring-offset-2 ring-white/50 scale-95 shadow-lg":"hover:scale-105 shadow-md",$=n?"opacity-50 cursor-not-allowed":"cursor-pointer";return e.jsxs("button",{type:"button",className:`${i} ${S} ${$}`,style:{backgroundColor:t?m:`${m}80`,color:"#fff",textShadow:"0 1px 2px rgba(0,0,0,0.3)"},onClick:k,onTouchStart:u==="touch"?T:void 0,onTouchEnd:u==="touch"?C:void 0,onTouchCancel:u==="touch"?C:void 0,disabled:n,"aria-pressed":t,children:[t&&e.jsx("span",{className:"absolute inset-0 rounded-xl animate-pulse",style:{backgroundColor:m,opacity:.3}}),e.jsx("span",{className:"relative z-10",children:y})]})},Be=["cacao","acidity","bitterness","astringency","roast"],He=["cacao","acidity","bitterness","astringency","roast","fresh_fruit","browned_fruit","vegetal","floral","woody","spice","nutty","caramel","sweetness","defects"],Ge=({mode:a,onComplete:y,onCancel:m})=>{var j;const{language:u}=V(),[t,v]=d.useState("idle"),[x,n]=d.useState(null),[l,T]=d.useState(null),[C,k]=d.useState([]),i="mouse",S=a==="normal"?Be:He,$=d.useRef(0);d.useRef(0);const b=d.useRef(null),z=d.useRef(null);d.useEffect(()=>((async()=>{if(t==="tasting"&&"wakeLock"in navigator)try{z.current=await navigator.wakeLock.request("screen")}catch(g){console.warn("Wake lock not available:",g)}})(),()=>{z.current&&(z.current.release(),z.current=null)}),[t]),d.useEffect(()=>(document.body.style.overflow="hidden",()=>{document.body.style.overflow=""}),[]);const E=d.useCallback(()=>{if(l&&b.current!==null){const o=(performance.now()-$.current)/1e3,g=x!==null&&b.current>=x?"residual":"melting",h={attrId:l,start:b.current,end:o,phase:g};k(p=>[...p,h])}b.current=null,T(null)},[l,x]),M=d.useCallback(o=>{if(t!=="tasting"&&t!=="swallowed")return;const g=(performance.now()-$.current)/1e3;if(l===o){E();return}if(l&&b.current!==null){const h=x!==null&&b.current>=x?"residual":"melting",p={attrId:l,start:b.current,end:g,phase:h};k(f=>[...f,p])}b.current=g,T(o)},[t,l,x,E]),r=d.useCallback(o=>{M(o)},[M]),s=d.useCallback(o=>{l===o&&E()},[l,E]),N=()=>{$.current=performance.now(),v("tasting"),k([]),T(null),b.current=null},w=()=>{const o=(performance.now()-$.current)/1e3;n(o),v("swallowed")},I=()=>{let o=[...C];if(l&&b.current!==null){const p=(performance.now()-$.current)/1e3,f=x!==null&&b.current>=x?"residual":"melting",F={attrId:l,start:b.current,end:p,phase:f};o.push(F)}v("finished"),b.current=null,T(null);const g=(performance.now()-$.current)/1e3;y({mode:a,events:o,swallowTime:x||g,totalDuration:g})},A=o=>{const g=Math.floor(o/60),h=Math.floor(o%60),p=Math.floor(o%1*10);return`${g}:${h.toString().padStart(2,"0")}.${p}`};return e.jsxs("div",{className:"fixed inset-0 z-[100] bg-gray-900 flex flex-col h-dvh",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-800",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("h2",{className:"text-white font-bold text-lg",children:[u==="es"?"Perfil TDS":"TDS Profile",e.jsxs("span",{className:"text-gray-400 text-sm ml-2",children:["(",a==="normal"?u==="es"?"Normal":"Core":"Expert",")"]})]})}),e.jsx("button",{onClick:m,className:"text-gray-400 hover:text-white p-2 font-bold","aria-label":"Close",children:u==="es"?"Cerrar":"Close"})]}),e.jsxs("div",{className:"flex-none py-2 text-center",children:[e.jsx("div",{className:"h-6 flex items-center justify-center mb-1",children:x!==null?e.jsxs("div",{className:"text-amber-400 text-sm font-medium animate-fade-in",children:[u==="es"?"Tragado a":"Swallowed at"," ",A(x)]}):e.jsx("div",{className:"text-transparent text-sm select-none",children:"Placeholder"})}),e.jsx(qe,{startTime:$.current,isRunning:t==="tasting"||t==="swallowed"}),e.jsx("div",{className:"mt-3 h-10 flex items-center justify-center",children:l?e.jsx("span",{className:"inline-block px-4 py-2 rounded-full text-white font-bold text-lg animate-pulse shadow-lg",style:{backgroundColor:H(l)},children:((j=B[l])==null?void 0:j[u])||l}):e.jsx("span",{className:"inline-block px-4 py-2 rounded-full bg-gray-800 text-gray-600 font-bold text-lg border border-gray-700",children:u==="es"?"Seleccione...":"Select..."})})]}),(t==="tasting"||t==="swallowed")&&e.jsx("div",{className:"text-center text-gray-400 text-sm mb-2 px-4",children:u==="es"?"Toque el sabor dominante. Solo uno a la vez.":"Tap the dominant flavor. Only one at a time."}),e.jsx("div",{className:`flex-1 px-2 pb-2 ${t==="idle"?"overflow-auto":"overflow-hidden"}`,style:{touchAction:t!=="idle"?"none":"auto",overscrollBehavior:"none"},onTouchMove:o=>{(t==="tasting"||t==="swallowed")&&o.preventDefault()},children:t==="idle"?e.jsx("div",{className:"h-full flex items-center justify-center",children:e.jsx("button",{onClick:N,className:"bg-green-600 hover:bg-green-700 text-white font-bold py-6 px-12 rounded-2xl text-2xl flex items-center gap-3 shadow-lg transition-all",children:u==="es"?"Comenzar":"Start Tasting"})}):e.jsx("div",{className:`grid gap-2 h-full ${a==="normal"?"grid-cols-3":"grid-cols-3 sm:grid-cols-5"}`,style:{touchAction:"none",gridTemplateRows:a==="normal"?"repeat(2, 1fr)":"repeat(5, 1fr)"},children:S.map(o=>{var p;const g=l===o,h=H(o);return e.jsx(Oe,{attrId:o,label:((p=B[o])==null?void 0:p[u])||o,color:h,inputMethod:i,isActive:g,onStart:r,onStop:s,disabled:t==="finished"},o)})})}),(t==="tasting"||t==="swallowed")&&e.jsxs("div",{className:"flex-none p-2 bg-gray-800 flex gap-2 pb-safe",children:[e.jsx("button",{onClick:w,disabled:t!=="tasting",className:`flex-1 font-bold py-3 rounded-xl flex items-center justify-center gap-2 transition-colors ${t==="tasting"?"bg-amber-600 hover:bg-amber-700 text-white":"bg-gray-700 text-gray-500 cursor-not-allowed opacity-50"}`,children:u==="es"?"Tragar":"Swallow"}),e.jsx("button",{onClick:I,className:"flex-1 bg-red-600 hover:bg-red-700 text-white font-bold py-3 rounded-xl flex items-center justify-center gap-2 transition-colors",children:u==="es"?"Terminar":"Finish"})]}),e.jsx("style",{children:`
                .h-dvh { height: 100vh; height: 100dvh; }
                .pb-safe { padding-bottom: env(safe-area-inset-bottom, 1rem); }
            `})]})},Ue=({profile:a,onApply:y,onDiscard:m,onSave:u})=>{var $,b,z,E,M;const{language:t}=V(),[v,x]=d.useState(null),n=d.useMemo(()=>te(a),[a]),l=d.useMemo(()=>a.mode!=="expert"?[]:Array.from(n.scores.entries()).filter(([r,s])=>!J.includes(r)&&(s.isPresent||(s.totalDuration||0)>0||s.durationPercent>0)).sort(([,r],[,s])=>s.durationPercent-r.durationPercent).sort(([r],[s])=>{const N=X.includes(r),w=X.includes(s);return N&&!w?1:!N&&w?-1:0}),[n.scores,a.mode]),T=d.useMemo(()=>{const r=Array.from(n.coreScores.values()).some(N=>N.isFlagged),s=l.some(([,N])=>N.isFlagged);return r||s},[n.coreScores,l]),C=d.useMemo(()=>Array.from(n.scores.entries()).some(([r,s])=>X.includes(r)&&s.durationPercent>0),[n.scores]),k=d.useMemo(()=>{const r=Array.from(n.coreScores.values()).some(N=>N.boostDetails!==void 0),s=l.some(([,N])=>N.boostDetails!==void 0);return r||s},[n.coreScores,l]),i=()=>{const r=new Map(n.scores);if(a.mode==="expert")for(const[s,N]of n.coreScores)r.set(s,N);y(r,n)},S=d.useMemo(()=>{const r=a.mode==="expert"?n.coreScores:n.scores;return Array.from(r.entries()).sort(([s,N],[w,I])=>{const A=J.includes(s),j=J.includes(w);return A&&!j?-1:!A&&j?1:I.durationPercent-N.durationPercent})},[n,a.mode]);return e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl border border-gray-200 overflow-hidden max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"bg-gradient-to-r from-cacao-600 to-cacao-700 px-6 py-4",children:e.jsxs("h3",{className:"text-white font-bold text-lg",children:[t==="es"?"Análisis TDS":"TDS Analysis",e.jsxs("span",{className:"text-cacao-200 text-sm ml-2",children:["(",a.mode==="normal"?"Normal":"Expert",")"]})]})}),e.jsxs("div",{className:"px-4 py-2 bg-blue-50 border-b border-blue-100",children:[e.jsx("p",{className:"text-xs text-blue-700",children:t==="es"?"Puntuaciones basadas en zonas: Inicio (0-20%), Media (20-100%), Final (post-gusto)":"Scores based on zones: Attack (0-20%), Evolution (20-100%), Finish (aftertaste)"}),k&&e.jsxs("p",{className:"text-xs text-indigo-700 mt-1 font-medium flex items-center gap-1",children:[e.jsx(Y,{size:12}),t==="es"?"Algunos puntajes tienen aumentos recomendados debido a una fuerte presencia en el post-gusto.":"Some scores have recommended boosts due to strong aftertaste presence."]})]}),a.events.length>0&&e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-1 mb-2",children:[e.jsx("h4",{className:"text-sm font-bold text-gray-600 uppercase",children:t==="es"?"Línea de Tiempo":"Timeline"}),e.jsxs("span",{className:"text-xs text-gray-500",children:[t==="es"?"Duración":"Duration",": ",a.totalDuration.toFixed(1),"s | ",t==="es"?"Tragado":"Swallow",": ",a.swallowTime.toFixed(1),"s"]})]}),e.jsx("div",{className:"relative w-full mt-8 mb-8",children:(()=>{const r=n.firstOnset||0,s=r+(n.attackPhaseDuration||0),N=a.swallowTime,w=a.totalDuration,I=r/w*100,A=s/w*100,j=N/w*100;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"absolute -top-4 left-2 right-0 text-xs text-gray-500 font-medium z-20 pointer-events-none",children:[e.jsx("span",{className:"absolute text-gray-600",style:{left:`${I}%`,transform:"translateX(-50%)"},children:"0%"}),e.jsx("span",{className:"absolute text-gray-600",style:{left:`${A}%`,transform:"translateX(-50%)"},children:"20%"}),e.jsx("span",{className:"absolute text-gray-800 font-bold",style:{left:`${j}%`,transform:"translateX(-50%)"},children:"100%"})]}),e.jsxs("div",{className:"relative w-full h-14 sm:h-16 bg-gray-100 rounded-lg overflow-hidden",onClick:()=>x(null),children:[e.jsx("div",{className:"absolute inset-0 flex",children:a.events.map((o,g)=>{var F;const h=o.start/w*100,p=(o.end-o.start)/w*100,f=v===g;return e.jsx("div",{className:`absolute h-full cursor-pointer ${f?"opacity-100 z-20":"hover:opacity-80"}`,style:{left:`${h}%`,width:`${p}%`,backgroundColor:H(o.attrId)},onClick:P=>{P.stopPropagation(),x(f?null:g)},"aria-label":`${((F=B[o.attrId])==null?void 0:F[t])||o.attrId}: ${o.start.toFixed(1)}s - ${o.end.toFixed(1)}s`},g)})}),e.jsx("div",{className:"absolute top-0 bottom-0 w-0.5 sm:w-1 z-10",style:{left:`${A}%`,background:"repeating-linear-gradient(to bottom, black 0, black 4px, transparent 4px, transparent 8px)"}}),e.jsx("div",{className:"absolute top-0 bottom-0 w-1 sm:w-1.5 z-10 bg-black",style:{left:`${j}%`}})]}),e.jsxs("div",{className:"absolute -bottom-0 left-2 right-0 text-xs text-gray-500 font-medium z-20 pointer-events-none",children:[e.jsxs("span",{className:"absolute text-gray-600",style:{left:`${I}%`,transform:"translateX(-50%)"},children:[r.toFixed(1),"s"]}),e.jsxs("span",{className:"absolute text-gray-600",style:{left:`${A}%`,transform:"translateX(-50%)"},children:[s.toFixed(1),"s"]}),e.jsxs("span",{className:"absolute text-gray-800 font-bold",style:{left:`${j}%`,transform:"translateX(-50%)"},children:[N.toFixed(1),"s"]})]})]})})()}),e.jsxs("div",{className:"flex flex-wrap items-center justify-center gap-x-4 gap-y-1 text-xs text-gray-600",children:[e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"w-4 border-t-2 border-dashed border-gray-400"}),t==="es"?"Fin del ataque":"Attack End"]}),e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"w-4 h-1 bg-black"}),t==="es"?"Tragar":"Swallow"]}),e.jsxs("span",{className:"font-medium text-amber-700",children:[t==="es"?"Post-gusto":"Aftertaste",": ",(a.totalDuration-a.swallowTime).toFixed(1),"s"]})]}),e.jsx("div",{className:"h-10 flex items-center justify-center",children:v!==null&&a.events[v]?e.jsxs("div",{className:"px-3 py-1.5 bg-gray-100 rounded-lg flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded",style:{backgroundColor:H(a.events[v].attrId)}}),e.jsx("span",{className:"font-medium text-gray-800 text-sm",children:(($=B[a.events[v].attrId])==null?void 0:$[t])||a.events[v].attrId})]}),e.jsxs("span",{className:"text-xs text-gray-600",children:[a.events[v].start.toFixed(1),"s – ",a.events[v].end.toFixed(1),"s",e.jsxs("span",{className:"ml-1 text-gray-400",children:["(",(a.events[v].end-a.events[v].start).toFixed(1),"s)"]})]})]}):e.jsx("span",{className:"text-xs text-gray-400",children:t==="es"?"Toca un segmento para ver detalles":"Tap a segment to see details"})})]}),e.jsxs("div",{className:"px-4 pb-2",children:[e.jsx("h4",{className:"text-sm font-bold text-gray-600 uppercase mb-2",children:t==="es"?"Atributos Principales":"Core Attributes"}),e.jsx("div",{className:"grid grid-cols-1 gap-1.5",children:S.filter(([r])=>J.includes(r)).map(([r,s])=>{var N;return e.jsxs("div",{className:`flex flex-col rounded-lg px-3 py-2 ${s.isFlagged?"bg-amber-50 border border-amber-200":"bg-gray-50"}`,children:[e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:H(r)}}),e.jsx("span",{className:"text-sm text-gray-700 font-medium",children:((N=B[r])==null?void 0:N[t])||r}),s.isFlagged&&e.jsx("span",{className:"text-xs text-amber-600 bg-amber-100 px-1 rounded",children:"!"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs text-gray-400",children:[s.durationPercent,"%"]}),e.jsx("span",{className:`font-bold w-6 text-right ${s.boostDetails?"text-indigo-700":"text-cacao-800"}`,children:s.score})]})]}),s.boostDetails&&e.jsxs("div",{className:"mt-1 ml-5 text-xs text-indigo-600 flex items-start gap-1",children:[e.jsx("div",{className:"flex h-3 w-3 items-center justify-center rounded-full bg-indigo-100 text-[9px] font-bold mt-0.5 flex-shrink-0",children:"↑"}),e.jsx("span",{children:t==="es"?`Recomendación: +${s.boostDetails.amount} (${s.boostDetails.reason==="aftertaste"?`Presencia tras tragar: ${s.boostDetails.duration}s`:s.boostDetails.reason==="mixed"?`Presencia fuerte: ${s.boostDetails.duration}s`:`Contribución componentes: ${s.boostDetails.duration}s`})`:`Recommendation: +${s.boostDetails.amount} (${s.boostDetails.reason==="aftertaste"?`Lingering presence: ${s.boostDetails.duration}s`:s.boostDetails.reason==="mixed"?`Strong presence: ${s.boostDetails.duration}s`:`Component presence: ${s.boostDetails.duration}s`})`})]})]},r)})})]}),a.mode==="expert"&&l.length>0&&e.jsxs("div",{className:"px-4 pb-4",children:[e.jsx("h4",{className:"text-sm font-bold text-gray-600 uppercase mb-2",children:t==="es"?"Complementarios":"Complementary"}),e.jsx("div",{className:"grid grid-cols-1 gap-1.5",children:l.map(([r,s])=>{var N;return e.jsxs("div",{className:`flex flex-col rounded-lg px-3 py-2 ${s.isFlagged?"bg-amber-50 border border-amber-200":"bg-gray-50"}`,children:[e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:H(r)}}),e.jsx("span",{className:"text-sm text-gray-700 font-medium",children:((N=B[r])==null?void 0:N[t])||r}),s.isFlagged&&e.jsx("span",{className:"text-xs text-amber-600 bg-amber-100 px-1 rounded",children:"!"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs text-gray-400",children:[s.durationPercent,"%"]}),e.jsx("span",{className:`font-bold w-6 text-right ${s.boostDetails?"text-indigo-700":"text-cacao-700"}`,children:s.score})]})]}),s.boostDetails&&e.jsxs("div",{className:"mt-1 ml-5 text-xs text-indigo-600 flex items-start gap-1",children:[e.jsx("div",{className:"flex h-3 w-3 items-center justify-center rounded-full bg-indigo-100 text-[9px] font-bold mt-0.5 flex-shrink-0",children:"↑"}),e.jsx("span",{children:t==="es"?`Recomendación: +${s.boostDetails.amount} (${s.boostDetails.reason==="aftertaste"?`Presencia tras tragar: ${s.boostDetails.duration}s`:s.boostDetails.reason==="mixed"?`Presencia fuerte: ${s.boostDetails.duration}s`:`Contribución componentes: ${s.boostDetails.duration}s`})`:`Recommendation: +${s.boostDetails.amount} (${s.boostDetails.reason==="aftertaste"?`Lingering presence: ${s.boostDetails.duration}s`:s.boostDetails.reason==="mixed"?`Strong presence: ${s.boostDetails.duration}s`:`Component presence: ${s.boostDetails.duration}s`})`})]})]},r)})})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 p-4 bg-gradient-to-r from-amber-50 to-orange-50 border-y",children:[e.jsxs("div",{className:"bg-white/70 rounded-lg p-3 backdrop-blur",children:[e.jsxs("div",{className:"flex items-center gap-2 text-amber-700 mb-1",children:[e.jsx(Ie,{size:16}),e.jsx("span",{className:"text-xs font-bold uppercase",children:"Aroma"})]}),e.jsxs("div",{className:"text-2xl font-bold text-amber-800",children:[n.aromaPercent,"%"]}),n.aromaNotes.length>0&&e.jsx("div",{className:"text-xs text-amber-600 mt-1",children:n.aromaNotes.map(r=>{var s;return((s=B[r])==null?void 0:s[t])||r}).join(", ")})]}),e.jsxs("div",{className:"bg-white/70 rounded-lg p-3 backdrop-blur",children:[e.jsxs("div",{className:"flex items-center gap-2 text-orange-700 mb-1",children:[e.jsx(Y,{size:16}),e.jsx("span",{className:"text-xs font-bold uppercase",children:t==="es"?"Post-gusto":"Aftertaste"})]}),e.jsxs("div",{className:"text-2xl font-bold text-orange-800",children:[n.aftertastePercent,"%"]}),e.jsx("div",{className:`text-xs mt-1 ${n.aftertasteQuality==="positive"?"text-green-600":n.aftertasteQuality==="negative"?"text-red-600":"text-gray-500"}`,children:t==="es"?n.aftertasteQuality==="positive"?"Positivo":n.aftertasteQuality==="negative"?"Negativo":"Neutral":n.aftertasteQuality==="positive"?"Positive":n.aftertasteQuality==="negative"?"Negative":"Neutral"})]})]}),(((b=n.kickSuggestions)==null?void 0:b.length)>0||((z=n.qualitySuggestions)==null?void 0:z.length)>0)&&e.jsxs("div",{className:"px-4 py-3 bg-indigo-50 border-b border-indigo-100",children:[e.jsxs("h4",{className:"text-sm font-bold text-indigo-800 flex items-center gap-2 mb-2",children:[e.jsx(Y,{size:16}),t==="es"?"Observaciones":"Insights"]}),e.jsxs("div",{className:"space-y-3",children:[(E=n.kickSuggestions)==null?void 0:E.map((r,s)=>e.jsx("div",{className:"text-xs text-indigo-700 bg-white p-2 rounded border border-indigo-100 flex gap-2",children:t==="es"?r.es:r.en},`kick-${s}`)),(M=n.qualitySuggestions)==null?void 0:M.map((r,s)=>e.jsx("div",{className:"text-xs text-indigo-700 bg-white p-2 rounded border border-indigo-100 flex gap-2",children:t==="es"?r.es:r.en},`qual-${s}`))]})]}),n.qualityModifier!==0&&e.jsx("div",{className:"px-4 pb-3 pt-2",children:e.jsxs("div",{className:`text-sm px-3 py-2 rounded-lg ${n.qualityModifier>0?"bg-green-50 text-green-700":"bg-red-50 text-red-700"}`,children:[t==="es"?"Ajuste de calidad sugerido:":"Suggested quality adjustment:"," ",e.jsxs("strong",{children:[n.qualityModifier>0?"+":"",n.qualityModifier]})]})}),(T||C)&&e.jsx("div",{className:"px-4 py-2 bg-amber-50 border-b border-amber-100",children:T&&e.jsxs("div",{className:"flex items-center gap-2 text-amber-700 text-sm",children:[e.jsx(ge,{size:16}),e.jsx("span",{children:t==="es"?"Atributos principales sin selección":"Core attributes not selected"})]})}),e.jsxs("div",{className:"flex gap-3 p-4 bg-gray-50 border-t sticky bottom-0",children:[e.jsx("button",{onClick:m,className:"flex-1 bg-white border border-gray-300 text-gray-700 font-bold py-3 rounded-xl hover:bg-gray-100 flex items-center justify-center gap-2",children:t==="es"?"Descartar":"Discard"}),e.jsx("button",{onClick:u,className:"flex-1 bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-xl flex items-center justify-center gap-2",children:t==="es"?"Guardar":"Save"}),e.jsx("button",{onClick:i,className:"flex-1 bg-green-600 hover:bg-green-700 text-white font-bold py-3 rounded-xl flex items-center justify-center gap-2",children:t==="es"?"Aplicar":"Apply"})]})]})},Ve=({onSelect:a,onCancel:y})=>{const{language:m}=V();return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl p-6 max-w-md w-full mx-4",children:[e.jsx("h3",{className:"text-xl font-bold text-cacao-800 mb-4",children:m==="es"?"Seleccionar Modo TDS":"Select TDS Mode"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:()=>a("normal"),className:"w-full bg-cacao-50 hover:bg-cacao-100 border-2 border-cacao-200 rounded-xl p-4 text-left transition-colors",children:[e.jsx("div",{className:"font-bold text-cacao-800",children:m==="es"?"Normal (5 atributos)":"Normal (5 attributes)"}),e.jsx("div",{className:"text-sm text-gray-600",children:m==="es"?"Cacao, Acidez, Amargo, Astringencia, Tostado":"Cacao, Acidity, Bitter, Astringency, Roast"})]}),e.jsxs("button",{onClick:()=>a("expert"),className:"w-full bg-amber-50 hover:bg-amber-100 border-2 border-amber-200 rounded-xl p-4 text-left transition-colors",children:[e.jsx("div",{className:"font-bold text-amber-800",children:m==="es"?"Experto (15 atributos)":"Expert (15 attributes)"}),e.jsx("div",{className:"text-sm text-gray-600",children:m==="es"?"Todos los atributos de sabor":"All flavor attributes"})]})]}),e.jsx("button",{onClick:y,className:"mt-4 w-full text-gray-500 hover:text-gray-700 py-2",children:m==="es"?"Cancelar":"Cancel"})]})})},Je=a=>{const{language:y,t:m}=V(),[u,t]=d.useState(!1),[v,x]=d.useState(!0),[n,l]=d.useState(!1),[T,C]=d.useState(null),k=()=>({sampleCode:"",date:"",time:"",evaluator:"",evaluationType:"cacao_mass",sampleInfo:"",notes:"",producerRecommendations:""}),[i,S]=d.useState({metadata:k(),attributes:JSON.parse(JSON.stringify(K)),globalQuality:0,language:"en"}),[$]=d.useState(JSON.parse(JSON.stringify(re)));d.useEffect(()=>{S(j=>({...j,language:y}))},[y]),d.useEffect(()=>{a&&(async()=>{const o=await W.getSample(a);o&&(S({metadata:{sampleCode:o.sampleCode,date:o.date,time:o.time,evaluator:o.evaluator,evaluationType:o.evaluationType,sampleInfo:o.sampleInfo,notes:o.notes,producerRecommendations:o.producerRecommendations},attributes:o.attributes,globalQuality:o.globalQuality,selectedQualityId:o.selectedQualityId,language:y,tdsProfile:o.tdsProfile}),t(!0))})()},[a,y]);const b=(j,o)=>{const g=o.map(P=>P.score),h=[...g].sort((P,R)=>R-P),p=P=>h[P-1]||0;let f=0;switch(j){case"acidity":case"defects":f=g.reduce((P,R)=>P+R,0);break;case"fresh_fruit":f=p(1)+p(2)*.75+(p(3)+p(4)+p(5))/3;break;case"browned_fruit":case"woody":case"spice":f=p(1)+p(2)*.75+p(3)/3;break;case"vegetal":case"floral":case"nutty":f=p(1)+p(2)*.75;break;default:f=0}const F=Math.min(f,10);return Math.round((F+Number.EPSILON)*10)/10};return{session:i,setSession:S,qualityAttributes:$,isEvaluationStarted:u,setIsEvaluationStarted:t,isGlobalQualityExpanded:v,setIsGlobalQualityExpanded:x,showPostSaveModal:n,setShowPostSaveModal:l,validationError:T,setValidationError:C,getInitialMetadata:k,handlers:{handleMetadataChange:(j,o)=>{S(g=>({...g,metadata:{...g.metadata,[j]:o}}))},handleAttributeChange:(j,o)=>{S(g=>{const h=g.attributes.map(p=>p.id===j?{...p,score:o}:p);return{...g,attributes:h}})},handleSubAttributeChange:(j,o,g)=>{S(h=>{const p=h.attributes.map(f=>{if(f.id===j&&f.subAttributes){const F=f.subAttributes.map(R=>R.id===o?{...R,score:g}:R);let P=f.score;return f.isCalculated&&(P=b(f.id,F)),{...f,score:P,subAttributes:F}}return f});return{...h,attributes:p}})},handleSubAttributeDescription:(j,o,g)=>{S(h=>{const p=h.attributes.map(f=>f.id===j&&f.subAttributes?{...f,subAttributes:f.subAttributes.map(F=>F.id===o?{...F,description:g}:F)}:f);return{...h,attributes:p}})},handleQualitySelect:j=>{S(o=>({...o,selectedQualityId:j}))},handleStartEvaluation:()=>{const j=ve(),o=je();S(g=>({...g,metadata:{...g.metadata,date:j,time:o}})),t(!0)},handleReset:async j=>{const o=j||window.confirm;await Promise.resolve(o(m.confirmReset))&&(S({metadata:k(),attributes:JSON.parse(JSON.stringify(K)),globalQuality:0,language:y}),t(!1),window.scrollTo(0,0))},handleSaveToLibrary:async(j,o)=>{const g=o||(async h=>window.confirm(h));try{const h=i.metadata.sampleCode.trim(),p=i.metadata.evaluator.trim(),f=i.metadata.date;if(!h||!p||!f){const D=[];h||D.push(y==="es"?"Código de Muestra":"Sample Code"),p||D.push(y==="es"?"Evaluador":"Evaluator"),f||D.push(y==="es"?"Fecha":"Date"),C(y==="es"?`Por favor complete los siguientes campos obligatorios antes de guardar:
- ${D.join(`
- `)}`:`Please complete the following required fields before saving:
- ${D.join(`
- `)}`);return}const P=["cacao","bitterness","astringency","roast","acidity"].filter(D=>{const L=i.attributes.find(O=>O.id===D);return!L||L.score<=0});if(P.length>0){const D=P.map(O=>{const G=i.attributes.find(ne=>ne.id===O);return y==="es"?G==null?void 0:G.nameEs:G==null?void 0:G.nameEn}).join(", ");if(!await g(y==="es"?`Los siguientes campos principales tienen valor 0 (Ausente): ${D}.

¿Desea guardar de todos modos?`:`The following core attributes are set to 0 (Absent): ${D}.

Do you want to save anyway?`))return}if(i.globalQuality<=0&&!await g(y==="es"?"La Calidad Global es 0. ¿Desea guardar de todos modos?":"Global Quality score is 0. Do you want to save anyway?"))return;const Q=(await W.searchBySampleCode(h)).find(D=>D.sampleCode.toLowerCase()===h.toLowerCase()&&D.evaluator.toLowerCase()===p.toLowerCase()&&D.date===f);let U=a;if(Q)if(a&&Q.id===a)U=a;else{if(!await g(y==="es"?`Ya existe una muestra con código "${h}", evaluador "${p}" y fecha "${f}". ¿Desea sobrescribirla?`:`A sample with code "${h}", evaluator "${p}", and date "${f}" already exists. Do you want to overwrite it?`))return;U=Q.id}const c={sampleCode:i.metadata.sampleCode,date:i.metadata.date,time:i.metadata.time,evaluator:i.metadata.evaluator,evaluationType:i.metadata.evaluationType,sampleInfo:i.metadata.sampleInfo,notes:i.metadata.notes,producerRecommendations:i.metadata.producerRecommendations,attributes:i.attributes,globalQuality:i.globalQuality,selectedQualityId:i.selectedQualityId,language:y,tdsProfile:i.tdsProfile},_=await W.saveSample(c,U||void 0);C(null),_!==a&&j(`/evaluate?id=${_}`,{replace:!0}),l(!0)}catch(h){console.error("Failed to save sample:",h),C(y==="es"?`❌ Error al guardar la muestra: ${h}`:`❌ Failed to save sample: ${h}`)}},applyTDSData:(j,o,g=!0)=>{let h=i.attributes;g&&(h=xe(i.attributes,o.scores));const p={...j,analysis:o};S(f=>({...f,attributes:h,tdsProfile:p})),t(!0)}}}},Xe=({onApply:a,onStartEvaluation:y})=>{const[m,u]=d.useState(!1),[t,v]=d.useState(!1),[x,n]=d.useState(!1),[l,T]=d.useState("normal"),[C,k]=d.useState(null);return{state:{showTDSModeSelect:m,showTDSProfiler:t,showTDSSummary:x,tdsMode:l,tdsProfile:C},actions:{setShowTDSModeSelect:u,setShowTDSProfiler:v,setShowTDSSummary:n,setTdsProfile:k,handleStartTDS:()=>{y(),u(!0)},handleTDSModeSelect:M=>{T(M),u(!1),v(!0)},handleTDSComplete:M=>{k(M),v(!1),n(!0)},handleTDSApply:(M,r)=>{C&&a(C,r,!0),n(!1)},handleTDSDiscard:()=>{k(null),n(!1)},handleTDSSave:()=>{if(C){const M=te(C);a(C,M,!1)}n(!1)}}}},dt=()=>{const{language:a,setLanguage:y,t:m}=V(),u=le(),[t]=ie(),v=t.get("id"),x=d.useRef(null),[n,l]=d.useState(null),T=c=>new Promise(_=>{l({message:c,resolve:_})}),C=()=>{n&&(n.resolve(!0),l(null))},k=()=>{n&&(n.resolve(!1),l(null))},{session:i,setSession:S,qualityAttributes:$,isEvaluationStarted:b,setIsEvaluationStarted:z,isGlobalQualityExpanded:E,setIsGlobalQualityExpanded:M,showPostSaveModal:r,setShowPostSaveModal:s,validationError:N,setValidationError:w,getInitialMetadata:I,handlers:{handleMetadataChange:A,handleAttributeChange:j,handleSubAttributeChange:o,handleSubAttributeDescription:g,handleQualitySelect:h,handleStartEvaluation:p,handleReset:f,handleSaveToLibrary:F,applyTDSData:P}}=Je(v),{state:R,actions:Q}=Xe({onApply:P,onStartEvaluation:p}),U=c=>["cacao","bitterness","astringency","roast","acidity"].includes(c);return e.jsxs("div",{className:"flex flex-col min-h-screen bg-cacao-50 text-gray-800 font-sans",children:[e.jsx(de,{}),e.jsxs("main",{id:"main-content",className:"w-full px-4 md:px-8 space-y-8 mb-8 flex-grow",children:[e.jsxs("section",{className:"bg-white p-6 rounded-xl shadow-sm border border-cacao-100 transition-opacity",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-6 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-1",children:m.evaluator}),e.jsx("input",{type:"text",value:i.metadata.evaluator,onChange:c=>A("evaluator",c.target.value),className:"w-full p-2 bg-gray-50 border rounded-md disabled:bg-gray-100"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-1",children:[m.date," / ",m.time]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative w-full",children:[e.jsx("input",{type:"date",required:!0,value:i.metadata.date,onChange:c=>A("date",c.target.value),className:`w-full p-2 bg-gray-50 border rounded-md disabled:bg-gray-100 ${a==="es"&&i.metadata.date?"text-transparent":""}`}),a==="es"&&i.metadata.date&&e.jsx("div",{className:"absolute inset-0 flex items-center pl-2 pointer-events-none text-gray-800 p-2 bg-gray-50 border border-transparent rounded-md",children:(()=>{const[c,_,D]=i.metadata.date.split("-");return`${D}/${_}/${c}`})()})]}),e.jsx("input",{type:"time",value:i.metadata.time,onChange:c=>A("time",c.target.value),className:"w-32 p-2 bg-gray-50 border rounded-md disabled:bg-gray-100"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-1",children:m.code}),e.jsx("input",{type:"text",value:i.metadata.sampleCode,onChange:c=>A("sampleCode",c.target.value),className:"w-full p-2 bg-gray-50 border rounded-md font-mono disabled:bg-gray-100"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-1",children:m.evaluationType}),e.jsxs("select",{value:i.metadata.evaluationType,onChange:c=>A("evaluationType",c.target.value),className:"w-full p-2 bg-gray-50 border rounded-md disabled:bg-gray-100",children:[e.jsx("option",{value:"cacao_mass",children:m.cacaoMass}),e.jsx("option",{value:"chocolate",children:m.chocolate})]})]})]}),e.jsx("div",{className:"grid grid-cols-1",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-1",children:m.sampleInfoLabel}),e.jsx("input",{type:"text",value:i.metadata.sampleInfo,onChange:c=>A("sampleInfo",c.target.value),className:"w-full p-2 bg-gray-50 border rounded-md disabled:bg-gray-100"})]})})]}),!b&&e.jsxs("div",{className:"flex flex-col sm:flex-row justify-center gap-4",children:[e.jsxs("button",{type:"button",onClick:p,className:"bg-cacao-600 hover:bg-cacao-700 text-white font-bold py-3 px-8 rounded-full shadow-lg transition-transform transform hover:scale-105 flex items-center gap-2",children:[e.jsx(Pe,{size:20,fill:"currentColor"}),m.startEvaluation]}),e.jsxs("button",{type:"button",onClick:Q.handleStartTDS,className:"bg-amber-600 hover:bg-amber-700 text-white font-bold py-3 px-8 rounded-full shadow-lg transition-transform transform hover:scale-105 flex items-center gap-2",children:[e.jsx(we,{size:20}),a==="es"?"Perfil TDS":"TDS Profile"]})]}),e.jsxs("div",{className:`grid grid-cols-1 lg:grid-cols-3 gap-8 transition-opacity ${b?"opacity-100":"opacity-50"}`,children:[e.jsx("div",{className:"lg:col-span-2 space-y-8",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-bold text-cacao-700 sticky top-20 bg-cacao-50 py-2 z-10",children:m.basicAttributes}),i.attributes.map(c=>{var D;const _=U(c.id);return e.jsx(Le,{id:c.id,label:a==="es"?c.nameEs:c.nameEn,value:c.score,subAttributes:(D=c.subAttributes)==null?void 0:D.map(L=>({...L,name:a==="es"?L.nameEs:L.nameEn})),onChange:L=>j(c.id,L),onSubAttributeChange:(L,O)=>o(c.id,L,O),onSubAttributeDescriptionChange:c.id==="defects"?(L,O)=>g(c.id,L,O):void 0,language:a,customColor:H(c.id),isCalculated:c.isCalculated,disabled:!b,defaultExpanded:_},c.id)})]})}),e.jsx("div",{className:"lg:col-span-1 space-y-6",children:e.jsxs("div",{className:"lg:sticky lg:top-24 space-y-6",children:[e.jsxs("div",{className:`bg-white rounded-xl shadow-sm border border-cacao-100 transition-all overflow-hidden ${b?"":"opacity-80 pointer-events-none"}`,children:[e.jsxs("button",{onClick:()=>M(!E),disabled:!b,"aria-expanded":E,"aria-controls":"global-quality-content",className:"w-full p-4 flex justify-between items-center hover:bg-cacao-50 transition-colors active:bg-cacao-100 touch-manipulation min-h-[44px]",children:[e.jsx("span",{className:"text-sm font-bold text-cacao-800 uppercase tracking-wide",children:m.globalScore}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-2xl font-mono font-bold text-cacao-800 min-w-[3rem] text-right",children:i.globalQuality}),E?e.jsx(se,{size:20,className:"text-gray-600 flex-shrink-0"}):e.jsx(ae,{size:20,className:"text-gray-600 flex-shrink-0"})]})]}),e.jsx("div",{id:"global-quality-content",className:"transition-all duration-300 ease-in-out",style:{maxHeight:E?"500px":"0",opacity:E?1:0},children:e.jsxs("div",{className:"px-4 pb-4 space-y-6",children:[e.jsx("div",{children:e.jsx("div",{className:"flex items-center gap-4 touch-pan-y",children:e.jsx("input",{type:"range",min:"0",max:"10",step:"0.5",value:i.globalQuality,onChange:c=>S(_=>({..._,globalQuality:parseFloat(c.target.value)})),disabled:!b,className:`w-full h-8 md:h-4 bg-gray-200 rounded-lg appearance-none accent-cacao-800 touch-pan-y ${b?"cursor-pointer":"cursor-not-allowed"}`})})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-bold text-gray-700 uppercase mb-2",children:m.qualityCharacteristic}),e.jsxs("select",{value:i.selectedQualityId||"",onChange:c=>h(c.target.value),disabled:!b,className:"w-full p-2 bg-gray-50 border border-gray-200 rounded-lg text-sm focus:border-cacao-500 focus:ring-1 focus:ring-cacao-500 disabled:bg-gray-100 outline-none transition-all",children:[e.jsx("option",{value:"",children:a==="es"?"Seleccionar...":"Select..."}),$.map(c=>e.jsx("option",{value:c.id,children:a==="es"?c.nameEs:c.nameEn},c.id))]})]})]})})]}),e.jsxs("div",{className:`bg-white p-6 rounded-xl shadow-sm border border-cacao-100 space-y-4 transition-opacity ${b?"":"opacity-80 pointer-events-none"}`,children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-1",children:m.flavorNotes}),e.jsx("textarea",{className:"w-full p-3 bg-gray-50 border rounded-lg h-24 text-sm disabled:bg-gray-100",value:i.metadata.notes,onChange:c=>A("notes",c.target.value),disabled:!b})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-1",children:m.producerFeedback}),e.jsx("textarea",{className:"w-full p-3 bg-gray-50 border rounded-lg h-24 text-sm disabled:bg-gray-100",value:i.metadata.producerRecommendations,onChange:c=>A("producerRecommendations",c.target.value),disabled:!b})]})]}),e.jsx(ue,{ref:x,attributes:i.attributes}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-3 pt-2",children:[e.jsxs("button",{type:"button",onClick:()=>F(u,T),disabled:!b,className:"w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 rounded-xl shadow-md transition-colors flex justify-center items-center gap-2 border border-green-600 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(Fe,{size:20}),a==="es"?"Guardar en Biblioteca":"Save to Library"]}),e.jsxs("button",{type:"button",onClick:()=>u("/samples"),className:"w-full bg-white border border-cacao-200 text-cacao-700 font-bold py-3 rounded-xl shadow-sm hover:bg-cacao-50 transition-colors flex justify-center items-center gap-2",children:[e.jsx(Z,{size:20}),a==="es"?"Ver Biblioteca":"View Library"]})]}),e.jsxs("button",{type:"button",onClick:()=>f(T),className:"w-full bg-white border border-gray-300 text-gray-600 font-medium py-3 rounded-xl hover:bg-gray-50 transition-colors flex justify-center items-center gap-2 shadow-sm",children:[e.jsx(pe,{size:18})," ",m.reset]})]})]})})]})]}),r&&e.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm animate-in fade-in duration-200",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl p-6 w-full max-w-md space-y-6 transform scale-100 animate-in zoom-in-95 duration-200",children:[e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 text-green-600 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(be,{size:32})}),e.jsx("h3",{className:"text-2xl font-bold text-gray-800",children:a==="es"?"¡Muestra Guardada!":"Sample Saved!"}),e.jsx("p",{className:"text-gray-500",children:a==="es"?"¿Qué operación desea realizar?":"What would you like to do next?"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:()=>u("/samples"),className:"w-full bg-white border border-gray-200 hover:bg-gray-50 text-gray-800 font-bold py-3 rounded-xl transition-colors flex items-center justify-center gap-3 shadow-sm",children:[e.jsx(Z,{size:20,className:"text-cacao-600"}),m.sampleLibrary]}),e.jsxs("button",{onClick:()=>{S({metadata:I(),attributes:JSON.parse(JSON.stringify(K)),globalQuality:0,language:a}),z(!1),s(!1),window.scrollTo(0,0),u("/evaluate")},className:"w-full bg-cacao-600 hover:bg-cacao-700 text-white font-bold py-3 rounded-xl transition-colors flex items-center justify-center gap-3 shadow-md",children:[e.jsx(fe,{size:20}),m.newEvaluation]}),e.jsx("button",{onClick:()=>s(!1),className:"w-full bg-gray-100 hover:bg-gray-200 text-gray-700 font-bold py-3 rounded-xl transition-colors flex items-center justify-center gap-2",children:a==="es"?"Seguir editando":"Keep editing"})]})]})}),R.showTDSModeSelect&&e.jsx(Ve,{onSelect:Q.handleTDSModeSelect,onCancel:()=>Q.setShowTDSModeSelect(!1)}),R.showTDSProfiler&&e.jsx(Ge,{mode:R.tdsMode,onComplete:Q.handleTDSComplete,onCancel:()=>Q.setShowTDSProfiler(!1)}),R.showTDSSummary&&R.tdsProfile&&e.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-2 sm:p-6 bg-black/60 backdrop-blur-sm animate-in fade-in duration-200",children:e.jsx("div",{className:"w-full max-w-4xl",children:e.jsx(Ue,{profile:R.tdsProfile,onApply:Q.handleTDSApply,onDiscard:Q.handleTDSDiscard,onSave:Q.handleTDSSave})})}),e.jsx(he,{isOpen:!!N,onClose:()=>w(null),message:N||""}),e.jsx(ye,{isOpen:!!n,onClose:k,onConfirm:C,message:(n==null?void 0:n.message)||""}),e.jsx(me,{}),e.jsx(Qe,{attributes:i.attributes,language:a,isEvaluationStarted:b})]})};export{dt as default};
